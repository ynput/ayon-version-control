<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=prev href=../index.html><link rel=next href=p4_dcc.html><link rel=icon href=../../../../../../img/favicon.ico><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.9"><title>api - ayon-version-control</title><link rel=stylesheet href=../../../../../../assets/stylesheets/main.4af4bdda.min.css><link rel=stylesheet href=../../../../../../assets/stylesheets/palette.06af60db.min.css><script src=https://unpkg.com/iframe-worker/shim></script><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../../../../../assets/_mkdocstrings.css><link rel=stylesheet href=../../../../../../css/custom.css><script>__md_scope=new URL("../../../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#client.version_control.backends.perforce.api class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <div data-md-color-scheme=default data-md-component=outdated hidden> </div> <header class="md-header md-header--shadow" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../../../../../../index.html title=ayon-version-control class="md-header__button md-logo" aria-label=ayon-version-control data-md-component=logo> <img src=../../../../../../img/ay-symbol-blackw-full.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> ayon-version-control </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> api </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/ynput/ayon-version-control title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../../../../../index.html title=ayon-version-control class="md-nav__button md-logo" aria-label=ayon-version-control data-md-component=logo> <img src=../../../../../../img/ay-symbol-blackw-full.png alt=logo> </a> ayon-version-control </label> <div class=md-nav__source> <a href=https://github.com/ynput/ayon-version-control title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../index.html class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class=md-nav__item> <a href=../../../../../../license.html class=md-nav__link> <span class=md-ellipsis> License </span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3 checked> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex> <span class=md-ellipsis> Reference </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=true> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Reference </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_1 checked> <label class=md-nav__link for=__nav_3_1 id=__nav_3_1_label tabindex=0> <span class=md-ellipsis> client </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_1_label aria-expanded=true> <label class=md-nav__title for=__nav_3_1> <span class="md-nav__icon md-icon"></span> client </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_1_1 checked> <div class="md-nav__link md-nav__container"> <a href=../../../index.html class="md-nav__link "> <span class=md-ellipsis> version_control </span> </a> <label class="md-nav__link " for=__nav_3_1_1 id=__nav_3_1_1_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_3_1_1_label aria-expanded=true> <label class=md-nav__title for=__nav_3_1_1> <span class="md-nav__icon md-icon"></span> version_control </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../addon.html class=md-nav__link> <span class=md-ellipsis> addon </span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_1_1_2 checked> <div class="md-nav__link md-nav__container"> <a href=../../index.html class="md-nav__link "> <span class=md-ellipsis> backends </span> </a> <label class="md-nav__link " for=__nav_3_1_1_2 id=__nav_3_1_1_2_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=4 aria-labelledby=__nav_3_1_1_2_label aria-expanded=true> <label class=md-nav__title for=__nav_3_1_1_2> <span class="md-nav__icon md-icon"></span> backends </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../abstract.html class=md-nav__link> <span class=md-ellipsis> abstract </span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_1_1_2_2 checked> <div class="md-nav__link md-nav__container"> <a href=../index.html class="md-nav__link "> <span class=md-ellipsis> perforce </span> </a> <label class="md-nav__link " for=__nav_3_1_1_2_2 id=__nav_3_1_1_2_2_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=5 aria-labelledby=__nav_3_1_1_2_2_label aria-expanded=true> <label class=md-nav__title for=__nav_3_1_1_2_2> <span class="md-nav__icon md-icon"></span> perforce </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_1_1_2_2_1 checked> <div class="md-nav__link md-nav__container"> <a href=index.html class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> api </span> </a> <label class="md-nav__link md-nav__link--active" for=__nav_3_1_1_2_2_1 id=__nav_3_1_1_2_2_1_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=6 aria-labelledby=__nav_3_1_1_2_2_1_label aria-expanded=true> <label class=md-nav__title for=__nav_3_1_1_2_2_1> <span class="md-nav__icon md-icon"></span> api </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=p4_dcc.html class=md-nav__link> <span class=md-ellipsis> p4_dcc </span> </a> </li> <li class=md-nav__item> <a href=p4_errors.html class=md-nav__link> <span class=md-ellipsis> p4_errors </span> </a> </li> <li class=md-nav__item> <a href=p4_offline.html class=md-nav__link> <span class=md-ellipsis> p4_offline </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../backend.html class=md-nav__link> <span class=md-ellipsis> backend </span> </a> </li> <li class=md-nav__item> <a href=../convert_to_py2_annotations.html class=md-nav__link> <span class=md-ellipsis> convert_to_py2_annotations </span> </a> </li> <li class=md-nav__item> <a href=../rest_routes.html class=md-nav__link> <span class=md-ellipsis> rest_routes </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../undefined.html class=md-nav__link> <span class=md-ellipsis> undefined </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../changes_viewer/abstract.html class=md-nav__link> <span class=md-ellipsis> changes_viewer </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../launch_hooks/perforce/pre_load_sync_project.html class=md-nav__link> <span class=md-ellipsis> launch_hooks </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class=md-nav__item> <a href=../../../lib.html class=md-nav__link> <span class=md-ellipsis> lib </span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../perforce_triggers/change_submit_trigger.html class=md-nav__link> <span class=md-ellipsis> perforce_triggers </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../plugins/create/unreal/changelist_metadata.html class=md-nav__link> <span class=md-ellipsis> plugins </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../rest/communication_server.html class=md-nav__link> <span class=md-ellipsis> rest </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class=md-nav__item> <a href=../../../version.html class=md-nav__link> <span class=md-ellipsis> version </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../../../server/settings/main.html class=md-nav__link> <span class=md-ellipsis> server </span> <span class="md-nav__icon md-icon"></span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#client.version_control.backends.perforce.api class=md-nav__link> <span class=md-ellipsis> api </span> </a> </li> <li class=md-nav__item> <a href=#client.version_control.backends.perforce.api.P4ConnectionManager class=md-nav__link> <span class=md-ellipsis> P4ConnectionManager </span> </a> <nav class=md-nav aria-label=P4ConnectionManager> <ul class=md-nav__list> <li class=md-nav__item> <a href=#client.version_control.backends.perforce.api.P4ConnectionManager--any-method-that-requires-a-connection-to-p4 class=md-nav__link> <span class=md-ellipsis> *** Any method that requires a connection to p4, </span> </a> </li> <li class=md-nav__item> <a href=#client.version_control.backends.perforce.api.P4ConnectionManager--must-be-declared-with-the-prefix-_connect_ class=md-nav__link> <span class=md-ellipsis> must be declared with the prefix: _connect_ *** </span> </a> </li> <li class=md-nav__item> <a href=#client.version_control.backends.perforce.api.P4ConnectionManager.__connect__ class=md-nav__link> <span class=md-ellipsis> __connect__ </span> </a> </li> <li class=md-nav__item> <a href=#client.version_control.backends.perforce.api.P4ConnectionManager.__getattribute__ class=md-nav__link> <span class=md-ellipsis> __getattribute__ </span> </a> </li> <li class=md-nav__item> <a href=#client.version_control.backends.perforce.api.P4ConnectionManager.__run_connect__ class=md-nav__link> <span class=md-ellipsis> __run_connect__ </span> </a> </li> <li class=md-nav__item> <a href=#client.version_control.backends.perforce.api.P4ConnectionManager.login class=md-nav__link> <span class=md-ellipsis> login </span> </a> </li> <li class=md-nav__item> <a href=#client.version_control.backends.perforce.api.P4ConnectionManager.workspace_as class=md-nav__link> <span class=md-ellipsis> workspace_as </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#client.version_control.backends.perforce.api.__getattr__ class=md-nav__link> <span class=md-ellipsis> __getattr__ </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1>api</h1> <div class="doc doc-object doc-module"> <a id=client.version_control.backends.perforce.api></a> <div class="doc doc-contents first"> <p>An easier, more pythonic inteface for working with P4, built on P4Python. Objects, methods and functions in this module handle connection and errors automatically, managing the verbose approach required in P4Python.</p> <div class="doc doc-children"> <div class="doc doc-object doc-class"> <h2 id=client.version_control.backends.perforce.api.P4ConnectionManager class="doc doc-heading"> <code>P4ConnectionManager</code> </h2> <div class="doc doc-contents "> <p>This class is the core of this module.</p> <p>It manages the connection and error handling when sending commands to p4 via P4Python.</p> <p>It does this by providing a number of convenience mechanisms to reduce boiler plate code. The main mechanism is the handling of methods which require a p4 connection. Any attribute that both has <code>_connect_</code> as a prefix and is a method, will lazily wrap said method with <code>__run_connect__</code> and remove the <code>_connect_</code> prefix.</p> <p>For example: <code>_connect_sync</code> will be accessed with <code>sync</code>.</p> <p>This offers multiple benefits:</p> <ul> <li>core methods are marked as private.</li> <li>wrapping of methods is handled lazily, thus is performant.</li> <li>reduced verbosity of calling core method names.</li> </ul> <p>The <code>__run_connect__</code> wrapper works in conjunction with the <code>__connect__</code> context manager to automatically manage the p4.connect and p4.disconnect functionality. This is especially useful for nested <code>_connect_</code> method calls, as P4Python throws an exception if <code>p4.connect()</code> is called when an connection is already active.</p> <h3 id=client.version_control.backends.perforce.api.P4ConnectionManager--any-method-that-requires-a-connection-to-p4>*** Any method that requires a connection to p4,</h3> <h3 id=client.version_control.backends.perforce.api.P4ConnectionManager--must-be-declared-with-the-prefix-_connect_>must be declared with the prefix: <code>_connect_</code> ***</h3> <p>The <code>__run_connect__</code> wrapper will also handle workspaces by attempting to run the given function in each workspace, returning as soon as the function runs successfully. The first workspace used will initially be the current workspace as defined by <code>p4.client</code>, and then it will be updated to the last workspace that a function was successfully run on. This should mean in most cases the function will only need to run the first time as most users pcs should be setup to have <code>p4.client</code> be their standard workspace, BUT if it fails, then the function will be run on all the other workspaces until it either succeeds or there are no workspaces left.</p> <details class=quote> <summary>Source code in <code>client/version_control/backends/perforce/api/__init__.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 146</span>
<span class=normal> 147</span>
<span class=normal> 148</span>
<span class=normal> 149</span>
<span class=normal> 150</span>
<span class=normal> 151</span>
<span class=normal> 152</span>
<span class=normal> 153</span>
<span class=normal> 154</span>
<span class=normal> 155</span>
<span class=normal> 156</span>
<span class=normal> 157</span>
<span class=normal> 158</span>
<span class=normal> 159</span>
<span class=normal> 160</span>
<span class=normal> 161</span>
<span class=normal> 162</span>
<span class=normal> 163</span>
<span class=normal> 164</span>
<span class=normal> 165</span>
<span class=normal> 166</span>
<span class=normal> 167</span>
<span class=normal> 168</span>
<span class=normal> 169</span>
<span class=normal> 170</span>
<span class=normal> 171</span>
<span class=normal> 172</span>
<span class=normal> 173</span>
<span class=normal> 174</span>
<span class=normal> 175</span>
<span class=normal> 176</span>
<span class=normal> 177</span>
<span class=normal> 178</span>
<span class=normal> 179</span>
<span class=normal> 180</span>
<span class=normal> 181</span>
<span class=normal> 182</span>
<span class=normal> 183</span>
<span class=normal> 184</span>
<span class=normal> 185</span>
<span class=normal> 186</span>
<span class=normal> 187</span>
<span class=normal> 188</span>
<span class=normal> 189</span>
<span class=normal> 190</span>
<span class=normal> 191</span>
<span class=normal> 192</span>
<span class=normal> 193</span>
<span class=normal> 194</span>
<span class=normal> 195</span>
<span class=normal> 196</span>
<span class=normal> 197</span>
<span class=normal> 198</span>
<span class=normal> 199</span>
<span class=normal> 200</span>
<span class=normal> 201</span>
<span class=normal> 202</span>
<span class=normal> 203</span>
<span class=normal> 204</span>
<span class=normal> 205</span>
<span class=normal> 206</span>
<span class=normal> 207</span>
<span class=normal> 208</span>
<span class=normal> 209</span>
<span class=normal> 210</span>
<span class=normal> 211</span>
<span class=normal> 212</span>
<span class=normal> 213</span>
<span class=normal> 214</span>
<span class=normal> 215</span>
<span class=normal> 216</span>
<span class=normal> 217</span>
<span class=normal> 218</span>
<span class=normal> 219</span>
<span class=normal> 220</span>
<span class=normal> 221</span>
<span class=normal> 222</span>
<span class=normal> 223</span>
<span class=normal> 224</span>
<span class=normal> 225</span>
<span class=normal> 226</span>
<span class=normal> 227</span>
<span class=normal> 228</span>
<span class=normal> 229</span>
<span class=normal> 230</span>
<span class=normal> 231</span>
<span class=normal> 232</span>
<span class=normal> 233</span>
<span class=normal> 234</span>
<span class=normal> 235</span>
<span class=normal> 236</span>
<span class=normal> 237</span>
<span class=normal> 238</span>
<span class=normal> 239</span>
<span class=normal> 240</span>
<span class=normal> 241</span>
<span class=normal> 242</span>
<span class=normal> 243</span>
<span class=normal> 244</span>
<span class=normal> 245</span>
<span class=normal> 246</span>
<span class=normal> 247</span>
<span class=normal> 248</span>
<span class=normal> 249</span>
<span class=normal> 250</span>
<span class=normal> 251</span>
<span class=normal> 252</span>
<span class=normal> 253</span>
<span class=normal> 254</span>
<span class=normal> 255</span>
<span class=normal> 256</span>
<span class=normal> 257</span>
<span class=normal> 258</span>
<span class=normal> 259</span>
<span class=normal> 260</span>
<span class=normal> 261</span>
<span class=normal> 262</span>
<span class=normal> 263</span>
<span class=normal> 264</span>
<span class=normal> 265</span>
<span class=normal> 266</span>
<span class=normal> 267</span>
<span class=normal> 268</span>
<span class=normal> 269</span>
<span class=normal> 270</span>
<span class=normal> 271</span>
<span class=normal> 272</span>
<span class=normal> 273</span>
<span class=normal> 274</span>
<span class=normal> 275</span>
<span class=normal> 276</span>
<span class=normal> 277</span>
<span class=normal> 278</span>
<span class=normal> 279</span>
<span class=normal> 280</span>
<span class=normal> 281</span>
<span class=normal> 282</span>
<span class=normal> 283</span>
<span class=normal> 284</span>
<span class=normal> 285</span>
<span class=normal> 286</span>
<span class=normal> 287</span>
<span class=normal> 288</span>
<span class=normal> 289</span>
<span class=normal> 290</span>
<span class=normal> 291</span>
<span class=normal> 292</span>
<span class=normal> 293</span>
<span class=normal> 294</span>
<span class=normal> 295</span>
<span class=normal> 296</span>
<span class=normal> 297</span>
<span class=normal> 298</span>
<span class=normal> 299</span>
<span class=normal> 300</span>
<span class=normal> 301</span>
<span class=normal> 302</span>
<span class=normal> 303</span>
<span class=normal> 304</span>
<span class=normal> 305</span>
<span class=normal> 306</span>
<span class=normal> 307</span>
<span class=normal> 308</span>
<span class=normal> 309</span>
<span class=normal> 310</span>
<span class=normal> 311</span>
<span class=normal> 312</span>
<span class=normal> 313</span>
<span class=normal> 314</span>
<span class=normal> 315</span>
<span class=normal> 316</span>
<span class=normal> 317</span>
<span class=normal> 318</span>
<span class=normal> 319</span>
<span class=normal> 320</span>
<span class=normal> 321</span>
<span class=normal> 322</span>
<span class=normal> 323</span>
<span class=normal> 324</span>
<span class=normal> 325</span>
<span class=normal> 326</span>
<span class=normal> 327</span>
<span class=normal> 328</span>
<span class=normal> 329</span>
<span class=normal> 330</span>
<span class=normal> 331</span>
<span class=normal> 332</span>
<span class=normal> 333</span>
<span class=normal> 334</span>
<span class=normal> 335</span>
<span class=normal> 336</span>
<span class=normal> 337</span>
<span class=normal> 338</span>
<span class=normal> 339</span>
<span class=normal> 340</span>
<span class=normal> 341</span>
<span class=normal> 342</span>
<span class=normal> 343</span>
<span class=normal> 344</span>
<span class=normal> 345</span>
<span class=normal> 346</span>
<span class=normal> 347</span>
<span class=normal> 348</span>
<span class=normal> 349</span>
<span class=normal> 350</span>
<span class=normal> 351</span>
<span class=normal> 352</span>
<span class=normal> 353</span>
<span class=normal> 354</span>
<span class=normal> 355</span>
<span class=normal> 356</span>
<span class=normal> 357</span>
<span class=normal> 358</span>
<span class=normal> 359</span>
<span class=normal> 360</span>
<span class=normal> 361</span>
<span class=normal> 362</span>
<span class=normal> 363</span>
<span class=normal> 364</span>
<span class=normal> 365</span>
<span class=normal> 366</span>
<span class=normal> 367</span>
<span class=normal> 368</span>
<span class=normal> 369</span>
<span class=normal> 370</span>
<span class=normal> 371</span>
<span class=normal> 372</span>
<span class=normal> 373</span>
<span class=normal> 374</span>
<span class=normal> 375</span>
<span class=normal> 376</span>
<span class=normal> 377</span>
<span class=normal> 378</span>
<span class=normal> 379</span>
<span class=normal> 380</span>
<span class=normal> 381</span>
<span class=normal> 382</span>
<span class=normal> 383</span>
<span class=normal> 384</span>
<span class=normal> 385</span>
<span class=normal> 386</span>
<span class=normal> 387</span>
<span class=normal> 388</span>
<span class=normal> 389</span>
<span class=normal> 390</span>
<span class=normal> 391</span>
<span class=normal> 392</span>
<span class=normal> 393</span>
<span class=normal> 394</span>
<span class=normal> 395</span>
<span class=normal> 396</span>
<span class=normal> 397</span>
<span class=normal> 398</span>
<span class=normal> 399</span>
<span class=normal> 400</span>
<span class=normal> 401</span>
<span class=normal> 402</span>
<span class=normal> 403</span>
<span class=normal> 404</span>
<span class=normal> 405</span>
<span class=normal> 406</span>
<span class=normal> 407</span>
<span class=normal> 408</span>
<span class=normal> 409</span>
<span class=normal> 410</span>
<span class=normal> 411</span>
<span class=normal> 412</span>
<span class=normal> 413</span>
<span class=normal> 414</span>
<span class=normal> 415</span>
<span class=normal> 416</span>
<span class=normal> 417</span>
<span class=normal> 418</span>
<span class=normal> 419</span>
<span class=normal> 420</span>
<span class=normal> 421</span>
<span class=normal> 422</span>
<span class=normal> 423</span>
<span class=normal> 424</span>
<span class=normal> 425</span>
<span class=normal> 426</span>
<span class=normal> 427</span>
<span class=normal> 428</span>
<span class=normal> 429</span>
<span class=normal> 430</span>
<span class=normal> 431</span>
<span class=normal> 432</span>
<span class=normal> 433</span>
<span class=normal> 434</span>
<span class=normal> 435</span>
<span class=normal> 436</span>
<span class=normal> 437</span>
<span class=normal> 438</span>
<span class=normal> 439</span>
<span class=normal> 440</span>
<span class=normal> 441</span>
<span class=normal> 442</span>
<span class=normal> 443</span>
<span class=normal> 444</span>
<span class=normal> 445</span>
<span class=normal> 446</span>
<span class=normal> 447</span>
<span class=normal> 448</span>
<span class=normal> 449</span>
<span class=normal> 450</span>
<span class=normal> 451</span>
<span class=normal> 452</span>
<span class=normal> 453</span>
<span class=normal> 454</span>
<span class=normal> 455</span>
<span class=normal> 456</span>
<span class=normal> 457</span>
<span class=normal> 458</span>
<span class=normal> 459</span>
<span class=normal> 460</span>
<span class=normal> 461</span>
<span class=normal> 462</span>
<span class=normal> 463</span>
<span class=normal> 464</span>
<span class=normal> 465</span>
<span class=normal> 466</span>
<span class=normal> 467</span>
<span class=normal> 468</span>
<span class=normal> 469</span>
<span class=normal> 470</span>
<span class=normal> 471</span>
<span class=normal> 472</span>
<span class=normal> 473</span>
<span class=normal> 474</span>
<span class=normal> 475</span>
<span class=normal> 476</span>
<span class=normal> 477</span>
<span class=normal> 478</span>
<span class=normal> 479</span>
<span class=normal> 480</span>
<span class=normal> 481</span>
<span class=normal> 482</span>
<span class=normal> 483</span>
<span class=normal> 484</span>
<span class=normal> 485</span>
<span class=normal> 486</span>
<span class=normal> 487</span>
<span class=normal> 488</span>
<span class=normal> 489</span>
<span class=normal> 490</span>
<span class=normal> 491</span>
<span class=normal> 492</span>
<span class=normal> 493</span>
<span class=normal> 494</span>
<span class=normal> 495</span>
<span class=normal> 496</span>
<span class=normal> 497</span>
<span class=normal> 498</span>
<span class=normal> 499</span>
<span class=normal> 500</span>
<span class=normal> 501</span>
<span class=normal> 502</span>
<span class=normal> 503</span>
<span class=normal> 504</span>
<span class=normal> 505</span>
<span class=normal> 506</span>
<span class=normal> 507</span>
<span class=normal> 508</span>
<span class=normal> 509</span>
<span class=normal> 510</span>
<span class=normal> 511</span>
<span class=normal> 512</span>
<span class=normal> 513</span>
<span class=normal> 514</span>
<span class=normal> 515</span>
<span class=normal> 516</span>
<span class=normal> 517</span>
<span class=normal> 518</span>
<span class=normal> 519</span>
<span class=normal> 520</span>
<span class=normal> 521</span>
<span class=normal> 522</span>
<span class=normal> 523</span>
<span class=normal> 524</span>
<span class=normal> 525</span>
<span class=normal> 526</span>
<span class=normal> 527</span>
<span class=normal> 528</span>
<span class=normal> 529</span>
<span class=normal> 530</span>
<span class=normal> 531</span>
<span class=normal> 532</span>
<span class=normal> 533</span>
<span class=normal> 534</span>
<span class=normal> 535</span>
<span class=normal> 536</span>
<span class=normal> 537</span>
<span class=normal> 538</span>
<span class=normal> 539</span>
<span class=normal> 540</span>
<span class=normal> 541</span>
<span class=normal> 542</span>
<span class=normal> 543</span>
<span class=normal> 544</span>
<span class=normal> 545</span>
<span class=normal> 546</span>
<span class=normal> 547</span>
<span class=normal> 548</span>
<span class=normal> 549</span>
<span class=normal> 550</span>
<span class=normal> 551</span>
<span class=normal> 552</span>
<span class=normal> 553</span>
<span class=normal> 554</span>
<span class=normal> 555</span>
<span class=normal> 556</span>
<span class=normal> 557</span>
<span class=normal> 558</span>
<span class=normal> 559</span>
<span class=normal> 560</span>
<span class=normal> 561</span>
<span class=normal> 562</span>
<span class=normal> 563</span>
<span class=normal> 564</span>
<span class=normal> 565</span>
<span class=normal> 566</span>
<span class=normal> 567</span>
<span class=normal> 568</span>
<span class=normal> 569</span>
<span class=normal> 570</span>
<span class=normal> 571</span>
<span class=normal> 572</span>
<span class=normal> 573</span>
<span class=normal> 574</span>
<span class=normal> 575</span>
<span class=normal> 576</span>
<span class=normal> 577</span>
<span class=normal> 578</span>
<span class=normal> 579</span>
<span class=normal> 580</span>
<span class=normal> 581</span>
<span class=normal> 582</span>
<span class=normal> 583</span>
<span class=normal> 584</span>
<span class=normal> 585</span>
<span class=normal> 586</span>
<span class=normal> 587</span>
<span class=normal> 588</span>
<span class=normal> 589</span>
<span class=normal> 590</span>
<span class=normal> 591</span>
<span class=normal> 592</span>
<span class=normal> 593</span>
<span class=normal> 594</span>
<span class=normal> 595</span>
<span class=normal> 596</span>
<span class=normal> 597</span>
<span class=normal> 598</span>
<span class=normal> 599</span>
<span class=normal> 600</span>
<span class=normal> 601</span>
<span class=normal> 602</span>
<span class=normal> 603</span>
<span class=normal> 604</span>
<span class=normal> 605</span>
<span class=normal> 606</span>
<span class=normal> 607</span>
<span class=normal> 608</span>
<span class=normal> 609</span>
<span class=normal> 610</span>
<span class=normal> 611</span>
<span class=normal> 612</span>
<span class=normal> 613</span>
<span class=normal> 614</span>
<span class=normal> 615</span>
<span class=normal> 616</span>
<span class=normal> 617</span>
<span class=normal> 618</span>
<span class=normal> 619</span>
<span class=normal> 620</span>
<span class=normal> 621</span>
<span class=normal> 622</span>
<span class=normal> 623</span>
<span class=normal> 624</span>
<span class=normal> 625</span>
<span class=normal> 626</span>
<span class=normal> 627</span>
<span class=normal> 628</span>
<span class=normal> 629</span>
<span class=normal> 630</span>
<span class=normal> 631</span>
<span class=normal> 632</span>
<span class=normal> 633</span>
<span class=normal> 634</span>
<span class=normal> 635</span>
<span class=normal> 636</span>
<span class=normal> 637</span>
<span class=normal> 638</span>
<span class=normal> 639</span>
<span class=normal> 640</span>
<span class=normal> 641</span>
<span class=normal> 642</span>
<span class=normal> 643</span>
<span class=normal> 644</span>
<span class=normal> 645</span>
<span class=normal> 646</span>
<span class=normal> 647</span>
<span class=normal> 648</span>
<span class=normal> 649</span>
<span class=normal> 650</span>
<span class=normal> 651</span>
<span class=normal> 652</span>
<span class=normal> 653</span>
<span class=normal> 654</span>
<span class=normal> 655</span>
<span class=normal> 656</span>
<span class=normal> 657</span>
<span class=normal> 658</span>
<span class=normal> 659</span>
<span class=normal> 660</span>
<span class=normal> 661</span>
<span class=normal> 662</span>
<span class=normal> 663</span>
<span class=normal> 664</span>
<span class=normal> 665</span>
<span class=normal> 666</span>
<span class=normal> 667</span>
<span class=normal> 668</span>
<span class=normal> 669</span>
<span class=normal> 670</span>
<span class=normal> 671</span>
<span class=normal> 672</span>
<span class=normal> 673</span>
<span class=normal> 674</span>
<span class=normal> 675</span>
<span class=normal> 676</span>
<span class=normal> 677</span>
<span class=normal> 678</span>
<span class=normal> 679</span>
<span class=normal> 680</span>
<span class=normal> 681</span>
<span class=normal> 682</span>
<span class=normal> 683</span>
<span class=normal> 684</span>
<span class=normal> 685</span>
<span class=normal> 686</span>
<span class=normal> 687</span>
<span class=normal> 688</span>
<span class=normal> 689</span>
<span class=normal> 690</span>
<span class=normal> 691</span>
<span class=normal> 692</span>
<span class=normal> 693</span>
<span class=normal> 694</span>
<span class=normal> 695</span>
<span class=normal> 696</span>
<span class=normal> 697</span>
<span class=normal> 698</span>
<span class=normal> 699</span>
<span class=normal> 700</span>
<span class=normal> 701</span>
<span class=normal> 702</span>
<span class=normal> 703</span>
<span class=normal> 704</span>
<span class=normal> 705</span>
<span class=normal> 706</span>
<span class=normal> 707</span>
<span class=normal> 708</span>
<span class=normal> 709</span>
<span class=normal> 710</span>
<span class=normal> 711</span>
<span class=normal> 712</span>
<span class=normal> 713</span>
<span class=normal> 714</span>
<span class=normal> 715</span>
<span class=normal> 716</span>
<span class=normal> 717</span>
<span class=normal> 718</span>
<span class=normal> 719</span>
<span class=normal> 720</span>
<span class=normal> 721</span>
<span class=normal> 722</span>
<span class=normal> 723</span>
<span class=normal> 724</span>
<span class=normal> 725</span>
<span class=normal> 726</span>
<span class=normal> 727</span>
<span class=normal> 728</span>
<span class=normal> 729</span>
<span class=normal> 730</span>
<span class=normal> 731</span>
<span class=normal> 732</span>
<span class=normal> 733</span>
<span class=normal> 734</span>
<span class=normal> 735</span>
<span class=normal> 736</span>
<span class=normal> 737</span>
<span class=normal> 738</span>
<span class=normal> 739</span>
<span class=normal> 740</span>
<span class=normal> 741</span>
<span class=normal> 742</span>
<span class=normal> 743</span>
<span class=normal> 744</span>
<span class=normal> 745</span>
<span class=normal> 746</span>
<span class=normal> 747</span>
<span class=normal> 748</span>
<span class=normal> 749</span>
<span class=normal> 750</span>
<span class=normal> 751</span>
<span class=normal> 752</span>
<span class=normal> 753</span>
<span class=normal> 754</span>
<span class=normal> 755</span>
<span class=normal> 756</span>
<span class=normal> 757</span>
<span class=normal> 758</span>
<span class=normal> 759</span>
<span class=normal> 760</span>
<span class=normal> 761</span>
<span class=normal> 762</span>
<span class=normal> 763</span>
<span class=normal> 764</span>
<span class=normal> 765</span>
<span class=normal> 766</span>
<span class=normal> 767</span>
<span class=normal> 768</span>
<span class=normal> 769</span>
<span class=normal> 770</span>
<span class=normal> 771</span>
<span class=normal> 772</span>
<span class=normal> 773</span>
<span class=normal> 774</span>
<span class=normal> 775</span>
<span class=normal> 776</span>
<span class=normal> 777</span>
<span class=normal> 778</span>
<span class=normal> 779</span>
<span class=normal> 780</span>
<span class=normal> 781</span>
<span class=normal> 782</span>
<span class=normal> 783</span>
<span class=normal> 784</span>
<span class=normal> 785</span>
<span class=normal> 786</span>
<span class=normal> 787</span>
<span class=normal> 788</span>
<span class=normal> 789</span>
<span class=normal> 790</span>
<span class=normal> 791</span>
<span class=normal> 792</span>
<span class=normal> 793</span>
<span class=normal> 794</span>
<span class=normal> 795</span>
<span class=normal> 796</span>
<span class=normal> 797</span>
<span class=normal> 798</span>
<span class=normal> 799</span>
<span class=normal> 800</span>
<span class=normal> 801</span>
<span class=normal> 802</span>
<span class=normal> 803</span>
<span class=normal> 804</span>
<span class=normal> 805</span>
<span class=normal> 806</span>
<span class=normal> 807</span>
<span class=normal> 808</span>
<span class=normal> 809</span>
<span class=normal> 810</span>
<span class=normal> 811</span>
<span class=normal> 812</span>
<span class=normal> 813</span>
<span class=normal> 814</span>
<span class=normal> 815</span>
<span class=normal> 816</span>
<span class=normal> 817</span>
<span class=normal> 818</span>
<span class=normal> 819</span>
<span class=normal> 820</span>
<span class=normal> 821</span>
<span class=normal> 822</span>
<span class=normal> 823</span>
<span class=normal> 824</span>
<span class=normal> 825</span>
<span class=normal> 826</span>
<span class=normal> 827</span>
<span class=normal> 828</span>
<span class=normal> 829</span>
<span class=normal> 830</span>
<span class=normal> 831</span>
<span class=normal> 832</span>
<span class=normal> 833</span>
<span class=normal> 834</span>
<span class=normal> 835</span>
<span class=normal> 836</span>
<span class=normal> 837</span>
<span class=normal> 838</span>
<span class=normal> 839</span>
<span class=normal> 840</span>
<span class=normal> 841</span>
<span class=normal> 842</span>
<span class=normal> 843</span>
<span class=normal> 844</span>
<span class=normal> 845</span>
<span class=normal> 846</span>
<span class=normal> 847</span>
<span class=normal> 848</span>
<span class=normal> 849</span>
<span class=normal> 850</span>
<span class=normal> 851</span>
<span class=normal> 852</span>
<span class=normal> 853</span>
<span class=normal> 854</span>
<span class=normal> 855</span>
<span class=normal> 856</span>
<span class=normal> 857</span>
<span class=normal> 858</span>
<span class=normal> 859</span>
<span class=normal> 860</span>
<span class=normal> 861</span>
<span class=normal> 862</span>
<span class=normal> 863</span>
<span class=normal> 864</span>
<span class=normal> 865</span>
<span class=normal> 866</span>
<span class=normal> 867</span>
<span class=normal> 868</span>
<span class=normal> 869</span>
<span class=normal> 870</span>
<span class=normal> 871</span>
<span class=normal> 872</span>
<span class=normal> 873</span>
<span class=normal> 874</span>
<span class=normal> 875</span>
<span class=normal> 876</span>
<span class=normal> 877</span>
<span class=normal> 878</span>
<span class=normal> 879</span>
<span class=normal> 880</span>
<span class=normal> 881</span>
<span class=normal> 882</span>
<span class=normal> 883</span>
<span class=normal> 884</span>
<span class=normal> 885</span>
<span class=normal> 886</span>
<span class=normal> 887</span>
<span class=normal> 888</span>
<span class=normal> 889</span>
<span class=normal> 890</span>
<span class=normal> 891</span>
<span class=normal> 892</span>
<span class=normal> 893</span>
<span class=normal> 894</span>
<span class=normal> 895</span>
<span class=normal> 896</span>
<span class=normal> 897</span>
<span class=normal> 898</span>
<span class=normal> 899</span>
<span class=normal> 900</span>
<span class=normal> 901</span>
<span class=normal> 902</span>
<span class=normal> 903</span>
<span class=normal> 904</span>
<span class=normal> 905</span>
<span class=normal> 906</span>
<span class=normal> 907</span>
<span class=normal> 908</span>
<span class=normal> 909</span>
<span class=normal> 910</span>
<span class=normal> 911</span>
<span class=normal> 912</span>
<span class=normal> 913</span>
<span class=normal> 914</span>
<span class=normal> 915</span>
<span class=normal> 916</span>
<span class=normal> 917</span>
<span class=normal> 918</span>
<span class=normal> 919</span>
<span class=normal> 920</span>
<span class=normal> 921</span>
<span class=normal> 922</span>
<span class=normal> 923</span>
<span class=normal> 924</span>
<span class=normal> 925</span>
<span class=normal> 926</span>
<span class=normal> 927</span>
<span class=normal> 928</span>
<span class=normal> 929</span>
<span class=normal> 930</span>
<span class=normal> 931</span>
<span class=normal> 932</span>
<span class=normal> 933</span>
<span class=normal> 934</span>
<span class=normal> 935</span>
<span class=normal> 936</span>
<span class=normal> 937</span>
<span class=normal> 938</span>
<span class=normal> 939</span>
<span class=normal> 940</span>
<span class=normal> 941</span>
<span class=normal> 942</span>
<span class=normal> 943</span>
<span class=normal> 944</span>
<span class=normal> 945</span>
<span class=normal> 946</span>
<span class=normal> 947</span>
<span class=normal> 948</span>
<span class=normal> 949</span>
<span class=normal> 950</span>
<span class=normal> 951</span>
<span class=normal> 952</span>
<span class=normal> 953</span>
<span class=normal> 954</span>
<span class=normal> 955</span>
<span class=normal> 956</span>
<span class=normal> 957</span>
<span class=normal> 958</span>
<span class=normal> 959</span>
<span class=normal> 960</span>
<span class=normal> 961</span>
<span class=normal> 962</span>
<span class=normal> 963</span>
<span class=normal> 964</span>
<span class=normal> 965</span>
<span class=normal> 966</span>
<span class=normal> 967</span>
<span class=normal> 968</span>
<span class=normal> 969</span>
<span class=normal> 970</span>
<span class=normal> 971</span>
<span class=normal> 972</span>
<span class=normal> 973</span>
<span class=normal> 974</span>
<span class=normal> 975</span>
<span class=normal> 976</span>
<span class=normal> 977</span>
<span class=normal> 978</span>
<span class=normal> 979</span>
<span class=normal> 980</span>
<span class=normal> 981</span>
<span class=normal> 982</span>
<span class=normal> 983</span>
<span class=normal> 984</span>
<span class=normal> 985</span>
<span class=normal> 986</span>
<span class=normal> 987</span>
<span class=normal> 988</span>
<span class=normal> 989</span>
<span class=normal> 990</span>
<span class=normal> 991</span>
<span class=normal> 992</span>
<span class=normal> 993</span>
<span class=normal> 994</span>
<span class=normal> 995</span>
<span class=normal> 996</span>
<span class=normal> 997</span>
<span class=normal> 998</span>
<span class=normal> 999</span>
<span class=normal>1000</span>
<span class=normal>1001</span>
<span class=normal>1002</span>
<span class=normal>1003</span>
<span class=normal>1004</span>
<span class=normal>1005</span>
<span class=normal>1006</span>
<span class=normal>1007</span>
<span class=normal>1008</span>
<span class=normal>1009</span>
<span class=normal>1010</span>
<span class=normal>1011</span>
<span class=normal>1012</span>
<span class=normal>1013</span>
<span class=normal>1014</span>
<span class=normal>1015</span>
<span class=normal>1016</span>
<span class=normal>1017</span>
<span class=normal>1018</span>
<span class=normal>1019</span>
<span class=normal>1020</span>
<span class=normal>1021</span>
<span class=normal>1022</span>
<span class=normal>1023</span>
<span class=normal>1024</span>
<span class=normal>1025</span>
<span class=normal>1026</span>
<span class=normal>1027</span>
<span class=normal>1028</span>
<span class=normal>1029</span>
<span class=normal>1030</span>
<span class=normal>1031</span>
<span class=normal>1032</span>
<span class=normal>1033</span>
<span class=normal>1034</span>
<span class=normal>1035</span>
<span class=normal>1036</span>
<span class=normal>1037</span>
<span class=normal>1038</span>
<span class=normal>1039</span>
<span class=normal>1040</span>
<span class=normal>1041</span>
<span class=normal>1042</span>
<span class=normal>1043</span>
<span class=normal>1044</span>
<span class=normal>1045</span>
<span class=normal>1046</span>
<span class=normal>1047</span>
<span class=normal>1048</span>
<span class=normal>1049</span>
<span class=normal>1050</span>
<span class=normal>1051</span>
<span class=normal>1052</span>
<span class=normal>1053</span>
<span class=normal>1054</span>
<span class=normal>1055</span>
<span class=normal>1056</span>
<span class=normal>1057</span>
<span class=normal>1058</span>
<span class=normal>1059</span>
<span class=normal>1060</span>
<span class=normal>1061</span>
<span class=normal>1062</span>
<span class=normal>1063</span>
<span class=normal>1064</span>
<span class=normal>1065</span>
<span class=normal>1066</span>
<span class=normal>1067</span>
<span class=normal>1068</span>
<span class=normal>1069</span>
<span class=normal>1070</span>
<span class=normal>1071</span>
<span class=normal>1072</span>
<span class=normal>1073</span>
<span class=normal>1074</span>
<span class=normal>1075</span>
<span class=normal>1076</span>
<span class=normal>1077</span>
<span class=normal>1078</span>
<span class=normal>1079</span>
<span class=normal>1080</span>
<span class=normal>1081</span>
<span class=normal>1082</span>
<span class=normal>1083</span>
<span class=normal>1084</span>
<span class=normal>1085</span>
<span class=normal>1086</span>
<span class=normal>1087</span>
<span class=normal>1088</span>
<span class=normal>1089</span>
<span class=normal>1090</span>
<span class=normal>1091</span>
<span class=normal>1092</span>
<span class=normal>1093</span>
<span class=normal>1094</span>
<span class=normal>1095</span>
<span class=normal>1096</span>
<span class=normal>1097</span>
<span class=normal>1098</span>
<span class=normal>1099</span>
<span class=normal>1100</span>
<span class=normal>1101</span>
<span class=normal>1102</span>
<span class=normal>1103</span>
<span class=normal>1104</span>
<span class=normal>1105</span>
<span class=normal>1106</span>
<span class=normal>1107</span>
<span class=normal>1108</span>
<span class=normal>1109</span>
<span class=normal>1110</span>
<span class=normal>1111</span>
<span class=normal>1112</span>
<span class=normal>1113</span>
<span class=normal>1114</span>
<span class=normal>1115</span>
<span class=normal>1116</span>
<span class=normal>1117</span>
<span class=normal>1118</span>
<span class=normal>1119</span>
<span class=normal>1120</span>
<span class=normal>1121</span>
<span class=normal>1122</span>
<span class=normal>1123</span>
<span class=normal>1124</span>
<span class=normal>1125</span>
<span class=normal>1126</span>
<span class=normal>1127</span>
<span class=normal>1128</span>
<span class=normal>1129</span>
<span class=normal>1130</span>
<span class=normal>1131</span>
<span class=normal>1132</span>
<span class=normal>1133</span>
<span class=normal>1134</span>
<span class=normal>1135</span>
<span class=normal>1136</span>
<span class=normal>1137</span>
<span class=normal>1138</span>
<span class=normal>1139</span>
<span class=normal>1140</span>
<span class=normal>1141</span>
<span class=normal>1142</span>
<span class=normal>1143</span>
<span class=normal>1144</span>
<span class=normal>1145</span>
<span class=normal>1146</span>
<span class=normal>1147</span>
<span class=normal>1148</span>
<span class=normal>1149</span>
<span class=normal>1150</span>
<span class=normal>1151</span>
<span class=normal>1152</span>
<span class=normal>1153</span>
<span class=normal>1154</span>
<span class=normal>1155</span>
<span class=normal>1156</span>
<span class=normal>1157</span>
<span class=normal>1158</span>
<span class=normal>1159</span>
<span class=normal>1160</span>
<span class=normal>1161</span>
<span class=normal>1162</span>
<span class=normal>1163</span>
<span class=normal>1164</span>
<span class=normal>1165</span>
<span class=normal>1166</span>
<span class=normal>1167</span>
<span class=normal>1168</span>
<span class=normal>1169</span>
<span class=normal>1170</span>
<span class=normal>1171</span>
<span class=normal>1172</span>
<span class=normal>1173</span>
<span class=normal>1174</span>
<span class=normal>1175</span>
<span class=normal>1176</span>
<span class=normal>1177</span>
<span class=normal>1178</span>
<span class=normal>1179</span>
<span class=normal>1180</span>
<span class=normal>1181</span>
<span class=normal>1182</span>
<span class=normal>1183</span>
<span class=normal>1184</span>
<span class=normal>1185</span>
<span class=normal>1186</span>
<span class=normal>1187</span>
<span class=normal>1188</span>
<span class=normal>1189</span>
<span class=normal>1190</span>
<span class=normal>1191</span>
<span class=normal>1192</span>
<span class=normal>1193</span>
<span class=normal>1194</span>
<span class=normal>1195</span>
<span class=normal>1196</span>
<span class=normal>1197</span>
<span class=normal>1198</span>
<span class=normal>1199</span>
<span class=normal>1200</span>
<span class=normal>1201</span>
<span class=normal>1202</span>
<span class=normal>1203</span>
<span class=normal>1204</span>
<span class=normal>1205</span>
<span class=normal>1206</span>
<span class=normal>1207</span>
<span class=normal>1208</span>
<span class=normal>1209</span>
<span class=normal>1210</span>
<span class=normal>1211</span>
<span class=normal>1212</span>
<span class=normal>1213</span>
<span class=normal>1214</span>
<span class=normal>1215</span>
<span class=normal>1216</span>
<span class=normal>1217</span>
<span class=normal>1218</span>
<span class=normal>1219</span>
<span class=normal>1220</span>
<span class=normal>1221</span>
<span class=normal>1222</span>
<span class=normal>1223</span>
<span class=normal>1224</span>
<span class=normal>1225</span>
<span class=normal>1226</span>
<span class=normal>1227</span>
<span class=normal>1228</span>
<span class=normal>1229</span>
<span class=normal>1230</span>
<span class=normal>1231</span>
<span class=normal>1232</span>
<span class=normal>1233</span>
<span class=normal>1234</span>
<span class=normal>1235</span>
<span class=normal>1236</span>
<span class=normal>1237</span>
<span class=normal>1238</span>
<span class=normal>1239</span>
<span class=normal>1240</span>
<span class=normal>1241</span>
<span class=normal>1242</span>
<span class=normal>1243</span>
<span class=normal>1244</span>
<span class=normal>1245</span>
<span class=normal>1246</span>
<span class=normal>1247</span>
<span class=normal>1248</span>
<span class=normal>1249</span>
<span class=normal>1250</span>
<span class=normal>1251</span>
<span class=normal>1252</span>
<span class=normal>1253</span>
<span class=normal>1254</span>
<span class=normal>1255</span>
<span class=normal>1256</span>
<span class=normal>1257</span>
<span class=normal>1258</span>
<span class=normal>1259</span>
<span class=normal>1260</span>
<span class=normal>1261</span>
<span class=normal>1262</span>
<span class=normal>1263</span>
<span class=normal>1264</span>
<span class=normal>1265</span>
<span class=normal>1266</span>
<span class=normal>1267</span>
<span class=normal>1268</span>
<span class=normal>1269</span>
<span class=normal>1270</span>
<span class=normal>1271</span>
<span class=normal>1272</span>
<span class=normal>1273</span>
<span class=normal>1274</span>
<span class=normal>1275</span>
<span class=normal>1276</span>
<span class=normal>1277</span>
<span class=normal>1278</span>
<span class=normal>1279</span>
<span class=normal>1280</span>
<span class=normal>1281</span>
<span class=normal>1282</span>
<span class=normal>1283</span>
<span class=normal>1284</span>
<span class=normal>1285</span>
<span class=normal>1286</span>
<span class=normal>1287</span>
<span class=normal>1288</span>
<span class=normal>1289</span>
<span class=normal>1290</span>
<span class=normal>1291</span>
<span class=normal>1292</span>
<span class=normal>1293</span>
<span class=normal>1294</span>
<span class=normal>1295</span>
<span class=normal>1296</span>
<span class=normal>1297</span>
<span class=normal>1298</span>
<span class=normal>1299</span>
<span class=normal>1300</span>
<span class=normal>1301</span>
<span class=normal>1302</span>
<span class=normal>1303</span>
<span class=normal>1304</span>
<span class=normal>1305</span>
<span class=normal>1306</span>
<span class=normal>1307</span>
<span class=normal>1308</span>
<span class=normal>1309</span>
<span class=normal>1310</span>
<span class=normal>1311</span>
<span class=normal>1312</span>
<span class=normal>1313</span>
<span class=normal>1314</span>
<span class=normal>1315</span>
<span class=normal>1316</span>
<span class=normal>1317</span>
<span class=normal>1318</span>
<span class=normal>1319</span>
<span class=normal>1320</span>
<span class=normal>1321</span>
<span class=normal>1322</span>
<span class=normal>1323</span>
<span class=normal>1324</span>
<span class=normal>1325</span>
<span class=normal>1326</span>
<span class=normal>1327</span>
<span class=normal>1328</span>
<span class=normal>1329</span>
<span class=normal>1330</span>
<span class=normal>1331</span>
<span class=normal>1332</span>
<span class=normal>1333</span>
<span class=normal>1334</span>
<span class=normal>1335</span>
<span class=normal>1336</span>
<span class=normal>1337</span>
<span class=normal>1338</span>
<span class=normal>1339</span>
<span class=normal>1340</span>
<span class=normal>1341</span>
<span class=normal>1342</span>
<span class=normal>1343</span>
<span class=normal>1344</span>
<span class=normal>1345</span>
<span class=normal>1346</span>
<span class=normal>1347</span>
<span class=normal>1348</span>
<span class=normal>1349</span>
<span class=normal>1350</span>
<span class=normal>1351</span>
<span class=normal>1352</span>
<span class=normal>1353</span>
<span class=normal>1354</span>
<span class=normal>1355</span>
<span class=normal>1356</span>
<span class=normal>1357</span>
<span class=normal>1358</span>
<span class=normal>1359</span>
<span class=normal>1360</span>
<span class=normal>1361</span>
<span class=normal>1362</span>
<span class=normal>1363</span>
<span class=normal>1364</span>
<span class=normal>1365</span>
<span class=normal>1366</span>
<span class=normal>1367</span>
<span class=normal>1368</span>
<span class=normal>1369</span>
<span class=normal>1370</span>
<span class=normal>1371</span>
<span class=normal>1372</span>
<span class=normal>1373</span>
<span class=normal>1374</span>
<span class=normal>1375</span>
<span class=normal>1376</span>
<span class=normal>1377</span>
<span class=normal>1378</span>
<span class=normal>1379</span>
<span class=normal>1380</span>
<span class=normal>1381</span>
<span class=normal>1382</span>
<span class=normal>1383</span>
<span class=normal>1384</span>
<span class=normal>1385</span>
<span class=normal>1386</span>
<span class=normal>1387</span>
<span class=normal>1388</span>
<span class=normal>1389</span>
<span class=normal>1390</span>
<span class=normal>1391</span>
<span class=normal>1392</span>
<span class=normal>1393</span>
<span class=normal>1394</span>
<span class=normal>1395</span>
<span class=normal>1396</span>
<span class=normal>1397</span>
<span class=normal>1398</span>
<span class=normal>1399</span>
<span class=normal>1400</span>
<span class=normal>1401</span>
<span class=normal>1402</span>
<span class=normal>1403</span>
<span class=normal>1404</span>
<span class=normal>1405</span>
<span class=normal>1406</span>
<span class=normal>1407</span>
<span class=normal>1408</span>
<span class=normal>1409</span>
<span class=normal>1410</span>
<span class=normal>1411</span>
<span class=normal>1412</span>
<span class=normal>1413</span>
<span class=normal>1414</span>
<span class=normal>1415</span>
<span class=normal>1416</span>
<span class=normal>1417</span>
<span class=normal>1418</span>
<span class=normal>1419</span>
<span class=normal>1420</span>
<span class=normal>1421</span>
<span class=normal>1422</span>
<span class=normal>1423</span>
<span class=normal>1424</span>
<span class=normal>1425</span>
<span class=normal>1426</span>
<span class=normal>1427</span>
<span class=normal>1428</span>
<span class=normal>1429</span>
<span class=normal>1430</span>
<span class=normal>1431</span>
<span class=normal>1432</span>
<span class=normal>1433</span>
<span class=normal>1434</span>
<span class=normal>1435</span>
<span class=normal>1436</span>
<span class=normal>1437</span>
<span class=normal>1438</span>
<span class=normal>1439</span>
<span class=normal>1440</span>
<span class=normal>1441</span>
<span class=normal>1442</span>
<span class=normal>1443</span>
<span class=normal>1444</span>
<span class=normal>1445</span>
<span class=normal>1446</span>
<span class=normal>1447</span>
<span class=normal>1448</span>
<span class=normal>1449</span>
<span class=normal>1450</span>
<span class=normal>1451</span>
<span class=normal>1452</span>
<span class=normal>1453</span>
<span class=normal>1454</span>
<span class=normal>1455</span>
<span class=normal>1456</span>
<span class=normal>1457</span>
<span class=normal>1458</span>
<span class=normal>1459</span>
<span class=normal>1460</span>
<span class=normal>1461</span>
<span class=normal>1462</span>
<span class=normal>1463</span>
<span class=normal>1464</span>
<span class=normal>1465</span>
<span class=normal>1466</span>
<span class=normal>1467</span>
<span class=normal>1468</span>
<span class=normal>1469</span>
<span class=normal>1470</span>
<span class=normal>1471</span>
<span class=normal>1472</span>
<span class=normal>1473</span>
<span class=normal>1474</span>
<span class=normal>1475</span>
<span class=normal>1476</span>
<span class=normal>1477</span>
<span class=normal>1478</span>
<span class=normal>1479</span>
<span class=normal>1480</span>
<span class=normal>1481</span>
<span class=normal>1482</span>
<span class=normal>1483</span>
<span class=normal>1484</span>
<span class=normal>1485</span>
<span class=normal>1486</span>
<span class=normal>1487</span>
<span class=normal>1488</span>
<span class=normal>1489</span>
<span class=normal>1490</span>
<span class=normal>1491</span>
<span class=normal>1492</span>
<span class=normal>1493</span>
<span class=normal>1494</span>
<span class=normal>1495</span>
<span class=normal>1496</span>
<span class=normal>1497</span>
<span class=normal>1498</span>
<span class=normal>1499</span>
<span class=normal>1500</span>
<span class=normal>1501</span>
<span class=normal>1502</span>
<span class=normal>1503</span>
<span class=normal>1504</span>
<span class=normal>1505</span>
<span class=normal>1506</span>
<span class=normal>1507</span>
<span class=normal>1508</span>
<span class=normal>1509</span>
<span class=normal>1510</span>
<span class=normal>1511</span>
<span class=normal>1512</span>
<span class=normal>1513</span>
<span class=normal>1514</span>
<span class=normal>1515</span>
<span class=normal>1516</span>
<span class=normal>1517</span>
<span class=normal>1518</span>
<span class=normal>1519</span>
<span class=normal>1520</span>
<span class=normal>1521</span>
<span class=normal>1522</span>
<span class=normal>1523</span>
<span class=normal>1524</span>
<span class=normal>1525</span>
<span class=normal>1526</span>
<span class=normal>1527</span>
<span class=normal>1528</span>
<span class=normal>1529</span>
<span class=normal>1530</span>
<span class=normal>1531</span>
<span class=normal>1532</span>
<span class=normal>1533</span>
<span class=normal>1534</span>
<span class=normal>1535</span>
<span class=normal>1536</span>
<span class=normal>1537</span>
<span class=normal>1538</span>
<span class=normal>1539</span>
<span class=normal>1540</span>
<span class=normal>1541</span>
<span class=normal>1542</span>
<span class=normal>1543</span>
<span class=normal>1544</span>
<span class=normal>1545</span>
<span class=normal>1546</span>
<span class=normal>1547</span>
<span class=normal>1548</span>
<span class=normal>1549</span>
<span class=normal>1550</span>
<span class=normal>1551</span>
<span class=normal>1552</span>
<span class=normal>1553</span>
<span class=normal>1554</span>
<span class=normal>1555</span>
<span class=normal>1556</span>
<span class=normal>1557</span>
<span class=normal>1558</span>
<span class=normal>1559</span>
<span class=normal>1560</span>
<span class=normal>1561</span>
<span class=normal>1562</span>
<span class=normal>1563</span>
<span class=normal>1564</span>
<span class=normal>1565</span>
<span class=normal>1566</span>
<span class=normal>1567</span>
<span class=normal>1568</span>
<span class=normal>1569</span>
<span class=normal>1570</span>
<span class=normal>1571</span>
<span class=normal>1572</span>
<span class=normal>1573</span>
<span class=normal>1574</span>
<span class=normal>1575</span>
<span class=normal>1576</span>
<span class=normal>1577</span>
<span class=normal>1578</span>
<span class=normal>1579</span>
<span class=normal>1580</span>
<span class=normal>1581</span>
<span class=normal>1582</span>
<span class=normal>1583</span>
<span class=normal>1584</span>
<span class=normal>1585</span>
<span class=normal>1586</span>
<span class=normal>1587</span>
<span class=normal>1588</span>
<span class=normal>1589</span>
<span class=normal>1590</span>
<span class=normal>1591</span>
<span class=normal>1592</span>
<span class=normal>1593</span>
<span class=normal>1594</span>
<span class=normal>1595</span>
<span class=normal>1596</span>
<span class=normal>1597</span>
<span class=normal>1598</span>
<span class=normal>1599</span>
<span class=normal>1600</span>
<span class=normal>1601</span>
<span class=normal>1602</span>
<span class=normal>1603</span>
<span class=normal>1604</span>
<span class=normal>1605</span>
<span class=normal>1606</span>
<span class=normal>1607</span>
<span class=normal>1608</span>
<span class=normal>1609</span>
<span class=normal>1610</span>
<span class=normal>1611</span>
<span class=normal>1612</span>
<span class=normal>1613</span>
<span class=normal>1614</span>
<span class=normal>1615</span>
<span class=normal>1616</span>
<span class=normal>1617</span>
<span class=normal>1618</span>
<span class=normal>1619</span>
<span class=normal>1620</span>
<span class=normal>1621</span>
<span class=normal>1622</span>
<span class=normal>1623</span>
<span class=normal>1624</span>
<span class=normal>1625</span>
<span class=normal>1626</span>
<span class=normal>1627</span>
<span class=normal>1628</span>
<span class=normal>1629</span>
<span class=normal>1630</span>
<span class=normal>1631</span>
<span class=normal>1632</span>
<span class=normal>1633</span>
<span class=normal>1634</span>
<span class=normal>1635</span>
<span class=normal>1636</span>
<span class=normal>1637</span>
<span class=normal>1638</span>
<span class=normal>1639</span>
<span class=normal>1640</span>
<span class=normal>1641</span>
<span class=normal>1642</span>
<span class=normal>1643</span>
<span class=normal>1644</span>
<span class=normal>1645</span>
<span class=normal>1646</span>
<span class=normal>1647</span>
<span class=normal>1648</span>
<span class=normal>1649</span>
<span class=normal>1650</span>
<span class=normal>1651</span>
<span class=normal>1652</span>
<span class=normal>1653</span>
<span class=normal>1654</span>
<span class=normal>1655</span>
<span class=normal>1656</span>
<span class=normal>1657</span>
<span class=normal>1658</span>
<span class=normal>1659</span>
<span class=normal>1660</span>
<span class=normal>1661</span>
<span class=normal>1662</span>
<span class=normal>1663</span>
<span class=normal>1664</span>
<span class=normal>1665</span>
<span class=normal>1666</span>
<span class=normal>1667</span>
<span class=normal>1668</span>
<span class=normal>1669</span>
<span class=normal>1670</span>
<span class=normal>1671</span>
<span class=normal>1672</span>
<span class=normal>1673</span>
<span class=normal>1674</span>
<span class=normal>1675</span>
<span class=normal>1676</span>
<span class=normal>1677</span>
<span class=normal>1678</span>
<span class=normal>1679</span>
<span class=normal>1680</span>
<span class=normal>1681</span>
<span class=normal>1682</span>
<span class=normal>1683</span>
<span class=normal>1684</span>
<span class=normal>1685</span>
<span class=normal>1686</span>
<span class=normal>1687</span>
<span class=normal>1688</span>
<span class=normal>1689</span>
<span class=normal>1690</span>
<span class=normal>1691</span>
<span class=normal>1692</span>
<span class=normal>1693</span>
<span class=normal>1694</span>
<span class=normal>1695</span>
<span class=normal>1696</span>
<span class=normal>1697</span>
<span class=normal>1698</span>
<span class=normal>1699</span>
<span class=normal>1700</span>
<span class=normal>1701</span>
<span class=normal>1702</span>
<span class=normal>1703</span>
<span class=normal>1704</span>
<span class=normal>1705</span>
<span class=normal>1706</span>
<span class=normal>1707</span>
<span class=normal>1708</span>
<span class=normal>1709</span>
<span class=normal>1710</span>
<span class=normal>1711</span>
<span class=normal>1712</span>
<span class=normal>1713</span>
<span class=normal>1714</span>
<span class=normal>1715</span>
<span class=normal>1716</span>
<span class=normal>1717</span>
<span class=normal>1718</span>
<span class=normal>1719</span>
<span class=normal>1720</span>
<span class=normal>1721</span>
<span class=normal>1722</span>
<span class=normal>1723</span>
<span class=normal>1724</span>
<span class=normal>1725</span>
<span class=normal>1726</span>
<span class=normal>1727</span>
<span class=normal>1728</span>
<span class=normal>1729</span>
<span class=normal>1730</span>
<span class=normal>1731</span>
<span class=normal>1732</span>
<span class=normal>1733</span>
<span class=normal>1734</span>
<span class=normal>1735</span>
<span class=normal>1736</span>
<span class=normal>1737</span>
<span class=normal>1738</span>
<span class=normal>1739</span>
<span class=normal>1740</span>
<span class=normal>1741</span>
<span class=normal>1742</span>
<span class=normal>1743</span>
<span class=normal>1744</span>
<span class=normal>1745</span>
<span class=normal>1746</span>
<span class=normal>1747</span>
<span class=normal>1748</span>
<span class=normal>1749</span>
<span class=normal>1750</span>
<span class=normal>1751</span>
<span class=normal>1752</span>
<span class=normal>1753</span>
<span class=normal>1754</span>
<span class=normal>1755</span>
<span class=normal>1756</span>
<span class=normal>1757</span>
<span class=normal>1758</span>
<span class=normal>1759</span>
<span class=normal>1760</span>
<span class=normal>1761</span>
<span class=normal>1762</span>
<span class=normal>1763</span>
<span class=normal>1764</span>
<span class=normal>1765</span>
<span class=normal>1766</span>
<span class=normal>1767</span>
<span class=normal>1768</span>
<span class=normal>1769</span>
<span class=normal>1770</span>
<span class=normal>1771</span>
<span class=normal>1772</span>
<span class=normal>1773</span>
<span class=normal>1774</span>
<span class=normal>1775</span>
<span class=normal>1776</span>
<span class=normal>1777</span>
<span class=normal>1778</span>
<span class=normal>1779</span>
<span class=normal>1780</span>
<span class=normal>1781</span>
<span class=normal>1782</span>
<span class=normal>1783</span>
<span class=normal>1784</span>
<span class=normal>1785</span>
<span class=normal>1786</span>
<span class=normal>1787</span>
<span class=normal>1788</span>
<span class=normal>1789</span>
<span class=normal>1790</span>
<span class=normal>1791</span>
<span class=normal>1792</span>
<span class=normal>1793</span>
<span class=normal>1794</span>
<span class=normal>1795</span>
<span class=normal>1796</span>
<span class=normal>1797</span>
<span class=normal>1798</span>
<span class=normal>1799</span>
<span class=normal>1800</span>
<span class=normal>1801</span>
<span class=normal>1802</span>
<span class=normal>1803</span>
<span class=normal>1804</span>
<span class=normal>1805</span>
<span class=normal>1806</span>
<span class=normal>1807</span>
<span class=normal>1808</span>
<span class=normal>1809</span>
<span class=normal>1810</span>
<span class=normal>1811</span>
<span class=normal>1812</span>
<span class=normal>1813</span>
<span class=normal>1814</span>
<span class=normal>1815</span>
<span class=normal>1816</span>
<span class=normal>1817</span>
<span class=normal>1818</span>
<span class=normal>1819</span>
<span class=normal>1820</span>
<span class=normal>1821</span>
<span class=normal>1822</span>
<span class=normal>1823</span>
<span class=normal>1824</span>
<span class=normal>1825</span>
<span class=normal>1826</span>
<span class=normal>1827</span>
<span class=normal>1828</span>
<span class=normal>1829</span>
<span class=normal>1830</span>
<span class=normal>1831</span>
<span class=normal>1832</span>
<span class=normal>1833</span>
<span class=normal>1834</span>
<span class=normal>1835</span>
<span class=normal>1836</span>
<span class=normal>1837</span>
<span class=normal>1838</span>
<span class=normal>1839</span>
<span class=normal>1840</span>
<span class=normal>1841</span>
<span class=normal>1842</span>
<span class=normal>1843</span>
<span class=normal>1844</span>
<span class=normal>1845</span>
<span class=normal>1846</span>
<span class=normal>1847</span>
<span class=normal>1848</span>
<span class=normal>1849</span>
<span class=normal>1850</span>
<span class=normal>1851</span>
<span class=normal>1852</span>
<span class=normal>1853</span>
<span class=normal>1854</span>
<span class=normal>1855</span>
<span class=normal>1856</span>
<span class=normal>1857</span>
<span class=normal>1858</span>
<span class=normal>1859</span>
<span class=normal>1860</span>
<span class=normal>1861</span>
<span class=normal>1862</span>
<span class=normal>1863</span>
<span class=normal>1864</span>
<span class=normal>1865</span>
<span class=normal>1866</span>
<span class=normal>1867</span>
<span class=normal>1868</span>
<span class=normal>1869</span>
<span class=normal>1870</span>
<span class=normal>1871</span>
<span class=normal>1872</span>
<span class=normal>1873</span>
<span class=normal>1874</span>
<span class=normal>1875</span>
<span class=normal>1876</span>
<span class=normal>1877</span>
<span class=normal>1878</span>
<span class=normal>1879</span>
<span class=normal>1880</span>
<span class=normal>1881</span>
<span class=normal>1882</span>
<span class=normal>1883</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>class</span><span class=w> </span><span class=nc>P4ConnectionManager</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    This class is the core of this module.</span>

<span class=sd>    It manages the connection and error handling</span>
<span class=sd>    when sending commands to p4 via P4Python.</span>

<span class=sd>    It does this by providing a number of convenience</span>
<span class=sd>    mechanisms to reduce boiler plate code.</span>
<span class=sd>    The main mechanism is the handling of methods</span>
<span class=sd>    which require a p4 connection.</span>
<span class=sd>    Any attribute that both has `_connect_` as a prefix</span>
<span class=sd>    and is a method, will lazily wrap said method with</span>
<span class=sd>    `__run_connect__` and remove the `_connect_` prefix.</span>

<span class=sd>    For example: `_connect_sync` will be accessed with `sync`.</span>

<span class=sd>    This offers multiple benefits:</span>

<span class=sd>    - core methods are marked as private.</span>
<span class=sd>    - wrapping of methods is handled lazily, thus is performant.</span>
<span class=sd>    - reduced verbosity of calling core method names.</span>

<span class=sd>    The `__run_connect__` wrapper works in conjunction with the</span>
<span class=sd>    `__connect__` context manager to automatically manage the</span>
<span class=sd>    p4.connect and p4.disconnect functionality.</span>
<span class=sd>    This is especially useful for nested `_connect_`</span>
<span class=sd>    method calls, as P4Python throws an exception if</span>
<span class=sd>    `p4.connect()` is called when an connection is already</span>
<span class=sd>    active.</span>

<span class=sd>    # *** Any method that requires a connection to p4,</span>
<span class=sd>    # must be declared with the prefix: `_connect_` ***</span>

<span class=sd>    The `__run_connect__` wrapper will also handle workspaces by</span>
<span class=sd>    attempting to run the given function in each workspace, returning</span>
<span class=sd>    as soon as the function runs successfully.</span>
<span class=sd>    The first workspace used will initially be the current workspace</span>
<span class=sd>    as defined by `p4.client`, and then it will be updated to</span>
<span class=sd>    the last workspace that a function was successfully run on.</span>
<span class=sd>    This should mean in most cases the function will only need to</span>
<span class=sd>    run the first time as most users pcs should be setup to have</span>
<span class=sd>    `p4.client` be their standard workspace, BUT if it fails, then</span>
<span class=sd>    the function will be run on all the other workspaces until it</span>
<span class=sd>    either succeeds or there are no workspaces left.</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=c1># Magic Methods:</span>
    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span>
        <span class=n>use_progress_hander</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span>
        <span class=n>started_fn</span><span class=p>:</span> <span class=n>Callable</span><span class=p>[[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>int</span><span class=p>],</span> <span class=kc>None</span><span class=p>]</span> <span class=o>|</span> <span class=kc>None</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
        <span class=n>total_set_fn</span><span class=p>:</span> <span class=n>Callable</span><span class=p>[[</span><span class=nb>int</span><span class=p>],</span> <span class=kc>None</span><span class=p>]</span> <span class=o>|</span> <span class=kc>None</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
        <span class=n>updated_fn</span><span class=p>:</span> <span class=n>Callable</span><span class=p>[[</span><span class=nb>int</span><span class=p>],</span> <span class=kc>None</span><span class=p>]</span> <span class=o>|</span> <span class=kc>None</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
        <span class=n>completed_fn</span><span class=p>:</span> <span class=n>Callable</span><span class=p>[[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>int</span><span class=p>],</span> <span class=kc>None</span><span class=p>]</span> <span class=o>|</span> <span class=kc>None</span> <span class=o>=</span> <span class=kc>None</span>
    <span class=p>):</span>

        <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=fm>__init__</span><span class=p>()</span>

        <span class=bp>self</span><span class=o>.</span><span class=n>_p4</span> <span class=o>=</span> <span class=kc>None</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_connection_depth</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>0</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_host_name</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span>

        <span class=bp>self</span><span class=o>.</span><span class=n>_is_offline</span> <span class=o>=</span> <span class=kc>False</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_retry_p4_connection</span> <span class=o>=</span> <span class=kc>False</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_offline_manager</span> <span class=o>=</span> <span class=kc>None</span>

        <span class=bp>self</span><span class=o>.</span><span class=n>_break_run_loop</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_run_successfully</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>result</span><span class=p>:</span> <span class=n>Any</span> <span class=o>=</span> <span class=kc>None</span>

        <span class=bp>self</span><span class=o>.</span><span class=n>_attribute_errors</span><span class=p>:</span> <span class=nb>set</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=nb>set</span><span class=p>()</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_path_existence_errors</span><span class=p>:</span> <span class=nb>set</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=nb>set</span><span class=p>()</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>__workspace_cache__</span><span class=p>:</span> <span class=nb>list</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=p>[]</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>__clients_cache__</span><span class=p>:</span> <span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span> <span class=o>|</span> <span class=kc>None</span> <span class=o>=</span> <span class=kc>None</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_workspace_errors</span><span class=p>:</span> <span class=nb>set</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=nb>set</span><span class=p>()</span>

        <span class=bp>self</span><span class=o>.</span><span class=n>_signaller</span> <span class=o>=</span> <span class=n>P4ConnectionManagerSignaller</span><span class=p>()</span>

        <span class=k>if</span> <span class=ow>not</span> <span class=n>use_progress_hander</span><span class=p>:</span>
            <span class=k>return</span>

        <span class=bp>self</span><span class=o>.</span><span class=n>_progress_handler</span> <span class=o>=</span> <span class=n>P4ProgressHandler</span><span class=p>(</span>
            <span class=n>started_fn</span><span class=o>=</span><span class=n>started_fn</span><span class=p>,</span>
            <span class=n>total_set_fn</span><span class=o>=</span><span class=n>total_set_fn</span><span class=p>,</span>
            <span class=n>updated_fn</span><span class=o>=</span><span class=n>updated_fn</span><span class=p>,</span>
            <span class=n>completed_fn</span><span class=o>=</span><span class=n>completed_fn</span><span class=p>,</span>
        <span class=p>)</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>p4</span><span class=o>.</span><span class=n>progress</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_progress_handler</span>

    <span class=k>def</span><span class=w> </span><span class=fm>__getattribute__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>attribute_name</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Any</span><span class=p>:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        This is a custom handler for attribute access.</span>

<span class=sd>        It allows methods that need wrapping with</span>
<span class=sd>        `__run_connect__` to be wrapped when first called.</span>
<span class=sd>        The alternative was for `__run_connect__` to exist</span>
<span class=sd>        outside of P4ConnectionManager, which seemed janky.</span>

<span class=sd>        A method with the prefix `_connect_` will be wrapped</span>
<span class=sd>        with `__run_connect__` when first called and then assigned</span>
<span class=sd>        back to the instance without the `_connect_` prefix.</span>
<span class=sd>        This provides lazy creation and exposure of core methods.</span>
<span class=sd>        For example:</span>
<span class=sd>        This will expose the wrapped version of: `_connect_checkout`,</span>
<span class=sd>        saving it as an attribute on the `P4ConnectionManager`</span>
<span class=sd>        instance, to provide a quicker look up if accessed again:</span>

<span class=sd>        ```</span>
<span class=sd>        cm = P4ConnectionManager()</span>
<span class=sd>        cm.checkout</span>
<span class=sd>        ```</span>

<span class=sd>        It is recommended to use the full method name when</span>
<span class=sd>        calling from within the object (include `_connect_` prefix).</span>
<span class=sd>        This avoids unneccesary connection checks, providing a slight</span>
<span class=sd>        performance boost. I.E:</span>
<span class=sd>        `self._connect_checkout` rather than `self.checkout`</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=k>try</span><span class=p>:</span>
            <span class=n>attribute</span> <span class=o>=</span> <span class=nb>object</span><span class=o>.</span><span class=fm>__getattribute__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>attribute_name</span><span class=p>)</span>
            <span class=k>return</span> <span class=n>attribute</span>

        <span class=k>except</span> <span class=ne>AttributeError</span><span class=p>:</span>
            <span class=n>attribute_name</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;_connect_</span><span class=si>{</span><span class=n>attribute_name</span><span class=si>}</span><span class=s2>&quot;</span>
            <span class=k>try</span><span class=p>:</span>
                <span class=n>attribute</span> <span class=o>=</span> <span class=nb>object</span><span class=o>.</span><span class=fm>__getattribute__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>attribute_name</span><span class=p>)</span>
                <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>attribute</span><span class=p>,</span> <span class=n>MethodType</span><span class=p>):</span>
                    <span class=n>__run_connect__</span> <span class=o>=</span> <span class=nb>object</span><span class=o>.</span><span class=fm>__getattribute__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=s2>&quot;__run_connect__&quot;</span><span class=p>)</span>
                    <span class=n>attribute</span> <span class=o>=</span> <span class=n>__run_connect__</span><span class=p>(</span><span class=n>attribute</span><span class=p>)</span>
                    <span class=nb>object</span><span class=o>.</span><span class=fm>__setattr__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>attribute_name</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&quot;_connect_&quot;</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>),</span> <span class=n>attribute</span><span class=p>)</span>

                <span class=k>return</span> <span class=n>attribute</span>

            <span class=k>except</span> <span class=ne>AttributeError</span><span class=p>:</span>
                <span class=n>_attribute_name</span> <span class=o>=</span> <span class=n>attribute_name</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&quot;_connect_&quot;</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>)</span>
                <span class=n>class_name</span> <span class=o>=</span> <span class=nb>object</span><span class=o>.</span><span class=fm>__getattribute__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=s2>&quot;__class__&quot;</span><span class=p>)</span><span class=o>.</span><span class=vm>__name__</span>
                <span class=k>raise</span> <span class=ne>AttributeError</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>class_name</span><span class=si>}</span><span class=s2> has no attribute: </span><span class=si>{</span><span class=n>_attribute_name</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>

    <span class=c1># Properties:</span>
    <span class=nd>@property</span>
    <span class=k>def</span><span class=w> </span><span class=nf>p4</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>P4</span><span class=o>.</span><span class=n>P4</span><span class=p>:</span>
        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_p4</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_p4</span> <span class=o>=</span> <span class=n>P4</span><span class=o>.</span><span class=n>P4</span><span class=p>()</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_p4</span>

    <span class=nd>@property</span>
    <span class=k>def</span><span class=w> </span><span class=nf>host_name</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>_host_name</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_host_name</span> <span class=o>=</span> <span class=n>socket</span><span class=o>.</span><span class=n>gethostname</span><span class=p>()</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_host_name</span>

    <span class=nd>@property</span>
    <span class=k>def</span><span class=w> </span><span class=nf>exceptions</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=k>return</span> <span class=n>p4_errors</span><span class=o>.</span><span class=n>P4Exceptions</span>

    <span class=nd>@property</span>
    <span class=k>def</span><span class=w> </span><span class=nf>is_offline</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_is_offline</span>

    <span class=nd>@property</span>
    <span class=k>def</span><span class=w> </span><span class=nf>offline_manager</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_offline_manager</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
            <span class=k>pass</span>
            <span class=c1># self._offline_manager = p4_offline.P4ConnectionManager()</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_offline_manager</span>

    <span class=nd>@property</span>
    <span class=k>def</span><span class=w> </span><span class=nf>_clients_cache</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]:</span>
        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>__clients_cache__</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
            <span class=n>host_name</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>host_name</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>__clients_cache__</span> <span class=o>=</span> <span class=p>{</span>
                <span class=n>client</span><span class=p>[</span><span class=s2>&quot;client&quot;</span><span class=p>]:</span> <span class=n>client</span>
                <span class=k>for</span> <span class=n>client</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>p4</span><span class=o>.</span><span class=n>run_clients</span><span class=p>(</span><span class=s2>&quot;--me&quot;</span><span class=p>)</span>
                <span class=k>if</span> <span class=n>client</span><span class=p>[</span><span class=s2>&quot;Host&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span> <span class=o>==</span> <span class=n>host_name</span>
            <span class=p>}</span>

        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>__clients_cache__</span>

    <span class=nd>@property</span>
    <span class=k>def</span><span class=w> </span><span class=nf>_workspace_cache</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>__workspace_cache__</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>__workspace_cache__</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_connect_get_workspaces</span><span class=p>()</span>

        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>__workspace_cache__</span>

    <span class=c1># Protected Methods:</span>
    <span class=nd>@contextmanager</span>
    <span class=k>def</span><span class=w> </span><span class=nf>__connect__</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Generator</span><span class=p>[</span><span class=n>P4</span><span class=o>.</span><span class=n>P4</span> <span class=o>|</span> <span class=kc>None</span><span class=p>,</span> <span class=kc>None</span><span class=p>,</span> <span class=kc>None</span><span class=p>]:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Context manager that connects to if not already connected p4,</span>
<span class=sd>        yielding the instance of p4 and closing the connection when done.</span>
<span class=sd>        &quot;&quot;&quot;</span>

        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_is_offline</span><span class=p>:</span>
            <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>_retry_p4_connection</span><span class=p>:</span>
                <span class=k>yield</span>
                <span class=k>return</span>

        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>p4</span><span class=o>.</span><span class=n>connected</span><span class=p>():</span>
            <span class=k>try</span><span class=p>:</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>p4</span><span class=o>.</span><span class=n>connect</span><span class=p>()</span>
                <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_is_offline</span><span class=p>:</span>
                    <span class=bp>self</span><span class=o>.</span><span class=n>_signaller</span><span class=o>.</span><span class=n>connected</span><span class=o>.</span><span class=n>emit</span><span class=p>()</span>
                    <span class=bp>self</span><span class=o>.</span><span class=n>_is_offline</span> <span class=o>=</span> <span class=kc>False</span>
            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>error</span><span class=p>:</span>
                <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>_is_p4_exception</span><span class=p>(</span><span class=n>error</span><span class=p>):</span>
                    <span class=k>raise</span>

                <span class=k>if</span> <span class=s2>&quot;[P4.connect()] Connect to server failed; check $P4PORT&quot;</span> <span class=ow>not</span> <span class=ow>in</span> <span class=nb>str</span><span class=p>(</span><span class=n>error</span><span class=p>):</span>
                    <span class=k>raise</span>

                <span class=bp>self</span><span class=o>.</span><span class=n>_is_offline</span> <span class=o>=</span> <span class=kc>True</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>_signaller</span><span class=o>.</span><span class=n>disconnected</span><span class=o>.</span><span class=n>emit</span><span class=p>()</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>_start_retry_p4_connection_timer</span><span class=p>()</span>
                <span class=k>yield</span>
                <span class=k>return</span>

        <span class=bp>self</span><span class=o>.</span><span class=n>_connection_depth</span> <span class=o>+=</span> <span class=mi>1</span>
        <span class=k>yield</span> <span class=bp>self</span><span class=o>.</span><span class=n>p4</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_connection_depth</span> <span class=o>-=</span> <span class=mi>1</span>
        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_connection_depth</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>__clients_cache__</span> <span class=o>=</span> <span class=kc>None</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_process_errors</span><span class=p>()</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_process_warnings</span><span class=p>()</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>p4</span><span class=o>.</span><span class=n>disconnect</span><span class=p>()</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_clear_errors</span><span class=p>()</span>

    <span class=k>def</span><span class=w> </span><span class=nf>__run_connect__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>function</span><span class=p>):</span>
        <span class=c1># type: (Callable[..., Any]) -&gt; Callable[..., Any]</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Decorator that connects to p4 before running a function.</span>

<span class=sd>        This is syntactic sugar to try and reduce indentation</span>
<span class=sd>        in a function body.</span>
<span class=sd>        Removing the need to use p4.connect in every function body:</span>

<span class=sd>        ```</span>
<span class=sd>        def function(self):</span>
<span class=sd>            with p4.connect():</span>
<span class=sd>                pass</span>
<span class=sd>        ```</span>

<span class=sd>        The intention is for this to work with P4ConnectionManager,</span>
<span class=sd>        it will not work with standard functions.</span>
<span class=sd>        &quot;&quot;&quot;</span>

        <span class=nd>@functools</span><span class=o>.</span><span class=n>wraps</span><span class=p>(</span><span class=n>function</span><span class=p>)</span>
        <span class=k>def</span><span class=w> </span><span class=nf>_connect</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
            <span class=c1># type: (Any, Any) -&gt; Any</span>
            <span class=n>workspace_override</span> <span class=o>=</span> <span class=kc>None</span>
            <span class=n>args_info</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_path_arg_info</span><span class=p>(</span><span class=n>function</span><span class=p>,</span> <span class=n>args</span><span class=p>)</span> <span class=k>if</span> <span class=n>args</span> <span class=k>else</span> <span class=p>(</span><span class=kc>None</span><span class=p>,</span> <span class=kc>False</span><span class=p>)</span>
            <span class=n>paths</span><span class=p>,</span> <span class=n>compile_result</span> <span class=o>=</span> <span class=n>args_info</span>
            <span class=n>paths</span><span class=p>,</span> <span class=n>args</span><span class=p>,</span> <span class=n>kwargs</span><span class=p>,</span> <span class=n>workspace_override</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_split_args</span><span class=p>(</span><span class=n>paths</span><span class=p>,</span> <span class=n>args</span><span class=p>,</span> <span class=n>kwargs</span><span class=p>)</span>

            <span class=k>with</span> <span class=bp>self</span><span class=o>.</span><span class=n>__connect__</span><span class=p>():</span>
                <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_is_offline</span><span class=p>:</span>
                    <span class=bp>self</span><span class=o>.</span><span class=n>__run_function_offline__</span><span class=p>(</span>
                        <span class=n>function</span><span class=p>,</span> <span class=n>paths</span><span class=p>,</span> <span class=n>compile_result</span><span class=p>,</span> <span class=n>args</span><span class=p>,</span> <span class=n>kwargs</span>
                    <span class=p>)</span>
                <span class=k>else</span><span class=p>:</span>
                    <span class=bp>self</span><span class=o>.</span><span class=n>_update_workspace_cache</span><span class=p>(</span><span class=n>workspace_override</span> <span class=ow>or</span> <span class=bp>self</span><span class=o>.</span><span class=n>p4</span><span class=o>.</span><span class=n>client</span><span class=p>)</span>
                    <span class=k>for</span> <span class=n>workspace</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>_workspace_cache</span><span class=p>:</span>
                        <span class=k>with</span> <span class=bp>self</span><span class=o>.</span><span class=n>workspace_as</span><span class=p>(</span><span class=n>workspace</span><span class=p>):</span>
                            <span class=bp>self</span><span class=o>.</span><span class=n>__run_function__</span><span class=p>(</span>
                                <span class=n>function</span><span class=p>,</span> <span class=n>paths</span><span class=p>,</span> <span class=n>workspace</span><span class=p>,</span> <span class=n>compile_result</span><span class=p>,</span> <span class=n>args</span><span class=p>,</span> <span class=n>kwargs</span>
                            <span class=p>)</span>
                            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_break_run_loop</span><span class=p>:</span>
                                <span class=k>break</span>

            <span class=k>if</span> <span class=n>compile_result</span><span class=p>:</span>
                <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>result</span>

            <span class=n>_result</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>result</span>
            <span class=k>if</span> <span class=ow>not</span> <span class=n>_result</span><span class=p>:</span>
                <span class=k>return</span> <span class=n>_result</span>

            <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>_result</span><span class=p>,</span> <span class=nb>dict</span><span class=p>):</span>
                <span class=n>_result</span> <span class=o>=</span> <span class=nb>tuple</span><span class=p>(</span><span class=n>_result</span><span class=o>.</span><span class=n>values</span><span class=p>())</span>

            <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>_result</span><span class=p>,</span> <span class=p>(</span><span class=nb>list</span><span class=p>,</span> <span class=nb>tuple</span><span class=p>))</span> <span class=ow>and</span> <span class=nb>len</span><span class=p>(</span><span class=n>_result</span><span class=p>)</span> <span class=o>==</span> <span class=mi>1</span><span class=p>:</span>
                <span class=k>return</span> <span class=n>_result</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>

            <span class=k>return</span> <span class=n>_result</span>

        <span class=k>return</span> <span class=n>_connect</span>

    <span class=k>def</span><span class=w> </span><span class=nf>__run_function__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>function</span><span class=p>,</span> <span class=n>paths</span><span class=p>,</span> <span class=n>workspace</span><span class=p>,</span> <span class=n>compile_result</span><span class=p>,</span> <span class=n>args</span><span class=p>,</span> <span class=n>kwargs</span><span class=p>):</span>
        <span class=c1># type: (Callable[..., Any], tuple[str, ...] | None, str, bool, tuple[Any], dict[str, Any]) -&gt; None</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>result</span> <span class=o>=</span> <span class=kc>None</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_break_run_loop</span> <span class=o>=</span> <span class=kc>False</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_run_successfully</span> <span class=o>=</span> <span class=kc>False</span>
        <span class=k>try</span><span class=p>:</span>
            <span class=k>if</span> <span class=n>paths</span> <span class=ow>and</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>_are_paths_valid</span><span class=p>(</span><span class=n>paths</span><span class=p>,</span> <span class=n>workspace</span><span class=p>):</span>
                <span class=k>return</span>

            <span class=n>is_get_stat</span> <span class=o>=</span> <span class=n>function</span> <span class=o>==</span> <span class=bp>self</span><span class=o>.</span><span class=n>_connect_get_stat</span>
            <span class=n>result</span> <span class=o>=</span> <span class=n>function</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>  <span class=c1># type: Any</span>
            <span class=k>if</span> <span class=n>is_get_stat</span><span class=p>:</span>
                <span class=n>result</span> <span class=o>=</span> <span class=p>(</span><span class=n>result</span><span class=p>,</span> <span class=p>)</span> <span class=k>if</span> <span class=n>paths</span> <span class=ow>and</span> <span class=nb>len</span><span class=p>(</span><span class=n>paths</span><span class=p>)</span> <span class=o>==</span> <span class=mi>1</span> <span class=ow>and</span> <span class=n>paths</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>endswith</span><span class=p>(</span><span class=s2>&quot;...&quot;</span><span class=p>)</span> <span class=k>else</span> <span class=n>result</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>result</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_compile_result</span><span class=p>(</span><span class=n>compile_result</span><span class=p>,</span> <span class=n>paths</span><span class=p>,</span> <span class=n>result</span><span class=p>)</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_run_successfully</span> <span class=o>=</span> <span class=kc>True</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_break_run_loop</span> <span class=o>=</span> <span class=kc>True</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_update_workspace_cache</span><span class=p>(</span><span class=n>workspace</span><span class=p>)</span>
            <span class=k>return</span>

        <span class=k>except</span> <span class=n>p4_errors</span><span class=o>.</span><span class=n>P4PathDoesNotExistError</span> <span class=k>as</span> <span class=n>error</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_path_existence_errors</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>error</span><span class=p>))</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_break_run_loop</span> <span class=o>=</span> <span class=kc>True</span>
            <span class=k>return</span>

        <span class=k>except</span> <span class=ne>AttributeError</span> <span class=k>as</span> <span class=n>error</span><span class=p>:</span>
            <span class=k>if</span> <span class=s2>&quot;has no attribute&quot;</span> <span class=ow>in</span> <span class=nb>str</span><span class=p>(</span><span class=n>error</span><span class=p>):</span>
                <span class=k>raise</span>

            <span class=k>raise</span> <span class=ne>AttributeError</span><span class=p>(</span><span class=s2>&quot;P4.P4 has no attribute: &#39;</span><span class=si>{0}</span><span class=s2>&#39; &quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>error</span><span class=p>))</span>

        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>error</span><span class=p>:</span>
            <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>_is_p4_exception</span><span class=p>(</span><span class=n>error</span><span class=p>):</span>
                <span class=k>raise</span>

            <span class=c1># @sharkmob-shea.richardson:</span>
            <span class=c1># As there are self.p4.warnings we can assume the</span>
            <span class=c1># function ran correclty but it has triggered a warning.</span>
            <span class=c1># This normally indicates that the correct workspace</span>
            <span class=c1># has been used but there is an issue with the operation</span>
            <span class=c1># so let&#39;s break out of the loop:</span>
            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>p4</span><span class=o>.</span><span class=n>warnings</span><span class=p>:</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>_run_successfully</span> <span class=o>=</span> <span class=kc>True</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>_break_run_loop</span> <span class=o>=</span> <span class=kc>True</span>
                <span class=k>return</span>
            <span class=nb>print</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>error</span><span class=p>))</span>

        <span class=k>return</span>

    <span class=k>def</span><span class=w> </span><span class=nf>__run_function_offline__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>function</span><span class=p>,</span> <span class=n>paths</span><span class=p>,</span> <span class=n>compile_result</span><span class=p>,</span> <span class=n>args</span><span class=p>,</span> <span class=n>kwargs</span><span class=p>):</span>
        <span class=c1># type: (Callable[..., Any], tuple[str, ...] | None, bool, tuple[Any], dict[str, Any]) -&gt; None</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>result</span> <span class=o>=</span> <span class=kc>None</span>
        <span class=n>result</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>offline_manager</span><span class=o>.</span><span class=n>run_function</span><span class=p>(</span><span class=n>function</span><span class=p>,</span> <span class=n>args</span><span class=p>,</span> <span class=n>kwargs</span><span class=p>)</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>result</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_compile_result</span><span class=p>(</span><span class=n>compile_result</span><span class=p>,</span> <span class=n>paths</span><span class=p>,</span> <span class=n>result</span><span class=p>)</span>

    <span class=c1># Private Methods:</span>
    <span class=nd>@staticmethod</span>
    <span class=k>def</span><span class=w> </span><span class=nf>_get_valid_path_objects</span><span class=p>(</span><span class=n>_paths</span><span class=p>:</span> <span class=n>P4PathType</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>list</span><span class=p>[</span><span class=n>pathlib</span><span class=o>.</span><span class=n>Path</span><span class=p>]:</span>
        <span class=k>def</span><span class=w> </span><span class=nf>_is_valid_path</span><span class=p>(</span><span class=n>_path</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>pathlib</span><span class=o>.</span><span class=n>Path</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
            <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>_path</span><span class=p>,</span> <span class=nb>str</span><span class=p>):</span>
                <span class=n>_path</span> <span class=o>=</span> <span class=n>pathlib</span><span class=o>.</span><span class=n>Path</span><span class=p>(</span><span class=n>_path</span><span class=p>)</span><span class=o>.</span><span class=n>anchor</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span>

            <span class=n>_path_anchor_lower</span> <span class=o>=</span> <span class=n>_path</span><span class=o>.</span><span class=n>anchor</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span>
            <span class=k>if</span> <span class=p>(</span>
                <span class=ow>not</span> <span class=n>_path_anchor_lower</span><span class=p>[</span><span class=mi>1</span><span class=p>:]</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=s2>&quot;:</span><span class=se>\\</span><span class=s2>&quot;</span><span class=p>)</span> <span class=ow>and</span>
                <span class=ow>not</span> <span class=n>_path_anchor_lower</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=s2>&quot;</span><span class=se>\\\\</span><span class=s2>&quot;</span><span class=p>)</span>
            <span class=p>):</span>
                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Path is invalid: </span><span class=si>{</span><span class=n>_path</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
                <span class=k>return</span> <span class=kc>False</span>

            <span class=k>return</span> <span class=kc>True</span>

        <span class=n>path_objects</span> <span class=o>=</span> <span class=p>(</span>
            <span class=p>(</span><span class=n>pathlib</span><span class=o>.</span><span class=n>Path</span><span class=p>(</span><span class=n>_path</span><span class=p>)</span> <span class=k>for</span> <span class=n>_path</span> <span class=ow>in</span> <span class=p>[</span><span class=n>_paths</span><span class=p>])</span>
            <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>_paths</span><span class=p>,</span> <span class=p>(</span><span class=nb>str</span><span class=p>,</span> <span class=n>pathlib</span><span class=o>.</span><span class=n>Path</span><span class=p>))</span>
            <span class=k>else</span> <span class=p>(</span><span class=n>pathlib</span><span class=o>.</span><span class=n>Path</span><span class=p>(</span><span class=n>_path</span><span class=p>)</span> <span class=k>for</span> <span class=n>_path</span> <span class=ow>in</span> <span class=n>_paths</span><span class=p>)</span>
        <span class=p>)</span>

        <span class=n>valid_paths</span> <span class=o>=</span> <span class=p>[</span><span class=n>path</span> <span class=k>for</span> <span class=n>path</span> <span class=ow>in</span> <span class=n>path_objects</span> <span class=k>if</span> <span class=n>_is_valid_path</span><span class=p>(</span><span class=n>path</span><span class=p>)]</span>
        <span class=k>return</span> <span class=n>valid_paths</span>

    <span class=nd>@staticmethod</span>
    <span class=k>def</span><span class=w> </span><span class=nf>_get_correct_p4_paths</span><span class=p>(</span>
        <span class=n>_paths</span><span class=p>:</span> <span class=nb>list</span><span class=p>[</span><span class=n>pathlib</span><span class=o>.</span><span class=n>Path</span><span class=p>],</span>
    <span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>tuple</span><span class=p>[</span><span class=nb>str</span><span class=p>]:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Test if the path exists test if it is a file.</span>
<span class=sd>            If the path doesn&#39;t exist and has an extension, then assume it is a file.</span>
<span class=sd>            This is to try and figure out if the path is a folder and append &quot;/...&quot; if so</span>
<span class=sd>        &quot;&quot;&quot;</span>

        <span class=n>out_paths</span><span class=p>:</span> <span class=nb>list</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=p>[]</span>
        <span class=k>for</span> <span class=n>_path</span> <span class=ow>in</span> <span class=n>_paths</span><span class=p>:</span>
            <span class=c1># Already declared as a directory:</span>
            <span class=n>_path_str</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>_path</span><span class=p>)</span>
            <span class=k>if</span> <span class=n>_path_str</span><span class=o>.</span><span class=n>endswith</span><span class=p>(</span><span class=s2>&quot;</span><span class=se>\\</span><span class=s2>...&quot;</span><span class=p>):</span>
                <span class=n>out_paths</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>_path_str</span><span class=p>)</span>
                <span class=k>continue</span>

            <span class=c1># A depot path:</span>
            <span class=k>if</span> <span class=n>_path_str</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=s2>&quot;</span><span class=se>\\\\</span><span class=s2>&quot;</span><span class=p>):</span>
                <span class=k>if</span> <span class=ow>not</span> <span class=n>_path</span><span class=o>.</span><span class=n>suffix</span><span class=p>:</span>
                    <span class=n>_path_str</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>_path_str</span><span class=si>}</span><span class=se>\\</span><span class=s2>...&quot;</span>

                <span class=n>_path_str</span> <span class=o>=</span> <span class=n>_path_str</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&quot;</span><span class=se>\\</span><span class=s2>&quot;</span><span class=p>,</span> <span class=s2>&quot;/&quot;</span><span class=p>)</span>
                <span class=n>out_paths</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>_path_str</span><span class=p>)</span>
                <span class=k>continue</span>

            <span class=n>is_file</span> <span class=o>=</span> <span class=kc>True</span> <span class=k>if</span> <span class=n>_path</span><span class=o>.</span><span class=n>exists</span><span class=p>()</span> <span class=ow>and</span> <span class=n>_path</span><span class=o>.</span><span class=n>is_file</span><span class=p>()</span> <span class=k>else</span> <span class=n>_path</span><span class=o>.</span><span class=n>suffix</span>
            <span class=n>out_paths</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>_path_str</span> <span class=k>if</span> <span class=n>is_file</span> <span class=k>else</span> <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>_path</span><span class=si>}</span><span class=se>\\</span><span class=s2>...&quot;</span><span class=p>)</span>

        <span class=k>return</span> <span class=nb>tuple</span><span class=p>(</span><span class=n>out_paths</span><span class=p>)</span>

    <span class=nd>@staticmethod</span>
    <span class=k>def</span><span class=w> </span><span class=nf>_is_file_checked_out_by_current_user</span><span class=p>(</span><span class=n>data</span><span class=p>:</span> <span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
        <span class=k>if</span> <span class=s2>&quot;action&quot;</span> <span class=ow>in</span> <span class=n>data</span> <span class=ow>and</span> <span class=n>data</span><span class=p>[</span><span class=s2>&quot;action&quot;</span><span class=p>]</span> <span class=o>==</span> <span class=s2>&quot;add&quot;</span><span class=p>:</span>
            <span class=k>return</span> <span class=kc>True</span>
        <span class=k>if</span> <span class=s2>&quot;action&quot;</span> <span class=ow>in</span> <span class=n>data</span> <span class=ow>and</span> <span class=n>data</span><span class=p>[</span><span class=s2>&quot;action&quot;</span><span class=p>]</span> <span class=o>==</span> <span class=s2>&quot;edit&quot;</span><span class=p>:</span>
            <span class=k>return</span> <span class=kc>True</span>

        <span class=k>return</span> <span class=kc>False</span>

    <span class=nd>@staticmethod</span>
    <span class=k>def</span><span class=w> </span><span class=nf>_compile_result</span><span class=p>(</span><span class=n>compile_result</span><span class=p>,</span> <span class=n>paths</span><span class=p>,</span> <span class=n>result</span><span class=p>):</span>
        <span class=c1># type: (bool, tuple[str] | None, Any | None) -&gt; Any</span>
        <span class=k>if</span> <span class=n>compile_result</span> <span class=ow>and</span> <span class=n>paths</span> <span class=ow>and</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>result</span><span class=p>,</span> <span class=n>col_abc</span><span class=o>.</span><span class=n>Iterable</span><span class=p>):</span>
            <span class=n>result</span> <span class=o>=</span> <span class=p>{</span><span class=n>path</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&quot;</span><span class=se>\\</span><span class=s2>...&quot;</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>):</span> <span class=n>data</span> <span class=k>for</span> <span class=n>path</span><span class=p>,</span> <span class=n>data</span> <span class=ow>in</span> <span class=nb>zip</span><span class=p>(</span><span class=n>paths</span><span class=p>,</span> <span class=n>result</span><span class=p>)}</span>

        <span class=k>return</span> <span class=n>result</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_get_clean_p4_paths</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>paths</span><span class=p>:</span> <span class=n>Iterable</span><span class=p>[</span><span class=nb>str</span><span class=p>]):</span>
        <span class=n>valid_paths</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_valid_path_objects</span><span class=p>(</span><span class=n>paths</span><span class=p>)</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_correct_p4_paths</span><span class=p>(</span><span class=n>valid_paths</span><span class=p>)</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_split_args</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>paths</span><span class=p>,</span> <span class=n>args</span><span class=p>,</span> <span class=n>kwargs</span><span class=p>):</span>
        <span class=c1># type: (tuple[str, ...] | None, tuple[Any, ...], dict[str, Any]) -&gt; tuple[tuple[str,...] | None, tuple[Any, ...], dict[str, Any], str | None]  # noqa</span>
        <span class=k>if</span> <span class=n>paths</span><span class=p>:</span>
            <span class=n>valid_paths</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_valid_path_objects</span><span class=p>(</span><span class=n>paths</span><span class=p>)</span>
            <span class=n>paths</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_correct_p4_paths</span><span class=p>(</span><span class=n>valid_paths</span><span class=p>)</span>
            <span class=n>_args</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span><span class=n>args</span><span class=p>[</span><span class=mi>1</span><span class=p>:])</span>
            <span class=n>_args</span><span class=o>.</span><span class=n>insert</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>paths</span><span class=p>)</span>
            <span class=n>args</span> <span class=o>=</span> <span class=nb>tuple</span><span class=p>(</span><span class=n>_args</span><span class=p>)</span>

        <span class=n>workspace</span> <span class=o>=</span> <span class=kc>None</span>
        <span class=k>if</span> <span class=s2>&quot;workspace_override&quot;</span> <span class=ow>in</span> <span class=n>kwargs</span><span class=p>:</span>
            <span class=n>workspace</span> <span class=o>=</span> <span class=n>kwargs</span><span class=o>.</span><span class=n>pop</span><span class=p>(</span><span class=s2>&quot;workspace_override&quot;</span><span class=p>)</span>
            <span class=k>assert</span> <span class=n>workspace</span> <span class=ow>is</span> <span class=kc>None</span> <span class=ow>or</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>workspace</span><span class=p>,</span> <span class=nb>str</span><span class=p>),</span> <span class=p>(</span>
                <span class=s2>&quot;workspace_override must be a string - got: </span><span class=si>{0}</span><span class=s2> of type: </span><span class=si>{1}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
                    <span class=n>workspace</span><span class=p>,</span> <span class=nb>type</span><span class=p>(</span><span class=n>workspace</span><span class=p>)</span>
                <span class=p>)</span>
            <span class=p>)</span>

        <span class=k>return</span> <span class=n>paths</span><span class=p>,</span> <span class=n>args</span><span class=p>,</span> <span class=n>kwargs</span><span class=p>,</span> <span class=n>workspace</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_are_paths_valid</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>paths</span><span class=p>,</span> <span class=n>workspace</span><span class=p>):</span>
        <span class=c1># type: (tuple[Any, ...], str) -&gt; bool</span>
        <span class=n>paths</span> <span class=o>=</span> <span class=n>make_tuple_if_not</span><span class=p>(</span><span class=n>paths</span><span class=p>)</span>
        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_are_paths_under_root</span><span class=p>(</span><span class=n>workspace</span><span class=p>,</span> <span class=n>paths</span><span class=p>):</span>
            <span class=k>return</span> <span class=kc>True</span>

        <span class=k>for</span> <span class=n>path</span> <span class=ow>in</span> <span class=n>paths</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_workspace_errors</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>path</span><span class=p>))</span>

        <span class=k>return</span> <span class=kc>False</span>

    <span class=nd>@lru_cache</span><span class=p>(</span><span class=n>maxsize</span><span class=o>=</span><span class=mi>64</span><span class=p>)</span>
    <span class=k>def</span><span class=w> </span><span class=nf>_get_workspace_roots</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>workspace</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>tuple</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>str</span><span class=p>]:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Get the roots of the given workspace&quot;&quot;&quot;</span>

        <span class=k>if</span> <span class=n>workspace</span> <span class=ow>not</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>_clients_cache</span><span class=p>:</span>
            <span class=c1># @sharkmob-shea.richardson:</span>
            <span class=c1># Raise a P4Exception. If within the connect loop, will continue</span>
            <span class=c1># to the next workspace. If in a standalone function will raise a</span>
            <span class=c1># valid error. This handles the bug where client name is provided</span>
            <span class=c1># instead of a valid workspace name.</span>
            <span class=c1># This is a workaround rather than a fix as it is really hard to debug:</span>
            <span class=k>raise</span> <span class=n>P4</span><span class=o>.</span><span class=n>P4Exception</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Invalid workspace name provided: &#39;</span><span class=si>{</span><span class=n>workspace</span><span class=si>}</span><span class=s2>&#39;&quot;</span><span class=p>)</span>

        <span class=n>client</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_clients_cache</span><span class=p>[</span><span class=n>workspace</span><span class=p>]</span>
        <span class=k>assert</span> <span class=s2>&quot;Root&quot;</span> <span class=ow>in</span> <span class=n>client</span><span class=p>,</span> <span class=p>(</span>
            <span class=sa>f</span><span class=s2>&quot;&#39;Root&#39; not found for workspace: &#39;</span><span class=si>{</span><span class=n>workspace</span><span class=si>}</span><span class=s2>&#39;&#39; - it is likely a dead!:</span><span class=se>\n</span><span class=si>{</span><span class=n>client</span><span class=si>}</span><span class=s2>&quot;</span>
        <span class=p>)</span>
        <span class=n>client_root</span> <span class=o>=</span> <span class=n>client</span><span class=p>[</span><span class=s2>&quot;Root&quot;</span><span class=p>]</span>
        <span class=n>server_info</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_connect_get_path_info</span><span class=p>([</span><span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>client_root</span><span class=si>}</span><span class=se>\\</span><span class=s2>...&quot;</span><span class=p>])[</span><span class=mi>0</span><span class=p>]</span>
        <span class=n>server_root</span> <span class=o>=</span> <span class=n>server_info</span><span class=p>[</span><span class=s2>&quot;depotFile&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>rstrip</span><span class=p>(</span><span class=s2>&quot;...&quot;</span><span class=p>)</span>
        <span class=k>return</span> <span class=p>(</span>
            <span class=nb>str</span><span class=p>(</span><span class=n>pathlib</span><span class=o>.</span><span class=n>Path</span><span class=p>(</span><span class=n>client_root</span><span class=p>))</span><span class=o>.</span><span class=n>lower</span><span class=p>(),</span>
            <span class=nb>str</span><span class=p>(</span><span class=n>pathlib</span><span class=o>.</span><span class=n>Path</span><span class=p>(</span><span class=n>server_root</span><span class=p>))</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span>
        <span class=p>)</span>

    <span class=nd>@lru_cache</span><span class=p>(</span><span class=n>maxsize</span><span class=o>=</span><span class=mi>64</span><span class=p>)</span>
    <span class=k>def</span><span class=w> </span><span class=nf>_is_path_under_root</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span> <span class=n>path</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>pathlib</span><span class=o>.</span><span class=n>Path</span><span class=p>],</span> <span class=n>client_root</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>server_root</span><span class=p>:</span> <span class=nb>str</span>
    <span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
        <span class=n>path</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>path</span><span class=p>)</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span>
        <span class=k>if</span> <span class=n>path</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=n>server_root</span><span class=p>):</span>
            <span class=k>return</span> <span class=kc>True</span>

        <span class=k>elif</span> <span class=n>path</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=n>client_root</span><span class=p>):</span>
            <span class=k>return</span> <span class=kc>True</span>

        <span class=k>return</span> <span class=kc>False</span>

    <span class=c1># @lru_cache(maxsize=64)</span>
    <span class=k>def</span><span class=w> </span><span class=nf>_are_paths_under_root</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>workspace</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>paths</span><span class=p>:</span> <span class=nb>tuple</span><span class=p>[</span><span class=nb>str</span> <span class=o>|</span> <span class=n>pathlib</span><span class=o>.</span><span class=n>Path</span><span class=p>]):</span>
        <span class=n>client_root</span><span class=p>,</span> <span class=n>server_root</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_workspace_roots</span><span class=p>(</span><span class=n>workspace</span><span class=p>)</span>
        <span class=k>for</span> <span class=n>path</span> <span class=ow>in</span> <span class=n>paths</span><span class=p>:</span>
            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_is_path_under_root</span><span class=p>(</span><span class=n>path</span><span class=p>,</span> <span class=n>client_root</span><span class=p>,</span> <span class=n>server_root</span><span class=p>):</span>
                <span class=k>continue</span>

            <span class=k>return</span> <span class=kc>False</span>

        <span class=k>return</span> <span class=kc>True</span>

    <span class=nd>@lru_cache</span><span class=p>(</span><span class=n>maxsize</span><span class=o>=</span><span class=mi>64</span><span class=p>)</span>
    <span class=k>def</span><span class=w> </span><span class=nf>_is_path_under_any_root</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>path</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>pathlib</span><span class=o>.</span><span class=n>Path</span><span class=p>]):</span>
        <span class=k>for</span> <span class=n>workspace</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>_workspace_cache</span><span class=p>:</span>
            <span class=k>with</span> <span class=bp>self</span><span class=o>.</span><span class=n>workspace_as</span><span class=p>(</span><span class=n>workspace</span><span class=p>):</span>
                <span class=n>client_root</span><span class=p>,</span> <span class=n>server_root</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_workspace_roots</span><span class=p>(</span><span class=n>workspace</span><span class=p>)</span>
                <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_is_path_under_root</span><span class=p>(</span><span class=n>path</span><span class=p>,</span> <span class=n>client_root</span><span class=p>,</span> <span class=n>server_root</span><span class=p>):</span>
                    <span class=k>return</span> <span class=kc>True</span>
        <span class=k>return</span> <span class=kc>False</span>

    <span class=nd>@functools</span><span class=o>.</span><span class=n>lru_cache</span><span class=p>(</span><span class=n>maxsize</span><span class=o>=</span><span class=mi>64</span><span class=p>)</span>
    <span class=k>def</span><span class=w> </span><span class=nf>_args_has_path_or_workspace</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>signature</span><span class=p>):</span>
        <span class=c1># type: (inspect.Signature) -&gt; bool</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Test if the function to be wrapped has an argument</span>
<span class=sd>        called `path`, returning True if so and False if not.</span>
<span class=sd>        This will determine if path pre processing functions</span>
<span class=sd>        should be run on the functions args or not.</span>

<span class=sd>        This is cached to provide the best possible performance.</span>
<span class=sd>        &quot;&quot;&quot;</span>

        <span class=k>if</span> <span class=s2>&quot;path&quot;</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>signature</span><span class=o>.</span><span class=n>parameters</span> <span class=ow>and</span> <span class=s2>&quot;workspace&quot;</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>signature</span><span class=o>.</span><span class=n>parameters</span><span class=p>:</span>
            <span class=k>return</span> <span class=kc>False</span>

        <span class=k>return</span> <span class=kc>True</span>

    <span class=nd>@functools</span><span class=o>.</span><span class=n>lru_cache</span><span class=p>(</span><span class=n>maxsize</span><span class=o>=</span><span class=mi>64</span><span class=p>)</span>
    <span class=k>def</span><span class=w> </span><span class=nf>_get_path_index_from_args</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>signature</span><span class=p>):</span>
        <span class=c1># type: (inspect.Signature) -&gt; int | None</span>
        <span class=n>arg_names</span> <span class=o>=</span> <span class=nb>tuple</span><span class=p>(</span><span class=n>signature</span><span class=o>.</span><span class=n>parameters</span><span class=p>)</span>
        <span class=n>path_index</span> <span class=o>=</span> <span class=kc>None</span>
        <span class=k>if</span> <span class=s2>&quot;path&quot;</span> <span class=ow>in</span> <span class=n>arg_names</span><span class=p>:</span>
            <span class=n>path_index</span> <span class=o>=</span> <span class=n>arg_names</span><span class=o>.</span><span class=n>index</span><span class=p>(</span><span class=s2>&quot;path&quot;</span><span class=p>)</span>

        <span class=k>return</span> <span class=n>path_index</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_set_retry_p4_connection</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>value</span><span class=p>:</span> <span class=nb>bool</span><span class=p>):</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_retry_p4_connection</span> <span class=o>=</span> <span class=n>value</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_start_retry_p4_connection_timer</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>interval</span><span class=o>=</span><span class=mi>5</span><span class=p>):</span>
        <span class=n>timer</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Timer</span><span class=p>(</span><span class=n>interval</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>test_connection</span><span class=p>)</span>
        <span class=n>timer</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_update_workspace_cache</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>workspace</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        This puts the workspace that most recently worked at the</span>
<span class=sd>        front of the `_workspace_cache` to try and reduce</span>
<span class=sd>        the number of attempts on subsequent operations.</span>
<span class=sd>        The idea is p4 operations work on batches of files</span>
<span class=sd>        within the same workspace.</span>
<span class=sd>        This won&#39;t always be the case, but it will make</span>
<span class=sd>        large speed improvements when it is:</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=k>if</span> <span class=n>workspace</span> <span class=ow>not</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>_workspace_cache</span><span class=p>:</span>
            <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Workspace is not valid: </span><span class=si>{}</span><span class=s2> - cannot sort cache&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>workspace</span><span class=p>))</span>
            <span class=k>return</span>

        <span class=n>index</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_workspace_cache</span><span class=o>.</span><span class=n>index</span><span class=p>(</span><span class=n>workspace</span><span class=p>)</span>
        <span class=k>if</span> <span class=n>index</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_workspace_cache</span><span class=o>.</span><span class=n>pop</span><span class=p>(</span><span class=n>index</span><span class=p>)</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_workspace_cache</span><span class=o>.</span><span class=n>insert</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>workspace</span><span class=p>)</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_get_path_arg_info</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>function</span><span class=p>,</span> <span class=n>args</span><span class=p>):</span>
        <span class=c1># type: (Callable[..., Any], tuple[Any, ...]) -&gt; tuple[tuple[str] | None, bool]</span>
        <span class=n>signature</span> <span class=o>=</span> <span class=n>inspect</span><span class=o>.</span><span class=n>signature</span><span class=p>(</span><span class=n>function</span><span class=p>)</span>
        <span class=n>compile_result</span> <span class=o>=</span> <span class=kc>False</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>_args_has_path_or_workspace</span><span class=p>(</span><span class=n>signature</span><span class=p>):</span>
            <span class=k>return</span> <span class=kc>None</span><span class=p>,</span> <span class=n>compile_result</span>

        <span class=n>path</span> <span class=o>=</span> <span class=kc>None</span>   <span class=c1># type: tuple[str] | None</span>
        <span class=n>path_index</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_path_index_from_args</span><span class=p>(</span><span class=n>signature</span><span class=p>)</span>
        <span class=k>if</span> <span class=n>path_index</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
            <span class=n>_path</span> <span class=o>=</span> <span class=n>args</span><span class=p>[</span><span class=n>path_index</span><span class=p>]</span>
            <span class=n>compile_result</span> <span class=o>=</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>_path</span><span class=p>,</span> <span class=p>(</span><span class=nb>list</span><span class=p>,</span> <span class=nb>tuple</span><span class=p>))</span>
            <span class=n>_path</span> <span class=o>=</span> <span class=n>make_tuple_if_not</span><span class=p>(</span><span class=n>_path</span><span class=p>)</span>
            <span class=n>path</span> <span class=o>=</span> <span class=nb>tuple</span><span class=p>(</span><span class=nb>dict</span><span class=o>.</span><span class=n>fromkeys</span><span class=p>(</span><span class=n>_path</span><span class=p>)</span><span class=o>.</span><span class=n>keys</span><span class=p>())</span>

        <span class=k>return</span> <span class=n>path</span><span class=p>,</span> <span class=n>compile_result</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_is_p4_exception</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>error</span><span class=p>):</span>
        <span class=c1># type: (Exception) -&gt; bool</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Query the exception type by `__name__` as it seems</span>
<span class=sd>        that P4 can get confused if there are multiple P4</span>
<span class=sd>        module paths available which results in P4Exception not</span>
<span class=sd>        being caught as expected!</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=k>return</span> <span class=nb>type</span><span class=p>(</span><span class=n>error</span><span class=p>)</span><span class=o>.</span><span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&quot;P4Exception&quot;</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_clear_errors</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_attribute_errors</span><span class=o>.</span><span class=n>clear</span><span class=p>()</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_workspace_errors</span><span class=o>.</span><span class=n>clear</span><span class=p>()</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_process_errors</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_run_successfully</span><span class=p>:</span>
            <span class=k>return</span>

        <span class=n>extra_path_existence_errors</span> <span class=o>=</span> <span class=p>[]</span>

        <span class=k>def</span><span class=w> </span><span class=nf>_process_workspace_errors</span><span class=p>(</span><span class=n>_extra_path_existence_errors</span><span class=p>):</span>
            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>p4</span><span class=o>.</span><span class=n>errors</span> <span class=ow>and</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>_attribute_errors</span><span class=p>:</span>
                <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>_workspace_errors</span><span class=p>:</span>
                    <span class=k>return</span> <span class=kc>False</span>

                <span class=n>error_text</span> <span class=o>=</span> <span class=s2>&quot;The paths do not exist under a valid workspace root:&quot;</span>
                <span class=n>invalid_paths_found</span> <span class=o>=</span> <span class=kc>False</span>
                <span class=k>for</span> <span class=n>path</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>_workspace_errors</span><span class=p>:</span>
                    <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>_is_path_under_any_root</span><span class=p>(</span><span class=n>path</span><span class=p>):</span>
                        <span class=n>error_text</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>error_text</span><span class=si>}</span><span class=se>\n</span><span class=s2> - </span><span class=si>{</span><span class=n>path</span><span class=si>}</span><span class=s2>&quot;</span>
                        <span class=n>invalid_paths_found</span> <span class=o>=</span> <span class=kc>True</span>

                <span class=k>if</span> <span class=ow>not</span> <span class=n>invalid_paths_found</span><span class=p>:</span>
                    <span class=k>for</span> <span class=n>path</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>_workspace_errors</span><span class=p>:</span>
                        <span class=k>if</span> <span class=ow>not</span> <span class=n>pathlib</span><span class=o>.</span><span class=n>Path</span><span class=p>(</span><span class=n>path</span><span class=p>)</span><span class=o>.</span><span class=n>exists</span><span class=p>():</span>
                            <span class=n>_extra_path_existence_errors</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>path</span><span class=p>)</span>

                    <span class=k>if</span> <span class=ow>not</span> <span class=n>_extra_path_existence_errors</span><span class=p>:</span>
                        <span class=k>return</span> <span class=kc>False</span>

                <span class=k>else</span><span class=p>:</span>
                    <span class=n>error_text</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>error_text</span><span class=si>}</span><span class=se>\n</span><span class=s2>&quot;</span>
                    <span class=n>sys</span><span class=o>.</span><span class=n>stderr</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>error_text</span><span class=p>)</span>
                    <span class=k>return</span> <span class=kc>True</span>

        <span class=k>def</span><span class=w> </span><span class=nf>_process_path_existence_errors</span><span class=p>(</span><span class=n>_extra_path_existence_errors</span><span class=p>):</span>
            <span class=n>_path_existence_errors</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_path_existence_errors</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>
            <span class=n>_path_existence_errors</span><span class=o>.</span><span class=n>union</span><span class=p>(</span><span class=n>_extra_path_existence_errors</span><span class=p>)</span>
            <span class=k>if</span> <span class=n>_path_existence_errors</span><span class=p>:</span>
                <span class=n>error_text</span> <span class=o>=</span> <span class=s2>&quot;The following paths do not exist:&quot;</span>
                <span class=k>for</span> <span class=n>path</span> <span class=ow>in</span> <span class=n>_path_existence_errors</span><span class=p>:</span>
                    <span class=n>error_text</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>error_text</span><span class=si>}</span><span class=se>\n</span><span class=s2> - </span><span class=si>{</span><span class=n>path</span><span class=si>}</span><span class=s2>&quot;</span>

                <span class=n>error_text</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>error_text</span><span class=si>}</span><span class=se>\n</span><span class=s2>&quot;</span>
                <span class=n>sys</span><span class=o>.</span><span class=n>stderr</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>error_text</span><span class=p>)</span>

        <span class=k>def</span><span class=w> </span><span class=nf>_process_p4_attribute_errors</span><span class=p>():</span>
            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_attribute_errors</span><span class=p>:</span>
                <span class=n>error_text</span> <span class=o>=</span> <span class=s2>&quot;The following p4 attributes do not exist:&quot;</span>
                <span class=k>for</span> <span class=n>error</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>_attribute_errors</span><span class=p>:</span>
                    <span class=n>error_text</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>error_text</span><span class=si>}</span><span class=se>\n</span><span class=s2> - </span><span class=si>{</span><span class=n>error</span><span class=si>}</span><span class=s2>&quot;</span>

                <span class=n>error_text</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>error_text</span><span class=si>}</span><span class=se>\n</span><span class=s2>&quot;</span>
                <span class=n>sys</span><span class=o>.</span><span class=n>stderr</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>error_text</span><span class=p>)</span>

        <span class=k>def</span><span class=w> </span><span class=nf>_process_errors</span><span class=p>():</span>
            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>p4</span><span class=o>.</span><span class=n>errors</span><span class=p>:</span>
                <span class=n>error_text</span> <span class=o>=</span> <span class=s2>&quot;The following errors occured:&quot;</span>
                <span class=k>for</span> <span class=n>error</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>p4</span><span class=o>.</span><span class=n>errors</span><span class=p>:</span>
                    <span class=n>error_text</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>error_text</span><span class=si>}</span><span class=se>\n</span><span class=s2> - </span><span class=si>{</span><span class=n>error</span><span class=si>}</span><span class=s2>&quot;</span>

                <span class=n>error_text</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>error_text</span><span class=si>}</span><span class=se>\n</span><span class=s2>&quot;</span>
                <span class=n>sys</span><span class=o>.</span><span class=n>stderr</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>error_text</span><span class=p>)</span>

        <span class=k>if</span> <span class=n>_process_workspace_errors</span><span class=p>(</span><span class=n>extra_path_existence_errors</span><span class=p>):</span>
            <span class=k>return</span>

        <span class=n>_process_path_existence_errors</span><span class=p>(</span><span class=n>extra_path_existence_errors</span><span class=p>)</span>
        <span class=n>_process_p4_attribute_errors</span><span class=p>()</span>
        <span class=n>_process_errors</span><span class=p>()</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_process_warnings</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
        <span class=n>warnings</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>p4</span><span class=o>.</span><span class=n>warnings</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=n>warnings</span><span class=p>:</span>
            <span class=k>return</span>

        <span class=n>exclusive_check_outs</span> <span class=o>=</span> <span class=p>[]</span>
        <span class=k>for</span> <span class=n>warning</span> <span class=ow>in</span> <span class=n>warnings</span><span class=p>:</span>
            <span class=k>if</span> <span class=s2>&quot; - can&#39;t edit exclusive file already opened&quot;</span> <span class=ow>in</span> <span class=n>warning</span><span class=p>:</span>
                <span class=n>exclusive_check_outs</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>warning</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&quot; -&quot;</span><span class=p>)[</span><span class=mi>0</span><span class=p>])</span>

        <span class=k>if</span> <span class=n>exclusive_check_outs</span><span class=p>:</span>
            <span class=k>raise</span> <span class=n>p4_errors</span><span class=o>.</span><span class=n>P4ExclusiveCheckoutError</span><span class=p>(</span><span class=n>exclusive_check_outs</span><span class=p>)</span>

        <span class=n>warning_text</span> <span class=o>=</span> <span class=s2>&quot;The following warnings occurred:&quot;</span>
        <span class=n>warning_added</span> <span class=o>=</span> <span class=kc>False</span>
        <span class=k>for</span> <span class=n>warning</span> <span class=ow>in</span> <span class=n>warnings</span><span class=p>:</span>
            <span class=n>warning</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>warning</span><span class=p>)</span>
            <span class=c1># if &quot; - no such file(s)&quot; in warning:</span>
            <span class=c1>#     continue</span>

            <span class=n>warning_added</span> <span class=o>=</span> <span class=kc>True</span>
            <span class=n>warning_text</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>warning_text</span><span class=si>}</span><span class=se>\n</span><span class=s2> </span><span class=si>{</span><span class=n>warning</span><span class=si>}</span><span class=s2>&quot;</span>

        <span class=k>if</span> <span class=n>warning_added</span><span class=p>:</span>
            <span class=n>warning_text</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>warning_text</span><span class=si>}</span><span class=se>\n</span><span class=s2>&quot;</span>
            <span class=n>sys</span><span class=o>.</span><span class=n>stdout</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>warning_text</span><span class=p>)</span>

        <span class=c1># warnings.clear()</span>

    <span class=k>if</span> <span class=n>_typing</span><span class=p>:</span>

        <span class=nd>@typing</span><span class=o>.</span><span class=n>overload</span>
        <span class=k>def</span><span class=w> </span><span class=nf>_process_result</span><span class=p>(</span>
            <span class=bp>self</span><span class=p>,</span>
            <span class=n>result</span><span class=p>,</span>
            <span class=n>keys</span><span class=p>,</span>
            <span class=n>actions</span><span class=p>,</span>
            <span class=n>none_keys</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
            <span class=n>none_actions</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
            <span class=n>true_pattern</span><span class=o>=...</span><span class=p>,</span>
            <span class=n>false_pattern</span><span class=o>=...</span><span class=p>,</span>
            <span class=n>set_none</span><span class=o>=</span><span class=kc>False</span>
        <span class=p>):</span>
            <span class=c1># type: (T_Result, T_Keys, T_Actions, T_NoneKeys, T_NoneActions, str, str, Literal[False]) -&gt; list[bool]  # noqa</span>
            <span class=o>...</span>

        <span class=nd>@typing</span><span class=o>.</span><span class=n>overload</span>
        <span class=k>def</span><span class=w> </span><span class=nf>_process_result</span><span class=p>(</span>
            <span class=bp>self</span><span class=p>,</span>
            <span class=n>result</span><span class=p>,</span>
            <span class=n>keys</span><span class=p>,</span>
            <span class=n>actions</span><span class=p>,</span>
            <span class=n>none_keys</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
            <span class=n>none_actions</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
            <span class=n>true_pattern</span><span class=o>=...</span><span class=p>,</span>
            <span class=n>false_pattern</span><span class=o>=...</span><span class=p>,</span>
            <span class=n>set_none</span><span class=o>=</span><span class=kc>True</span>
        <span class=p>):</span>
            <span class=c1># type: (T_Result, T_Keys, T_Actions, T_NoneKeys, T_NoneActions, str, str, Literal[True]) -&gt; list[bool | None]  # noqa</span>
            <span class=o>...</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_process_result</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span>
        <span class=n>result</span><span class=p>,</span>
        <span class=n>keys</span><span class=p>,</span>
        <span class=n>actions</span><span class=p>,</span>
        <span class=n>none_keys</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
        <span class=n>none_actions</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
        <span class=n>true_pattern</span><span class=o>=</span><span class=s2>&quot;&quot;</span><span class=p>,</span>
        <span class=n>false_pattern</span><span class=o>=</span><span class=s2>&quot;&quot;</span><span class=p>,</span>
        <span class=n>set_none</span><span class=o>=</span><span class=kc>False</span>
    <span class=p>):</span>
        <span class=c1># type: (T_Result, T_Keys, T_Actions, T_NoneKeys, T_NoneActions, str, str, Literal[True, False]) -&gt; list[bool | None] | list[bool]  # noqa</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Process the given result, matching expected key &amp; action pairs for</span>
<span class=sd>        dictionary results or true or false patterns for string results</span>
<span class=sd>        to determine if the result has been successful or not.</span>
<span class=sd>        &quot;&quot;&quot;</span>

        <span class=n>keys</span> <span class=o>=</span> <span class=n>make_tuple_if_not</span><span class=p>(</span><span class=n>keys</span><span class=p>)</span>
        <span class=n>actions</span> <span class=o>=</span> <span class=n>make_tuple_if_not</span><span class=p>(</span><span class=n>actions</span><span class=p>)</span>
        <span class=n>none_keys</span> <span class=o>=</span> <span class=n>make_tuple_if_not</span><span class=p>(</span><span class=n>none_keys</span><span class=p>)</span> <span class=k>if</span> <span class=n>none_keys</span> <span class=k>else</span> <span class=nb>tuple</span><span class=p>()</span>
        <span class=n>none_actions</span> <span class=o>=</span> <span class=n>make_tuple_if_not</span><span class=p>(</span><span class=n>none_actions</span><span class=p>)</span> <span class=k>if</span> <span class=n>none_actions</span> <span class=k>else</span> <span class=nb>tuple</span><span class=p>()</span>

        <span class=k>def</span><span class=w> </span><span class=nf>query_key</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>keys</span><span class=p>,</span> <span class=n>actions</span><span class=p>,</span> <span class=n>none_keys</span><span class=p>,</span> <span class=n>none_actions</span><span class=p>,</span> <span class=n>result</span><span class=p>,</span> <span class=n>set_none</span><span class=o>=</span><span class=kc>False</span><span class=p>):</span>
            <span class=c1># type: (dict[str, str], tuple[str], tuple[str], tuple[str], tuple[str], list[bool | None], bool) -&gt; None  # noqa</span>
            <span class=k>if</span> <span class=n>set_none</span><span class=p>:</span>
                <span class=k>for</span> <span class=n>key</span> <span class=ow>in</span> <span class=n>none_keys</span><span class=p>:</span>
                    <span class=k>if</span> <span class=n>key</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>data</span><span class=p>:</span>
                        <span class=k>continue</span>

                    <span class=n>value</span> <span class=o>=</span> <span class=n>data</span><span class=p>[</span><span class=n>key</span><span class=p>]</span>
                    <span class=k>if</span> <span class=n>value</span> <span class=ow>in</span> <span class=n>none_actions</span><span class=p>:</span>
                        <span class=n>result</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=kc>None</span><span class=p>)</span>
                        <span class=k>return</span>

            <span class=k>for</span> <span class=n>key</span> <span class=ow>in</span> <span class=n>keys</span><span class=p>:</span>
                <span class=k>if</span> <span class=n>key</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>data</span><span class=p>:</span>
                    <span class=k>continue</span>

                <span class=n>value</span> <span class=o>=</span> <span class=n>data</span><span class=p>[</span><span class=n>key</span><span class=p>]</span>
                <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>value</span><span class=p>,</span> <span class=nb>list</span><span class=p>):</span>
                    <span class=n>value</span> <span class=o>=</span> <span class=n>value</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>

                <span class=n>result</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>value</span> <span class=ow>in</span> <span class=n>actions</span><span class=p>)</span>
                <span class=k>return</span>

            <span class=n>result</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=kc>False</span><span class=p>)</span>

        <span class=n>results</span> <span class=o>=</span> <span class=p>[]</span>  <span class=c1># type: list[bool | None]</span>
        <span class=k>for</span> <span class=n>data</span> <span class=ow>in</span> <span class=n>result</span><span class=p>:</span>
            <span class=k>if</span> <span class=ow>not</span> <span class=n>data</span> <span class=ow>and</span> <span class=n>set_none</span><span class=p>:</span>
                <span class=n>results</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=kc>None</span><span class=p>)</span>
                <span class=k>continue</span>

            <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=nb>dict</span><span class=p>):</span>
                <span class=n>query_key</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>keys</span><span class=p>,</span> <span class=n>actions</span><span class=p>,</span> <span class=n>none_keys</span><span class=p>,</span> <span class=n>none_actions</span><span class=p>,</span> <span class=n>results</span><span class=p>,</span> <span class=n>set_none</span><span class=o>=</span><span class=n>set_none</span><span class=p>)</span>
                <span class=k>continue</span>

            <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=nb>str</span><span class=p>):</span>
                <span class=k>if</span> <span class=n>true_pattern</span> <span class=ow>and</span> <span class=n>true_pattern</span> <span class=ow>in</span> <span class=n>data</span><span class=p>:</span>
                    <span class=n>results</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=kc>True</span><span class=p>)</span>
                    <span class=k>continue</span>

                <span class=k>if</span> <span class=n>false_pattern</span> <span class=ow>and</span> <span class=n>false_pattern</span> <span class=ow>in</span> <span class=n>data</span><span class=p>:</span>
                    <span class=n>results</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=kc>False</span><span class=p>)</span>
                    <span class=k>continue</span>

                <span class=k>elif</span> <span class=s2>&quot;- empty, assuming&quot;</span> <span class=ow>in</span> <span class=n>data</span><span class=p>:</span>
                    <span class=k>continue</span>

            <span class=n>results</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=kc>False</span><span class=p>)</span>
            <span class=k>break</span>

        <span class=k>return</span> <span class=n>results</span>

    <span class=k>def</span><span class=w> </span><span class=nf>login</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span>
        <span class=n>host</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
        <span class=n>port</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span>
        <span class=n>username</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
        <span class=n>password</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
        <span class=n>workspace_name</span><span class=p>:</span> <span class=nb>str</span>
    <span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Connects from values in Settings</span>

<span class=sd>        Override P4CONFIG values.</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=n>conn_manager</span> <span class=o>=</span> <span class=n>_get_connection_manager</span><span class=p>()</span>
        <span class=k>if</span> <span class=n>conn_manager</span><span class=o>.</span><span class=n>p4</span><span class=o>.</span><span class=n>user</span> <span class=o>!=</span> <span class=n>username</span><span class=p>:</span>
            <span class=n>conn_manager</span><span class=o>.</span><span class=n>p4</span><span class=o>.</span><span class=n>user</span> <span class=o>=</span> <span class=n>username</span>
            <span class=n>conn_manager</span><span class=o>.</span><span class=n>p4</span><span class=o>.</span><span class=n>password</span> <span class=o>=</span> <span class=n>password</span>
            <span class=n>conn_manager</span><span class=o>.</span><span class=n>p4</span><span class=o>.</span><span class=n>port</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>host</span><span class=si>}</span><span class=s2>:</span><span class=si>{</span><span class=n>port</span><span class=si>}</span><span class=s2>&quot;</span>
        <span class=n>conn_manager</span><span class=o>.</span><span class=n>p4</span><span class=o>.</span><span class=n>connect</span><span class=p>()</span>
        <span class=n>conn_manager</span><span class=o>.</span><span class=n>p4</span><span class=o>.</span><span class=n>run_login</span><span class=p>(</span><span class=n>password</span><span class=o>=</span><span class=n>password</span><span class=p>)</span>
        <span class=n>conn_manager</span><span class=o>.</span><span class=n>p4</span><span class=o>.</span><span class=n>client</span> <span class=o>=</span> <span class=n>workspace_name</span>
        <span class=n>conn_manager</span><span class=o>.</span><span class=n>__workspace_cache__</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_connect_get_workspaces</span><span class=p>()</span>

    <span class=c1># Connect Methods:</span>
    <span class=k>def</span><span class=w> </span><span class=nf>_connect_add</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span>
        <span class=n>path</span><span class=p>:</span> <span class=n>T_PthStrLst</span><span class=p>,</span>
        <span class=n>change_description</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=kc>None</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>P4ReturnBoolType</span><span class=p>:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Add the given file if it does not exists on the server already.</span>
<span class=sd>        &quot;&quot;&quot;</span>

        <span class=k>for</span> <span class=n>_path</span> <span class=ow>in</span> <span class=n>path</span><span class=p>:</span>
            <span class=k>if</span> <span class=ow>not</span> <span class=n>pathlib</span><span class=o>.</span><span class=n>Path</span><span class=p>(</span><span class=n>_path</span><span class=p>)</span><span class=o>.</span><span class=n>exists</span><span class=p>():</span>
                <span class=k>raise</span> <span class=n>p4_errors</span><span class=o>.</span><span class=n>P4PathDoesNotExistError</span><span class=p>(</span><span class=n>_path</span><span class=p>)</span>

        <span class=n>result</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>p4</span><span class=o>.</span><span class=n>run_add</span><span class=p>(</span><span class=n>path</span><span class=p>)</span>
        <span class=k>if</span> <span class=n>change_description</span><span class=p>:</span>

            <span class=k>def</span><span class=w> </span><span class=nf>_get_path_to_reopen</span><span class=p>(</span><span class=n>data</span><span class=p>):</span>
                <span class=c1># type: (str) -&gt; str | None</span>
                <span class=k>if</span> <span class=s2>&quot;already opened for edit&quot;</span> <span class=ow>in</span> <span class=n>data</span><span class=p>:</span>
                    <span class=k>return</span> <span class=n>data</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&quot; - &quot;</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span>

                <span class=k>if</span> <span class=s2>&quot;currently opened for add&quot;</span> <span class=ow>in</span> <span class=n>data</span><span class=p>:</span>
                    <span class=k>return</span> <span class=n>data</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&quot;#&quot;</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span>

            <span class=n>files_to_reopen</span> <span class=o>=</span> <span class=p>[]</span>  <span class=c1># type: list[str]</span>
            <span class=k>for</span> <span class=n>_result</span> <span class=ow>in</span> <span class=n>result</span><span class=p>:</span>
                <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>_result</span><span class=p>,</span> <span class=nb>dict</span><span class=p>):</span>
                    <span class=k>continue</span>

                <span class=n>path_to_reopen</span> <span class=o>=</span> <span class=n>_get_path_to_reopen</span><span class=p>(</span><span class=n>_result</span><span class=p>)</span>
                <span class=k>if</span> <span class=ow>not</span> <span class=n>path_to_reopen</span><span class=p>:</span>
                    <span class=k>continue</span>

                <span class=n>files_to_reopen</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>path_to_reopen</span><span class=p>)</span>

            <span class=k>if</span> <span class=n>files_to_reopen</span><span class=p>:</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>p4</span><span class=o>.</span><span class=n>run_reopen</span><span class=p>([</span><span class=s2>&quot;-c&quot;</span><span class=p>,</span> <span class=s2>&quot;default&quot;</span><span class=p>],</span> <span class=n>files_to_reopen</span><span class=p>)</span>

            <span class=bp>self</span><span class=o>.</span><span class=n>_connect_create_change_list</span><span class=p>(</span><span class=n>change_description</span><span class=p>,</span> <span class=n>files</span><span class=o>=</span><span class=n>path</span><span class=p>)</span>

        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_process_result</span><span class=p>(</span>
            <span class=n>result</span><span class=p>,</span>
            <span class=s2>&quot;action&quot;</span><span class=p>,</span>
            <span class=s2>&quot;add&quot;</span><span class=p>,</span>
            <span class=n>true_pattern</span><span class=o>=</span><span class=s2>&quot;- currently opened for&quot;</span>
        <span class=p>)</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_connect_add_to_change_list</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>path</span><span class=p>:</span> <span class=n>T_PthStrLst</span><span class=p>,</span> <span class=n>description</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
        <span class=n>change_dict</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_connect_get_existing_change_list</span><span class=p>(</span><span class=n>description</span><span class=p>)</span>
        <span class=n>user_name</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_connect_get_user_name</span><span class=p>()</span>
        <span class=n>client</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>p4</span><span class=o>.</span><span class=n>client</span>
        <span class=n>changes</span><span class=p>:</span> <span class=nb>list</span><span class=p>[</span><span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>p4</span><span class=o>.</span><span class=n>run_changes</span><span class=p>(</span>
            <span class=p>[</span><span class=s2>&quot;-u&quot;</span><span class=p>,</span> <span class=n>user_name</span><span class=p>,</span> <span class=s2>&quot;-c&quot;</span><span class=p>,</span> <span class=n>client</span><span class=p>,</span> <span class=s2>&quot;-s&quot;</span><span class=p>,</span> <span class=s2>&quot;pending&quot;</span><span class=p>]</span>
        <span class=p>)</span>
        <span class=n>exists</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_connect_exists_on_server</span><span class=p>(</span><span class=n>path</span><span class=p>)</span>
        <span class=n>paths_to_add</span> <span class=o>=</span> <span class=p>[</span><span class=n>path</span><span class=p>[</span><span class=n>index</span><span class=p>]</span> <span class=k>for</span> <span class=n>index</span><span class=p>,</span> <span class=n>exist</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>exists</span><span class=p>)</span> <span class=k>if</span> <span class=ow>not</span> <span class=n>exist</span><span class=p>]</span>
        <span class=k>if</span> <span class=n>paths_to_add</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_connect_add</span><span class=p>(</span><span class=n>paths_to_add</span><span class=p>)</span>

        <span class=n>depot_paths</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_connect_get_server_path</span><span class=p>(</span><span class=n>path</span><span class=p>)</span>

        <span class=bp>self</span><span class=o>.</span><span class=n>_connect_checkout</span><span class=p>(</span><span class=n>path</span><span class=p>)</span>
        <span class=n>_depot_paths</span> <span class=o>=</span> <span class=nb>set</span><span class=p>((</span><span class=n>path</span> <span class=k>for</span> <span class=n>path</span> <span class=ow>in</span> <span class=n>depot_paths</span> <span class=k>if</span> <span class=n>path</span><span class=p>))</span>
        <span class=n>paths_to_reopen</span> <span class=o>=</span> <span class=p>[]</span>  <span class=c1># type: list[str]</span>
        <span class=n>changes</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>p4</span><span class=o>.</span><span class=n>run_describe</span><span class=p>([</span><span class=n>change</span><span class=p>[</span><span class=s2>&quot;change&quot;</span><span class=p>]</span> <span class=k>for</span> <span class=n>change</span> <span class=ow>in</span> <span class=n>changes</span><span class=p>])</span>
        <span class=k>for</span> <span class=n>change</span> <span class=ow>in</span> <span class=n>changes</span><span class=p>:</span>
            <span class=k>if</span> <span class=s2>&quot;depotFile&quot;</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>change</span><span class=p>:</span>
                <span class=k>continue</span>

            <span class=k>if</span> <span class=n>change</span><span class=p>[</span><span class=s2>&quot;desc&quot;</span><span class=p>]</span> <span class=o>==</span> <span class=n>description</span><span class=p>:</span>
                <span class=k>continue</span>

            <span class=n>intersection</span> <span class=o>=</span> <span class=n>_depot_paths</span><span class=o>.</span><span class=n>intersection</span><span class=p>(</span>
                <span class=nb>set</span><span class=p>(</span><span class=n>change</span><span class=p>[</span><span class=s2>&quot;depotFile&quot;</span><span class=p>])</span>
            <span class=p>)</span>
            <span class=k>if</span> <span class=ow>not</span> <span class=n>intersection</span><span class=p>:</span>
                <span class=k>continue</span>

            <span class=n>paths_to_reopen</span><span class=o>.</span><span class=n>extend</span><span class=p>(</span><span class=n>intersection</span><span class=p>)</span>

        <span class=k>if</span> <span class=n>paths_to_reopen</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>p4</span><span class=o>.</span><span class=n>run_reopen</span><span class=p>(</span>
                <span class=p>[</span><span class=s2>&quot;-c&quot;</span><span class=p>,</span> <span class=s2>&quot;default&quot;</span><span class=p>],</span> <span class=n>paths_to_reopen</span>
            <span class=p>)</span>

        <span class=n>files</span> <span class=o>=</span> <span class=p>[</span><span class=n>info</span><span class=p>[</span><span class=s2>&quot;depotFile&quot;</span><span class=p>]</span> <span class=k>for</span> <span class=n>info</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>p4</span><span class=o>.</span><span class=n>run_where</span><span class=p>(</span><span class=n>path</span><span class=p>)]</span>
        <span class=n>change_files</span> <span class=o>=</span> <span class=p>(</span>
            <span class=n>change_dict</span><span class=p>[</span><span class=s2>&quot;Files&quot;</span><span class=p>]</span>
            <span class=k>if</span> <span class=s2>&quot;Files&quot;</span> <span class=ow>in</span> <span class=n>change_dict</span>
            <span class=k>else</span> <span class=p>[]</span>
        <span class=p>)</span>  <span class=c1># type: list[str]</span>
        <span class=n>change_files</span><span class=o>.</span><span class=n>extend</span><span class=p>(</span><span class=n>files</span><span class=p>)</span>
        <span class=n>change_files</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span><span class=nb>set</span><span class=p>(</span><span class=n>change_files</span><span class=p>))</span>
        <span class=n>change_dict</span><span class=p>[</span><span class=s2>&quot;Files&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>change_files</span>

        <span class=n>_result</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>p4</span><span class=o>.</span><span class=n>save_change</span><span class=p>(</span><span class=n>change_dict</span><span class=p>)</span>
        <span class=n>result</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_process_result</span><span class=p>(</span>
            <span class=n>_result</span><span class=p>,</span>
            <span class=s2>&quot;&quot;</span><span class=p>,</span>
            <span class=s2>&quot;&quot;</span><span class=p>,</span>
            <span class=n>true_pattern</span><span class=o>=</span><span class=sa>f</span><span class=s2>&quot;adding </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>change_files</span><span class=p>)</span><span class=si>}</span><span class=s2> file(s).&quot;</span>
        <span class=p>)</span>
        <span class=k>return</span> <span class=n>result</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_connect_checkout</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span>
        <span class=n>path</span><span class=p>:</span> <span class=n>T_PthStrLst</span><span class=p>,</span>
        <span class=n>change_description</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=kc>None</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
    <span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span> <span class=o>|</span> <span class=nb>list</span><span class=p>[</span><span class=nb>bool</span><span class=p>]</span> <span class=o>|</span> <span class=kc>None</span><span class=p>:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Checkout the given file(s).</span>
<span class=sd>        &quot;&quot;&quot;</span>

        <span class=n>stat</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_connect_get_stat</span><span class=p>(</span><span class=n>path</span><span class=p>)</span>
        <span class=n>path</span> <span class=o>=</span> <span class=nb>tuple</span><span class=p>((</span><span class=n>_stat</span><span class=p>[</span><span class=s2>&quot;depotFile&quot;</span><span class=p>]</span> <span class=k>for</span> <span class=n>_stat</span> <span class=ow>in</span> <span class=n>stat</span> <span class=k>if</span> <span class=n>_stat</span><span class=p>))</span>

        <span class=n>result</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_connect_is_latest</span><span class=p>(</span><span class=n>path</span><span class=p>)</span>
        <span class=n>paths_to_sync</span> <span class=o>=</span> <span class=p>[</span><span class=n>path</span> <span class=k>for</span> <span class=n>path</span><span class=p>,</span> <span class=n>is_latest</span> <span class=ow>in</span> <span class=nb>zip</span><span class=p>(</span><span class=n>path</span><span class=p>,</span> <span class=n>result</span><span class=p>)</span> <span class=k>if</span> <span class=n>is_latest</span> <span class=ow>is</span> <span class=kc>False</span><span class=p>]</span>
        <span class=k>if</span> <span class=n>paths_to_sync</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_connect_sync</span><span class=p>(</span><span class=n>paths_to_sync</span><span class=p>)</span>

        <span class=n>edit_result</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>p4</span><span class=o>.</span><span class=n>run_edit</span><span class=p>(</span><span class=n>path</span><span class=p>)</span>
        <span class=k>if</span> <span class=n>change_description</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_connect_create_change_list</span><span class=p>(</span><span class=n>change_description</span><span class=p>,</span> <span class=n>files</span><span class=o>=</span><span class=n>path</span><span class=p>)</span>

        <span class=n>_result</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_process_result</span><span class=p>(</span>
            <span class=n>edit_result</span><span class=p>,</span>
            <span class=s2>&quot;action&quot;</span><span class=p>,</span>
            <span class=s2>&quot;edit&quot;</span><span class=p>,</span>
            <span class=n>true_pattern</span><span class=o>=</span><span class=s2>&quot;- currently opened for&quot;</span><span class=p>,</span>
            <span class=n>false_pattern</span><span class=o>=</span><span class=s2>&quot;- can&#39;t edit (already opened for add)&quot;</span><span class=p>,</span>
        <span class=p>)</span>
        <span class=k>if</span> <span class=n>_result</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
            <span class=k>return</span> <span class=kc>None</span>

        <span class=k>return</span> <span class=n>_result</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_connect_checked_out_by</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span> <span class=n>path</span><span class=p>:</span> <span class=n>T_PthStrLst</span><span class=p>,</span> <span class=n>other_users_only</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span> <span class=n>fstat_args</span><span class=p>:</span> <span class=n>P4ArgsType</span> <span class=o>=</span> <span class=kc>None</span>
    <span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>list</span><span class=p>[</span><span class=nb>list</span><span class=p>[</span><span class=nb>tuple</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>str</span><span class=p>]]</span> <span class=o>|</span> <span class=kc>None</span><span class=p>]:</span>
        <span class=n>stat</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_connect_get_stat</span><span class=p>(</span><span class=n>path</span><span class=p>,</span> <span class=n>fstat_args</span> <span class=ow>or</span> <span class=p>[])</span>
        <span class=n>current_user_name</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_connect_get_user_name</span><span class=p>()</span> <span class=k>if</span> <span class=ow>not</span> <span class=n>other_users_only</span> <span class=k>else</span> <span class=s2>&quot;&quot;</span>
        <span class=n>checked_out_by_list</span><span class=p>:</span> <span class=nb>list</span><span class=p>[</span><span class=nb>list</span><span class=p>[</span><span class=nb>tuple</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>str</span><span class=p>]]</span> <span class=o>|</span> <span class=kc>None</span><span class=p>]</span> <span class=o>=</span> <span class=p>[]</span>
        <span class=k>for</span> <span class=n>data</span> <span class=ow>in</span> <span class=n>stat</span><span class=p>:</span>
            <span class=k>if</span> <span class=ow>not</span> <span class=n>data</span><span class=p>:</span>
                <span class=n>checked_out_by_list</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=kc>None</span><span class=p>)</span>
                <span class=k>continue</span>

            <span class=n>file_checked_out_by_list</span><span class=p>:</span> <span class=nb>list</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=p>[]</span>
            <span class=k>if</span> <span class=p>(</span><span class=ow>not</span> <span class=n>other_users_only</span><span class=p>)</span> <span class=ow>and</span> <span class=bp>self</span><span class=o>.</span><span class=n>_is_file_checked_out_by_current_user</span><span class=p>(</span><span class=n>data</span><span class=p>):</span>
                <span class=c1># @sharkmob-shea.richardson:</span>
                <span class=c1># Format this in the same way as if it were checked out by another user, so</span>
                <span class=c1># the output will be consistent:</span>
                <span class=n>file_checked_out_by_list</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>current_user_name</span><span class=si>}</span><span class=s2>@</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>p4</span><span class=o>.</span><span class=n>client</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>

            <span class=k>if</span> <span class=s2>&quot;otherOpen&quot;</span> <span class=ow>in</span> <span class=n>data</span><span class=p>:</span>
                <span class=n>file_checked_out_by_list</span><span class=o>.</span><span class=n>extend</span><span class=p>(</span><span class=n>data</span><span class=p>[</span><span class=s2>&quot;otherOpen&quot;</span><span class=p>])</span>

            <span class=k>if</span> <span class=ow>not</span> <span class=n>file_checked_out_by_list</span><span class=p>:</span>
                <span class=n>checked_out_by_list</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=kc>None</span><span class=p>)</span>
                <span class=k>continue</span>

            <span class=n>clean_file_checked_out_by_list</span> <span class=o>=</span> <span class=p>[</span>
                <span class=nb>tuple</span><span class=p>(</span><span class=n>user_name</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&quot;@&quot;</span><span class=p>))</span> <span class=k>for</span> <span class=n>user_name</span> <span class=ow>in</span> <span class=n>file_checked_out_by_list</span>
            <span class=p>]</span>
            <span class=n>checked_out_by_list</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>clean_file_checked_out_by_list</span><span class=p>)</span>

        <span class=k>return</span> <span class=n>checked_out_by_list</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_connect_create_change_list</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span>
        <span class=n>description</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
        <span class=n>files</span><span class=p>:</span> <span class=n>T_PthStrLst</span> <span class=o>|</span> <span class=kc>None</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
        <span class=n>files_to_reopen</span><span class=p>:</span> <span class=n>T_PthStrLst</span> <span class=o>|</span> <span class=kc>None</span> <span class=o>=</span> <span class=kc>None</span>
    <span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>list</span><span class=p>[</span><span class=nb>bool</span><span class=p>]:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Create a change list with the given description and optional files.</span>
<span class=sd>        &quot;&quot;&quot;</span>

        <span class=k>try</span><span class=p>:</span>
            <span class=n>change_dict</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_connect_get_existing_change_list</span><span class=p>(</span><span class=n>description</span><span class=p>)</span>
        <span class=k>except</span> <span class=n>P4</span><span class=o>.</span><span class=n>P4Exception</span><span class=p>:</span>
            <span class=n>change_dict</span> <span class=o>=</span> <span class=kc>None</span>

        <span class=n>_files</span> <span class=o>=</span> <span class=p>[]</span>
        <span class=k>if</span> <span class=n>files</span><span class=p>:</span>
            <span class=n>files</span> <span class=o>=</span> <span class=p>(</span>
                <span class=p>[</span><span class=n>file</span> <span class=k>for</span> <span class=n>file</span> <span class=ow>in</span> <span class=n>files</span> <span class=k>if</span> <span class=n>file</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>files_to_reopen</span><span class=p>]</span>
                <span class=k>if</span> <span class=n>files_to_reopen</span>
                <span class=k>else</span> <span class=n>files</span>
            <span class=p>)</span>
            <span class=n>_files</span> <span class=o>=</span> <span class=p>[</span><span class=n>info</span><span class=p>[</span><span class=s2>&quot;depotFile&quot;</span><span class=p>]</span> <span class=k>for</span> <span class=n>info</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>p4</span><span class=o>.</span><span class=n>run_where</span><span class=p>(</span><span class=n>files</span><span class=p>)]</span>

        <span class=k>if</span> <span class=n>change_dict</span><span class=p>:</span>
            <span class=n>change_files</span> <span class=o>=</span> <span class=p>(</span>
                <span class=n>change_dict</span><span class=p>[</span><span class=s2>&quot;Files&quot;</span><span class=p>]</span>
                <span class=k>if</span> <span class=s2>&quot;Files&quot;</span> <span class=ow>in</span> <span class=n>change_dict</span>
                <span class=k>else</span> <span class=p>[]</span>
            <span class=p>)</span>  <span class=c1># type: list[str]</span>
            <span class=n>change_files</span><span class=o>.</span><span class=n>extend</span><span class=p>(</span><span class=n>_files</span><span class=p>)</span>
            <span class=n>change_files</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span><span class=nb>set</span><span class=p>(</span><span class=n>change_files</span><span class=p>))</span>
            <span class=n>change_dict</span><span class=p>[</span><span class=s2>&quot;Files&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>change_files</span>

        <span class=k>else</span><span class=p>:</span>
            <span class=n>change_dict</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>p4</span><span class=o>.</span><span class=n>fetch_change</span><span class=p>()</span>
            <span class=k>if</span> <span class=ow>not</span> <span class=n>change_dict</span><span class=p>:</span>
                <span class=k>raise</span> <span class=n>P4</span><span class=o>.</span><span class=n>P4Exception</span><span class=p>(</span><span class=s2>&quot;Failed to create a new change list&quot;</span><span class=p>)</span>

            <span class=n>change_dict</span><span class=p>[</span><span class=s2>&quot;Files&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>_files</span>

        <span class=k>if</span> <span class=n>files_to_reopen</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>p4</span><span class=o>.</span><span class=n>run_reopen</span><span class=p>(</span>
                <span class=p>[</span><span class=s2>&quot;-c&quot;</span><span class=p>,</span> <span class=n>description</span><span class=p>],</span> <span class=n>files_to_reopen</span>
            <span class=p>)</span>

        <span class=n>change_dict</span><span class=p>[</span><span class=s2>&quot;Description&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>description</span>
        <span class=n>save_change_result</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>p4</span><span class=o>.</span><span class=n>save_change</span><span class=p>(</span><span class=n>change_dict</span><span class=p>)</span>
        <span class=n>result</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_process_result</span><span class=p>(</span>
            <span class=n>save_change_result</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>,</span> <span class=n>true_pattern</span><span class=o>=</span><span class=s2>&quot;created.&quot;</span>
        <span class=p>)</span>

        <span class=k>return</span> <span class=n>result</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_connect_get_changes</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=n>change_list</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_connect_run_command</span><span class=p>(</span><span class=s2>&quot;changes&quot;</span><span class=p>,</span>
                                                <span class=s2>&quot;-s&quot;</span><span class=p>,</span> <span class=s2>&quot;submitted&quot;</span><span class=p>)</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=n>change_list</span><span class=p>:</span>
            <span class=k>return</span>

        <span class=c1># returns list as _process_result_ breaks dictionary</span>
        <span class=k>return</span> <span class=n>change_list</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_connect_get_last_change_list</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=n>change_list</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_connect_run_command</span><span class=p>(</span><span class=s2>&quot;changes&quot;</span><span class=p>,</span>
                                                <span class=s2>&quot;-s&quot;</span><span class=p>,</span> <span class=s2>&quot;submitted&quot;</span><span class=p>,</span>
                                                <span class=s2>&quot;-m&quot;</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=n>change_list</span><span class=p>:</span>
            <span class=k>return</span>

        <span class=c1># returns list as _process_result_ breaks dictionary</span>
        <span class=k>return</span> <span class=n>change_list</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_connect_get_change_list_number</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>description</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
        <span class=n>change_dict</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_connect_get_existing_change_list</span><span class=p>(</span><span class=n>description</span><span class=p>)</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=n>change_dict</span><span class=p>:</span>
            <span class=k>return</span>

        <span class=k>return</span> <span class=n>change_dict</span><span class=p>[</span><span class=s2>&quot;change&quot;</span><span class=p>]</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_connect_create_workspace</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>root</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>stream</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
        <span class=n>client</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>p4</span><span class=o>.</span><span class=n>fetch_client</span><span class=p>()</span>
        <span class=n>client</span><span class=p>[</span><span class=s2>&quot;Client&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>name</span>
        <span class=n>client</span><span class=p>[</span><span class=s2>&quot;Root&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>root</span>
        <span class=n>client</span><span class=p>[</span><span class=s2>&quot;Stream&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>stream</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>p4</span><span class=o>.</span><span class=n>save_client</span><span class=p>(</span><span class=n>client</span><span class=p>)</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_connect_delete</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span>
        <span class=n>path</span><span class=p>:</span> <span class=n>T_PthStrLst</span><span class=p>,</span>
        <span class=n>change_description</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=kc>None</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
    <span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>list</span><span class=p>[</span><span class=nb>bool</span><span class=p>]:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Delete the given file if it exists on the server.</span>
<span class=sd>        &quot;&quot;&quot;</span>

        <span class=k>if</span> <span class=n>change_description</span><span class=p>:</span>
            <span class=n>change_number</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_connect_create_change_list</span><span class=p>(</span><span class=n>change_description</span><span class=p>)</span>
            <span class=n>result</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>p4</span><span class=o>.</span><span class=n>run_delete</span><span class=p>([</span><span class=s2>&quot;-c&quot;</span><span class=p>,</span> <span class=n>change_number</span><span class=p>,</span> <span class=n>path</span><span class=p>])</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=n>result</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>p4</span><span class=o>.</span><span class=n>run_delete</span><span class=p>(</span><span class=n>path</span><span class=p>)</span>

        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_process_result</span><span class=p>(</span><span class=n>result</span><span class=p>,</span> <span class=s2>&quot;action&quot;</span><span class=p>,</span> <span class=s2>&quot;edit&quot;</span><span class=p>)</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_connect_delete_change_list</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>description</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>force</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>list</span><span class=p>[</span><span class=nb>bool</span><span class=p>]:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Delete a change list based on it&#39;s description.</span>
<span class=sd>        &quot;&quot;&quot;</span>

        <span class=n>change_list</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_connect_get_existing_change_list</span><span class=p>(</span><span class=n>description</span><span class=p>)</span>
        <span class=n>change_id</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>change_list</span><span class=p>[</span><span class=s2>&quot;Change&quot;</span><span class=p>])</span>
        <span class=n>files</span> <span class=o>=</span> <span class=s2>&quot;Files&quot;</span> <span class=ow>in</span> <span class=n>change_list</span> <span class=ow>and</span> <span class=n>change_list</span><span class=p>[</span><span class=s2>&quot;Files&quot;</span><span class=p>]</span>
        <span class=k>if</span> <span class=n>files</span> <span class=ow>and</span> <span class=n>force</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>p4</span><span class=o>.</span><span class=n>run_reopen</span><span class=p>([</span><span class=s2>&quot;-c&quot;</span><span class=p>,</span> <span class=s2>&quot;default&quot;</span><span class=p>],</span> <span class=n>files</span><span class=p>)</span>

        <span class=n>change_result</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>p4</span><span class=o>.</span><span class=n>run_change</span><span class=p>([</span><span class=s2>&quot;-d&quot;</span><span class=p>,</span> <span class=n>change_id</span><span class=p>])</span>  <span class=c1># type: list[str]</span>
        <span class=n>result</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_process_result</span><span class=p>(</span>
            <span class=n>change_result</span><span class=p>,</span>
            <span class=s2>&quot;&quot;</span><span class=p>,</span>
            <span class=s2>&quot;&quot;</span><span class=p>,</span>
            <span class=n>true_pattern</span><span class=o>=</span><span class=sa>f</span><span class=s2>&quot;Change </span><span class=si>{</span><span class=n>change_id</span><span class=si>}</span><span class=s2> deleted.&quot;</span><span class=p>,</span>
            <span class=n>false_pattern</span><span class=o>=</span><span class=s2>&quot;open file(s) associated with it and can&#39;t be deleted&quot;</span>
        <span class=p>)</span>

        <span class=k>return</span> <span class=n>result</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_connect_exists_on_server</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>path</span><span class=p>:</span> <span class=n>T_PthStrLst</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>list</span><span class=p>[</span><span class=nb>bool</span><span class=p>]:</span>
        <span class=c1># @sharkmob-shea.richardson:</span>
        <span class=c1># If self.path is a directory, limit the number of</span>
        <span class=c1># returned files from the fstat query, to avoid getting</span>
        <span class=c1># info on all sub files recursively. This is done by</span>
        <span class=c1># passing in the -m (max) argument and setting it as 1:</span>
        <span class=n>stat</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_connect_get_stat</span><span class=p>(</span><span class=n>path</span><span class=p>,</span> <span class=p>[</span><span class=s2>&quot;-m 1&quot;</span><span class=p>])</span>
        <span class=n>result</span> <span class=o>=</span> <span class=p>[</span><span class=kc>True</span> <span class=k>if</span> <span class=s2>&quot;depotFile&quot;</span> <span class=ow>in</span> <span class=n>data</span> <span class=k>else</span> <span class=kc>False</span> <span class=k>for</span> <span class=n>data</span> <span class=ow>in</span> <span class=n>stat</span><span class=p>]</span>
        <span class=k>return</span> <span class=n>result</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_connect_get_attribute</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span>
        <span class=n>path</span><span class=p>:</span> <span class=n>T_PthStrLst</span><span class=p>,</span>
        <span class=n>name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
        <span class=n>default</span><span class=p>:</span> <span class=n>Any</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
        <span class=n>raise_error</span><span class=p>:</span><span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span>
    <span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>list</span><span class=p>[</span><span class=nb>str</span> <span class=o>|</span> <span class=kc>None</span><span class=p>]:</span>
        <span class=c1># -Oa flag: Output attributes set by p4 attribute.</span>
        <span class=n>result</span><span class=p>:</span> <span class=nb>list</span><span class=p>[</span><span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>str</span><span class=p>]]</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>p4</span><span class=o>.</span><span class=n>run_fstat</span><span class=p>((</span><span class=s2>&quot;-Oa&quot;</span><span class=p>,),</span> <span class=n>path</span><span class=p>)</span>

        <span class=k>def</span><span class=w> </span><span class=nf>_get_attribute</span><span class=p>(</span><span class=n>data</span><span class=p>:</span> <span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>str</span><span class=p>],</span> <span class=n>name</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
            <span class=k>for</span> <span class=n>key</span><span class=p>,</span> <span class=n>value</span> <span class=ow>in</span> <span class=n>data</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
                <span class=k>if</span> <span class=s2>&quot;-&quot;</span> <span class=ow>in</span> <span class=n>key</span> <span class=ow>and</span> <span class=n>name</span> <span class=ow>in</span> <span class=n>key</span><span class=p>:</span>
                    <span class=k>return</span> <span class=n>value</span>

            <span class=k>if</span> <span class=n>raise_error</span><span class=p>:</span>
                <span class=k>raise</span> <span class=n>p4_errors</span><span class=o>.</span><span class=n>P4AttributeError</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;&#39;</span><span class=si>{</span><span class=n>name</span><span class=si>}</span><span class=s2>&#39; on: &#39;</span><span class=si>{</span><span class=n>data</span><span class=p>[</span><span class=s1>&#39;depotFile&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#39;&quot;</span><span class=p>)</span>

            <span class=bp>self</span><span class=o>.</span><span class=n>_attribute_errors</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;&#39;</span><span class=si>{</span><span class=n>name</span><span class=si>}</span><span class=s2>&#39; on: &#39;</span><span class=si>{</span><span class=n>data</span><span class=p>[</span><span class=s1>&#39;depotFile&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#39;&quot;</span><span class=p>)</span>

            <span class=k>return</span> <span class=n>default</span>

        <span class=k>return</span> <span class=p>[</span><span class=n>_get_attribute</span><span class=p>(</span><span class=n>_result</span><span class=p>,</span> <span class=n>name</span><span class=p>)</span> <span class=k>for</span> <span class=n>_result</span> <span class=ow>in</span> <span class=n>result</span><span class=p>]</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_connect_get_client_root</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=n>result</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>p4</span><span class=o>.</span><span class=n>run_info</span><span class=p>()</span>
        <span class=k>return</span> <span class=n>result</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=s2>&quot;clientRoot&quot;</span><span class=p>]</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_connect_get_current_client_revision</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>path</span><span class=p>:</span> <span class=n>T_PthStrLst</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>list</span><span class=p>[</span><span class=nb>int</span> <span class=o>|</span> <span class=kc>None</span><span class=p>]:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Get the current client revision numbers for the given path/paths.</span>
<span class=sd>        &quot;&quot;&quot;</span>

        <span class=n>stat</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_connect_get_stat</span><span class=p>(</span><span class=n>path</span><span class=p>)</span>
        <span class=n>result</span> <span class=o>=</span> <span class=p>[</span><span class=nb>int</span><span class=p>(</span><span class=n>data</span><span class=p>[</span><span class=s2>&quot;haveRev&quot;</span><span class=p>])</span> <span class=k>if</span> <span class=p>(</span><span class=s2>&quot;haveRev&quot;</span> <span class=ow>in</span> <span class=n>data</span><span class=p>)</span> <span class=k>else</span> <span class=mi>0</span> <span class=k>if</span> <span class=n>data</span> <span class=k>else</span> <span class=kc>None</span> <span class=k>for</span> <span class=n>data</span> <span class=ow>in</span> <span class=n>stat</span><span class=p>]</span>
        <span class=k>return</span> <span class=n>result</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_connect_get_version_info</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>path</span><span class=p>:</span> <span class=n>T_PthStrLst</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>list</span><span class=p>[</span><span class=nb>tuple</span><span class=p>[</span><span class=nb>int</span><span class=p>,</span> <span class=nb>int</span><span class=p>]</span> <span class=o>|</span> <span class=nb>tuple</span><span class=p>[</span><span class=kc>None</span><span class=p>,</span> <span class=kc>None</span><span class=p>]]:</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_connect_get_current_revision_info</span><span class=p>(</span><span class=n>path</span><span class=p>)</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_connect_get_current_revision_info</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>path</span><span class=p>:</span> <span class=n>T_PthStrLst</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>list</span><span class=p>[</span><span class=nb>tuple</span><span class=p>[</span><span class=nb>int</span><span class=p>,</span> <span class=nb>int</span><span class=p>]</span> <span class=o>|</span> <span class=nb>tuple</span><span class=p>[</span><span class=kc>None</span><span class=p>,</span> <span class=kc>None</span><span class=p>]]:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Get the current source and client revision numbers for the given path/paths.</span>
<span class=sd>        &quot;&quot;&quot;</span>

        <span class=k>def</span><span class=w> </span><span class=nf>_get_version_info</span><span class=p>(</span><span class=n>stat</span><span class=p>:</span> <span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>str</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=nb>tuple</span><span class=p>[</span><span class=nb>int</span><span class=p>,</span> <span class=nb>int</span><span class=p>]</span> <span class=o>|</span> <span class=nb>tuple</span><span class=p>[</span><span class=kc>None</span><span class=p>,</span> <span class=kc>None</span><span class=p>]:</span>
            <span class=k>if</span> <span class=ow>not</span> <span class=n>stat</span><span class=p>:</span>
                <span class=k>return</span> <span class=p>(</span><span class=kc>None</span><span class=p>,</span> <span class=kc>None</span><span class=p>)</span>

            <span class=n>source_rev</span> <span class=o>=</span> <span class=n>stat</span><span class=p>[</span><span class=s2>&quot;headRev&quot;</span><span class=p>]</span> <span class=k>if</span> <span class=s2>&quot;headRev&quot;</span> <span class=ow>in</span> <span class=n>stat</span> <span class=k>else</span> <span class=mi>0</span>
            <span class=n>local_rev</span> <span class=o>=</span> <span class=n>stat</span><span class=p>[</span><span class=s2>&quot;haveRev&quot;</span><span class=p>]</span> <span class=k>if</span> <span class=s2>&quot;haveRev&quot;</span> <span class=ow>in</span> <span class=n>stat</span> <span class=k>else</span> <span class=mi>0</span>
            <span class=k>return</span> <span class=nb>int</span><span class=p>(</span><span class=n>source_rev</span><span class=p>),</span> <span class=nb>int</span><span class=p>(</span><span class=n>local_rev</span><span class=p>)</span>

        <span class=n>stat</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_connect_get_stat</span><span class=p>(</span><span class=n>path</span><span class=p>)</span>

        <span class=k>return</span> <span class=p>[</span><span class=n>_get_version_info</span><span class=p>(</span><span class=n>data</span><span class=p>)</span> <span class=k>for</span> <span class=n>data</span> <span class=ow>in</span> <span class=n>stat</span><span class=p>]</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_connect_get_current_server_revision</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>path</span><span class=p>:</span> <span class=n>T_PthStrLst</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>list</span><span class=p>[</span><span class=nb>int</span> <span class=o>|</span> <span class=kc>None</span><span class=p>]:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Get the current source revision numbers for the given path/paths.</span>
<span class=sd>        &quot;&quot;&quot;</span>

        <span class=n>stat</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_connect_get_stat</span><span class=p>(</span><span class=n>path</span><span class=p>)</span>
        <span class=n>result</span> <span class=o>=</span> <span class=p>[</span><span class=nb>int</span><span class=p>(</span><span class=n>data</span><span class=p>[</span><span class=s2>&quot;headRev&quot;</span><span class=p>])</span> <span class=k>if</span> <span class=p>(</span><span class=s2>&quot;headRev&quot;</span> <span class=ow>in</span> <span class=n>data</span><span class=p>)</span> <span class=k>else</span> <span class=mi>0</span> <span class=k>if</span> <span class=n>data</span> <span class=k>else</span> <span class=kc>None</span> <span class=k>for</span> <span class=n>data</span> <span class=ow>in</span> <span class=n>stat</span><span class=p>]</span>
        <span class=k>return</span> <span class=n>result</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_connect_get_existing_change_list</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>description</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
        <span class=n>user_name</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_connect_get_user_name</span><span class=p>()</span>
        <span class=n>client</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>p4</span><span class=o>.</span><span class=n>client</span>
        <span class=n>changes</span><span class=p>:</span> <span class=nb>list</span><span class=p>[</span><span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>p4</span><span class=o>.</span><span class=n>run_changes</span><span class=p>(</span>
            <span class=p>[</span><span class=s2>&quot;-u&quot;</span><span class=p>,</span> <span class=n>user_name</span><span class=p>,</span> <span class=s2>&quot;-c&quot;</span><span class=p>,</span> <span class=n>client</span><span class=p>,</span> <span class=s2>&quot;-s&quot;</span><span class=p>,</span> <span class=s2>&quot;pending&quot;</span><span class=p>]</span>
        <span class=p>)</span>

        <span class=k>if</span> <span class=ow>not</span> <span class=n>changes</span><span class=p>:</span>
            <span class=k>raise</span> <span class=n>P4</span><span class=o>.</span><span class=n>P4Exception</span><span class=p>(</span><span class=s2>&quot;No changelists found!&quot;</span><span class=p>)</span>

        <span class=n>description</span> <span class=o>=</span> <span class=n>description</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span>
        <span class=k>for</span> <span class=n>change_data</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>p4</span><span class=o>.</span><span class=n>run_describe</span><span class=p>([</span><span class=n>change</span><span class=p>[</span><span class=s2>&quot;change&quot;</span><span class=p>]</span> <span class=k>for</span> <span class=n>change</span> <span class=ow>in</span> <span class=n>changes</span><span class=p>]):</span>
            <span class=k>if</span> <span class=n>description</span> <span class=o>!=</span> <span class=n>change_data</span><span class=p>[</span><span class=s2>&quot;desc&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>strip</span><span class=p>():</span>
                <span class=k>continue</span>

            <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>p4</span><span class=o>.</span><span class=n>fetch_change</span><span class=p>(</span><span class=n>change_data</span><span class=p>[</span><span class=s2>&quot;change&quot;</span><span class=p>])</span>

        <span class=k>raise</span> <span class=n>P4</span><span class=o>.</span><span class=n>P4Exception</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;No changelist with description: &quot;</span><span class=si>{</span><span class=n>description</span><span class=si>}</span><span class=s1>&quot; found!&#39;</span><span class=p>)</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_connect_get_files</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span> <span class=n>path</span><span class=p>:</span> <span class=n>T_PthStrLst</span><span class=p>,</span> <span class=n>extension</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=kc>None</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span> <span class=n>include_all</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span> <span class=n>query_sub_folders</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>True</span>
    <span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>list</span><span class=p>[</span><span class=nb>tuple</span><span class=p>[</span><span class=n>pathlib</span><span class=o>.</span><span class=n>Path</span><span class=p>,</span> <span class=o>...</span><span class=p>]]:</span>
        <span class=n>extension</span> <span class=o>=</span> <span class=n>extension</span> <span class=ow>or</span> <span class=s2>&quot;&quot;</span>
        <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>path</span><span class=p>,</span> <span class=nb>list</span><span class=p>):</span>
            <span class=n>path</span> <span class=o>=</span> <span class=p>[</span><span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>_path</span><span class=si>}{</span><span class=n>extension</span><span class=si>}</span><span class=s2>&quot;</span> <span class=k>for</span> <span class=n>_path</span> <span class=ow>in</span> <span class=n>path</span><span class=p>]</span>

        <span class=k>def</span><span class=w> </span><span class=nf>_is_file_valid</span><span class=p>(</span><span class=n>_path</span><span class=p>,</span> <span class=n>parent_path</span><span class=p>):</span>
            <span class=k>if</span> <span class=n>query_sub_folders</span><span class=p>:</span>
                <span class=k>return</span> <span class=kc>True</span>

            <span class=k>return</span> <span class=n>_path</span><span class=o>.</span><span class=n>parent</span> <span class=o>==</span> <span class=n>parent_path</span>

        <span class=n>result</span> <span class=o>=</span> <span class=p>[]</span>
        <span class=k>for</span> <span class=n>_path</span> <span class=ow>in</span> <span class=n>path</span><span class=p>:</span>
            <span class=n>args</span> <span class=o>=</span> <span class=n>_path</span> <span class=k>if</span> <span class=n>include_all</span> <span class=k>else</span> <span class=p>[[</span><span class=s2>&quot;-e&quot;</span><span class=p>],</span> <span class=n>_path</span><span class=p>]</span>
            <span class=n>files</span> <span class=o>=</span> <span class=p>(</span><span class=n>pathlib</span><span class=o>.</span><span class=n>Path</span><span class=p>(</span><span class=n>data</span><span class=p>[</span><span class=s2>&quot;depotFile&quot;</span><span class=p>])</span> <span class=k>for</span> <span class=n>data</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>p4</span><span class=o>.</span><span class=n>run_files</span><span class=p>(</span><span class=n>args</span><span class=p>))</span>
            <span class=n>result</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=nb>tuple</span><span class=p>((</span><span class=n>file</span> <span class=k>for</span> <span class=n>file</span> <span class=ow>in</span> <span class=n>files</span> <span class=k>if</span> <span class=n>_is_file_valid</span><span class=p>(</span><span class=n>file</span><span class=p>,</span> <span class=n>_path</span><span class=p>))))</span>

        <span class=k>return</span> <span class=n>result</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_connect_get_files_in_folder_in_date_order</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span>
        <span class=n>path</span><span class=p>:</span> <span class=n>T_PthStrLst</span><span class=p>,</span>
        <span class=n>name_pattern</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=kc>None</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
        <span class=n>extensions</span><span class=p>:</span> <span class=n>Iterable</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>|</span> <span class=kc>None</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
        <span class=n>fstat_args</span><span class=p>:</span> <span class=n>Iterable</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>|</span> <span class=kc>None</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
    <span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>list</span><span class=p>[</span><span class=nb>tuple</span><span class=p>[</span><span class=n>P4PathDateData</span><span class=p>]]:</span>
        <span class=n>result</span><span class=p>:</span> <span class=nb>list</span><span class=p>[</span><span class=nb>tuple</span><span class=p>[</span><span class=n>P4PathDateData</span><span class=p>]]</span> <span class=o>=</span> <span class=p>[]</span>
        <span class=n>fstat_args</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span><span class=n>fstat_args</span><span class=p>)</span> <span class=k>if</span> <span class=n>fstat_args</span> <span class=k>else</span> <span class=p>[]</span>
        <span class=c1># -Sd: Sort by date.</span>
        <span class=c1># -Rc: Limit output to files mapped into the current workspace.</span>
        <span class=n>fstat_args</span><span class=o>.</span><span class=n>extend</span><span class=p>((</span><span class=s2>&quot;-Sd&quot;</span><span class=p>,</span> <span class=s2>&quot;-Rc&quot;</span><span class=p>))</span>
        <span class=k>for</span> <span class=n>_path</span> <span class=ow>in</span> <span class=n>path</span><span class=p>:</span>
            <span class=k>if</span> <span class=ow>not</span> <span class=n>_path</span><span class=o>.</span><span class=n>endswith</span><span class=p>(</span><span class=s2>&quot;...&quot;</span><span class=p>):</span>
                <span class=k>raise</span> <span class=ne>AttributeError</span><span class=p>(</span>
                    <span class=s2>&quot;get_files_in_folder_in_date_order can only be run on folders!&quot;</span>
                <span class=p>)</span>

            <span class=n>stat</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_connect_get_stat</span><span class=p>((</span><span class=n>_path</span><span class=p>,</span> <span class=p>),</span> <span class=n>args</span><span class=o>=</span><span class=n>fstat_args</span><span class=p>)</span>
            <span class=k>if</span> <span class=n>name_pattern</span><span class=p>:</span>
                <span class=n>name_pattern</span> <span class=o>=</span> <span class=n>name_pattern</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span>

            <span class=n>_extensions</span> <span class=o>=</span> <span class=kc>None</span>
            <span class=k>if</span> <span class=n>extensions</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
                <span class=n>_extensions</span> <span class=o>=</span> <span class=nb>set</span><span class=p>(</span>
                    <span class=p>(</span>
                        <span class=n>extension</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span>
                        <span class=k>if</span> <span class=n>extension</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=s2>&quot;.&quot;</span><span class=p>)</span>
                        <span class=k>else</span> <span class=s2>&quot;.</span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>extension</span><span class=p>)</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span>
                        <span class=k>for</span> <span class=n>extension</span> <span class=ow>in</span> <span class=n>extensions</span>
                    <span class=p>)</span>
                <span class=p>)</span>

            <span class=n>local_path</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_connect_get_local_path</span><span class=p>((</span><span class=n>_path</span><span class=p>,</span> <span class=p>))</span>
            <span class=k>if</span> <span class=ow>not</span> <span class=n>local_path</span><span class=p>:</span>
                <span class=k>continue</span>

            <span class=n>_local_path</span> <span class=o>=</span> <span class=n>local_path</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
            <span class=n>parent_path_client</span> <span class=o>=</span> <span class=n>pathlib</span><span class=o>.</span><span class=n>Path</span><span class=p>(</span><span class=n>_local_path</span><span class=p>)</span>
            <span class=n>path_result</span><span class=p>:</span> <span class=nb>list</span><span class=p>[</span><span class=n>P4PathDateData</span><span class=p>]</span> <span class=o>=</span> <span class=p>[]</span>
            <span class=k>for</span> <span class=n>data</span> <span class=ow>in</span> <span class=n>stat</span><span class=p>:</span>
                <span class=n>path_date_data</span> <span class=o>=</span> <span class=n>P4PathDateData</span><span class=p>()</span>
                <span class=k>if</span> <span class=ow>not</span> <span class=n>data</span><span class=p>:</span>
                    <span class=n>path_date_data</span><span class=o>.</span><span class=n>set_data</span><span class=p>(</span><span class=kc>None</span><span class=p>,</span> <span class=kc>None</span><span class=p>)</span>

                <span class=k>else</span><span class=p>:</span>

                    <span class=n>local_path</span> <span class=o>=</span> <span class=n>pathlib</span><span class=o>.</span><span class=n>Path</span><span class=p>(</span><span class=n>data</span><span class=p>[</span><span class=s2>&quot;clientFile&quot;</span><span class=p>])</span>
                    <span class=k>if</span> <span class=ow>not</span> <span class=n>local_path</span><span class=o>.</span><span class=n>parent</span> <span class=o>==</span> <span class=n>parent_path_client</span><span class=p>:</span>
                        <span class=k>continue</span>

                    <span class=k>if</span> <span class=n>name_pattern</span> <span class=ow>and</span> <span class=n>name_pattern</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>local_path</span><span class=o>.</span><span class=n>stem</span><span class=o>.</span><span class=n>lower</span><span class=p>():</span>
                        <span class=k>continue</span>

                    <span class=k>if</span> <span class=n>_extensions</span> <span class=ow>and</span> <span class=n>local_path</span><span class=o>.</span><span class=n>suffix</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>_extensions</span><span class=p>:</span>
                        <span class=k>continue</span>

                    <span class=k>if</span> <span class=s2>&quot;action&quot;</span> <span class=ow>in</span> <span class=n>data</span> <span class=ow>and</span> <span class=n>data</span><span class=p>[</span><span class=s2>&quot;action&quot;</span><span class=p>]</span> <span class=o>==</span> <span class=s2>&quot;add&quot;</span><span class=p>:</span>
                        <span class=c1># @sharkmob-shea.richardson:</span>
                        <span class=c1># As the file has been marked for add,</span>
                        <span class=c1># all we have to go on is the last time</span>
                        <span class=c1># the file was modified locally:</span>
                        <span class=n>mod_time</span> <span class=o>=</span> <span class=n>local_path</span><span class=o>.</span><span class=n>stat</span><span class=p>()</span><span class=o>.</span><span class=n>st_mtime</span>
                        <span class=n>mod_date</span> <span class=o>=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>datetime</span><span class=o>.</span><span class=n>fromtimestamp</span><span class=p>(</span><span class=n>mod_time</span><span class=p>)</span>
                        <span class=n>path_date_data</span><span class=o>.</span><span class=n>set_data</span><span class=p>(</span><span class=n>local_path</span><span class=p>,</span> <span class=n>mod_date</span><span class=p>)</span>

                    <span class=k>else</span><span class=p>:</span>
                        <span class=n>mod_time</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>data</span><span class=p>[</span><span class=s2>&quot;headTime&quot;</span><span class=p>])</span>
                        <span class=n>mod_date</span> <span class=o>=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>datetime</span><span class=o>.</span><span class=n>fromtimestamp</span><span class=p>(</span><span class=n>mod_time</span><span class=p>)</span>
                        <span class=n>path_date_data</span><span class=o>.</span><span class=n>set_data</span><span class=p>(</span><span class=n>local_path</span><span class=p>,</span> <span class=n>mod_date</span><span class=p>)</span>

                <span class=n>path_result</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>path_date_data</span><span class=p>)</span>

            <span class=n>result</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=nb>tuple</span><span class=p>(</span><span class=n>path_result</span><span class=p>))</span>

        <span class=k>return</span> <span class=n>result</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_connect_get_info</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>p4</span><span class=o>.</span><span class=n>run_info</span><span class=p>()</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_connect_get_latest</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>path</span><span class=p>:</span> <span class=n>T_PthStrLst</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>list</span><span class=p>[</span><span class=nb>bool</span> <span class=o>|</span> <span class=kc>None</span><span class=p>]:</span>
        <span class=k>try</span><span class=p>:</span>
            <span class=n>sync_result</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>p4</span><span class=o>.</span><span class=n>run_sync</span><span class=p>(</span><span class=n>path</span><span class=p>)</span>
            <span class=n>result</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_process_result</span><span class=p>(</span><span class=n>sync_result</span><span class=p>,</span> <span class=s2>&quot;action&quot;</span><span class=p>,</span> <span class=p>(</span><span class=s2>&quot;updated&quot;</span><span class=p>,</span> <span class=s2>&quot;added&quot;</span><span class=p>),</span> <span class=n>set_none</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
            <span class=k>return</span> <span class=n>result</span>
        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>error</span><span class=p>:</span>
            <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>_is_p4_exception</span><span class=p>(</span><span class=n>error</span><span class=p>):</span>
                <span class=k>raise</span>

            <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>p4</span><span class=o>.</span><span class=n>warnings</span><span class=p>:</span>
                <span class=k>raise</span>

            <span class=c1># @sharkmob-shea.richardson:</span>
            <span class=c1># Sync has failed, potentially due to one or more of the files</span>
            <span class=c1># not existing on p4. Let&#39;s filter those files out of `path`</span>
            <span class=c1># and try sync again:</span>
            <span class=n>warnings</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>p4</span><span class=o>.</span><span class=n>warnings</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>  <span class=c1># type: list[str]</span>
            <span class=n>result</span> <span class=o>=</span> <span class=p>[</span><span class=kc>True</span><span class=p>]</span> <span class=o>*</span> <span class=nb>len</span><span class=p>(</span><span class=n>path</span><span class=p>)</span>  <span class=c1># type: list[bool | None]</span>
            <span class=n>latest_paths</span> <span class=o>=</span> <span class=nb>tuple</span><span class=p>(</span>
                <span class=p>(</span>
                    <span class=p>(</span><span class=n>warning</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&quot; - file(s) up-to-date.&quot;</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>),</span> <span class=n>warnings</span><span class=o>.</span><span class=n>remove</span><span class=p>(</span><span class=n>warning</span><span class=p>))[</span><span class=mi>0</span><span class=p>]</span>
                    <span class=k>for</span> <span class=n>warning</span> <span class=ow>in</span> <span class=nb>reversed</span><span class=p>(</span><span class=n>warnings</span><span class=p>)</span>
                    <span class=k>if</span> <span class=s2>&quot;file(s) up-to-date.&quot;</span> <span class=ow>in</span> <span class=n>warning</span>
                <span class=p>)</span>
            <span class=p>)</span>

            <span class=c1># @sharkmob-shea.richardson:</span>
            <span class=c1># All paths are already latest, so lets exit:</span>
            <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>latest_paths</span><span class=p>)</span> <span class=o>==</span> <span class=nb>len</span><span class=p>(</span><span class=n>path</span><span class=p>):</span>
                <span class=k>return</span> <span class=n>result</span>

            <span class=n>local_paths</span> <span class=o>=</span> <span class=nb>tuple</span><span class=p>(</span>
                <span class=p>(</span>
                    <span class=p>(</span><span class=n>warning</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&quot; - no such file(s).&quot;</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>),</span> <span class=n>warnings</span><span class=o>.</span><span class=n>remove</span><span class=p>(</span><span class=n>warning</span><span class=p>))[</span><span class=mi>0</span><span class=p>]</span>
                    <span class=k>for</span> <span class=n>warning</span> <span class=ow>in</span> <span class=nb>reversed</span><span class=p>(</span><span class=n>warnings</span><span class=p>)</span>
                    <span class=k>if</span> <span class=s2>&quot;no such file(s).&quot;</span> <span class=ow>in</span> <span class=n>warning</span>
                <span class=p>)</span>
            <span class=p>)</span>
            <span class=k>if</span> <span class=n>local_paths</span><span class=p>:</span>
                <span class=k>for</span> <span class=n>_path</span> <span class=ow>in</span> <span class=n>local_paths</span><span class=p>:</span>
                    <span class=n>index</span> <span class=o>=</span> <span class=n>path</span><span class=o>.</span><span class=n>index</span><span class=p>(</span><span class=n>_path</span><span class=p>)</span>
                    <span class=n>result</span><span class=p>[</span><span class=n>index</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>

            <span class=k>return</span> <span class=n>result</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_connect_get_local_path</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>path</span><span class=p>:</span> <span class=n>T_PthStrLst</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>tuple</span><span class=p>[</span><span class=nb>str</span><span class=p>]:</span>
        <span class=k>return</span> <span class=nb>tuple</span><span class=p>((</span><span class=n>data</span><span class=p>[</span><span class=s2>&quot;path&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>rstrip</span><span class=p>(</span><span class=s2>&quot;...&quot;</span><span class=p>)</span> <span class=k>for</span> <span class=n>data</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>p4</span><span class=o>.</span><span class=n>run_where</span><span class=p>(</span><span class=n>path</span><span class=p>)))</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_connect_get_newest_file_in_folder</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span>
        <span class=n>path</span><span class=p>:</span> <span class=n>T_PthStrLst</span><span class=p>,</span>
        <span class=n>name_pattern</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=kc>None</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
        <span class=n>extensions</span><span class=p>:</span> <span class=n>Iterable</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>|</span> <span class=kc>None</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
    <span class=p>):</span>
        <span class=n>paths</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_connect_get_files_in_folder_in_date_order</span><span class=p>(</span>
            <span class=n>path</span><span class=p>,</span> <span class=n>name_pattern</span><span class=o>=</span><span class=n>name_pattern</span><span class=p>,</span> <span class=n>extensions</span><span class=o>=</span><span class=n>extensions</span>
        <span class=p>)</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=n>paths</span><span class=p>:</span>
            <span class=k>return</span>

        <span class=k>if</span> <span class=ow>not</span> <span class=n>paths</span><span class=p>[</span><span class=mi>0</span><span class=p>]:</span>
            <span class=k>return</span>

        <span class=k>return</span> <span class=n>paths</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_connect_get_path_locations</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>path</span><span class=p>:</span> <span class=n>T_PthStrLst</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>P4ReturnType</span><span class=p>:</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_connect_get_path_info</span><span class=p>(</span><span class=n>path</span><span class=p>)</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_connect_get_path_info</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>path</span><span class=p>:</span> <span class=n>T_PthStrLst</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>P4ReturnType</span><span class=p>:</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>p4</span><span class=o>.</span><span class=n>run_where</span><span class=p>(</span><span class=n>path</span><span class=p>)</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_connect_get_revision</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span>
        <span class=n>path</span><span class=p>:</span> <span class=n>T_PthStrLst</span><span class=p>,</span>
        <span class=n>revision</span><span class=p>:</span> <span class=nb>int</span> <span class=o>|</span> <span class=nb>tuple</span><span class=p>[</span><span class=nb>int</span><span class=p>],</span>
    <span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>list</span><span class=p>[</span><span class=nb>bool</span><span class=p>]:</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>revision</span><span class=p>,</span> <span class=p>(</span><span class=nb>list</span><span class=p>,</span> <span class=nb>tuple</span><span class=p>)):</span>
            <span class=n>revision</span> <span class=o>=</span> <span class=nb>tuple</span><span class=p>([</span><span class=n>revision</span><span class=p>]</span> <span class=o>*</span> <span class=nb>len</span><span class=p>(</span><span class=n>path</span><span class=p>))</span>

        <span class=k>if</span> <span class=ow>not</span> <span class=nb>len</span><span class=p>(</span><span class=n>revision</span><span class=p>)</span> <span class=o>==</span> <span class=nb>len</span><span class=p>(</span><span class=n>path</span><span class=p>):</span>
            <span class=k>raise</span> <span class=ne>AttributeError</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;revision count (</span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>revision</span><span class=p>)</span><span class=si>}</span><span class=s2>) &quot;</span>
                                 <span class=sa>f</span><span class=s2>&quot;must match path count(</span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>path</span><span class=p>)</span><span class=si>}</span><span class=s2>)!&quot;</span><span class=p>)</span>

        <span class=n>paths</span> <span class=o>=</span> <span class=p>[</span><span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>_path</span><span class=si>}</span><span class=s2>@</span><span class=si>{</span><span class=n>_revision</span><span class=si>}</span><span class=s2>&quot;</span>
                 <span class=k>for</span> <span class=n>_path</span><span class=p>,</span> <span class=n>_revision</span> <span class=ow>in</span> <span class=nb>zip</span><span class=p>(</span><span class=n>path</span><span class=p>,</span> <span class=n>revision</span><span class=p>)]</span>
        <span class=n>sync_result</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>p4</span><span class=o>.</span><span class=n>run_sync</span><span class=p>(</span><span class=n>paths</span><span class=p>)</span>
        <span class=n>result</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_process_result</span><span class=p>(</span>
            <span class=n>sync_result</span><span class=p>,</span>
            <span class=s2>&quot;action&quot;</span><span class=p>,</span>
            <span class=p>(</span><span class=s2>&quot;updated&quot;</span><span class=p>,</span> <span class=s2>&quot;deleted&quot;</span><span class=p>),</span>
            <span class=n>true_pattern</span><span class=o>=</span><span class=s2>&quot; - file(s) up-to-date.&quot;</span>
        <span class=p>)</span>

        <span class=k>return</span> <span class=n>result</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_connect_get_revision_history</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>path</span><span class=p>:</span> <span class=n>T_PthStrLst</span><span class=p>,</span> <span class=n>include_all</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>):</span>
        <span class=n>args</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&quot;-t&quot;</span><span class=p>]</span>
        <span class=c1># if not include_all:</span>
        <span class=c1>#     args.append(&quot;-s&quot;)</span>

        <span class=c1># args_str = &quot; &quot;.join(args)</span>
        <span class=c1># command = f&quot;{args_str} filelog&quot;</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>p4</span><span class=o>.</span><span class=n>run_filelog</span><span class=p>(</span><span class=n>args</span><span class=p>,</span> <span class=n>path</span><span class=p>)</span>
        <span class=c1># return self._connect_run_command(command, path)</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_connect_get_server_path</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>path</span><span class=p>:</span> <span class=n>T_PthStrLst</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>list</span><span class=p>[</span><span class=nb>str</span> <span class=o>|</span> <span class=kc>None</span><span class=p>]:</span>
        <span class=k>return</span> <span class=p>[</span><span class=n>data</span><span class=p>[</span><span class=s2>&quot;depotFile&quot;</span><span class=p>]</span> <span class=k>if</span> <span class=n>data</span> <span class=k>else</span> <span class=kc>None</span> <span class=k>for</span> <span class=n>data</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>p4</span><span class=o>.</span><span class=n>run_where</span><span class=p>(</span><span class=n>path</span><span class=p>)</span> <span class=k>if</span> <span class=n>data</span><span class=p>]</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_connect_get_stat</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span> <span class=n>path</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=n>Sequence</span><span class=p>[</span><span class=nb>str</span><span class=p>],</span> <span class=n>args</span><span class=p>:</span> <span class=n>P4ArgsType</span> <span class=o>=</span> <span class=kc>None</span>
    <span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>list</span><span class=p>[</span><span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>str</span><span class=p>]]:</span>

        <span class=n>args</span> <span class=o>=</span> <span class=n>args</span> <span class=ow>or</span> <span class=p>[]</span>
        <span class=k>try</span><span class=p>:</span>
            <span class=c1># @sharkmob-shea.richardson:</span>
            <span class=c1># We query fstat of all the given paths.</span>
            <span class=c1># In most cases this will be a valid path or paths.</span>
            <span class=c1># If the path is invalid, ie doesn&#39;t exist, then this</span>
            <span class=c1># will throw an exception</span>
            <span class=n>stat</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>p4</span><span class=o>.</span><span class=n>run_fstat</span><span class=p>([</span><span class=n>args</span><span class=p>,</span> <span class=n>path</span><span class=p>])</span>
        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>error</span><span class=p>:</span>
            <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>_is_p4_exception</span><span class=p>(</span><span class=n>error</span><span class=p>):</span>
                <span class=k>raise</span>

            <span class=k>def</span><span class=w> </span><span class=nf>_cull_no_such_file_warnings</span><span class=p>(</span><span class=n>index</span><span class=p>,</span> <span class=n>warning</span><span class=p>,</span> <span class=n>warnings_count</span><span class=p>):</span>
                <span class=c1># type: (int, str, int) -&gt; str</span>
                <span class=n>index</span> <span class=o>=</span> <span class=n>warnings_count</span> <span class=o>-</span> <span class=n>index</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>p4</span><span class=o>.</span><span class=n>warnings</span><span class=o>.</span><span class=n>pop</span><span class=p>(</span><span class=n>index</span><span class=p>)</span>
                <span class=k>return</span> <span class=n>warning</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&quot; - no such file(s).&quot;</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>)</span>

            <span class=c1># @sharkmob-shea.richardson:</span>
            <span class=c1># fstat has failed, potentially due to one or more of the files</span>
            <span class=c1># not existing on p4. Let&#39;s filter those files out of `path`</span>
            <span class=c1># and try fstat again:</span>
            <span class=n>path</span> <span class=o>=</span> <span class=n>typing</span><span class=o>.</span><span class=n>cast</span><span class=p>(</span><span class=n>T_StrTuple</span><span class=p>,</span> <span class=n>path</span><span class=p>)</span>
            <span class=n>warnings</span> <span class=o>=</span> <span class=nb>tuple</span><span class=p>(</span><span class=nb>reversed</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>p4</span><span class=o>.</span><span class=n>warnings</span><span class=p>))</span>
            <span class=n>warnings_count</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>warnings</span><span class=p>)</span> <span class=o>-</span> <span class=mi>1</span>
            <span class=n>excluded_paths</span> <span class=o>=</span> <span class=p>(</span>
                <span class=n>_cull_no_such_file_warnings</span><span class=p>(</span><span class=n>index</span><span class=p>,</span> <span class=n>warning</span><span class=p>,</span> <span class=n>warnings_count</span><span class=p>)</span>
                <span class=k>for</span> <span class=n>index</span><span class=p>,</span> <span class=n>warning</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>warnings</span><span class=p>)</span>
                <span class=k>if</span> <span class=s2>&quot;no such file(s).&quot;</span> <span class=ow>in</span> <span class=n>warning</span>
            <span class=p>)</span>  <span class=c1># type: Generator[str, None, None]</span>
            <span class=n>exclude_data</span> <span class=o>=</span> <span class=p>{</span><span class=n>path</span><span class=o>.</span><span class=n>index</span><span class=p>(</span><span class=n>excluded_path</span><span class=p>):</span> <span class=n>excluded_path</span> <span class=k>for</span> <span class=n>excluded_path</span> <span class=ow>in</span> <span class=n>excluded_paths</span><span class=p>}</span>
            <span class=n>p4_path</span> <span class=o>=</span> <span class=nb>tuple</span><span class=p>(</span><span class=nb>filter</span><span class=p>(</span><span class=k>lambda</span> <span class=n>i</span><span class=p>:</span> <span class=n>i</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>exclude_data</span><span class=o>.</span><span class=n>values</span><span class=p>(),</span> <span class=n>path</span><span class=p>))</span>
            <span class=n>stat</span><span class=p>:</span> <span class=nb>list</span><span class=p>[</span><span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>p4</span><span class=o>.</span><span class=n>run_fstat</span><span class=p>([</span><span class=n>args</span><span class=p>,</span> <span class=n>p4_path</span><span class=p>])</span> <span class=k>if</span> <span class=n>p4_path</span> <span class=k>else</span> <span class=p>[]</span>

            <span class=c1># @sharkmob-shea.richardson:</span>
            <span class=c1># we now need to add an empty dict into the indicies of</span>
            <span class=c1># the files that don&#39;t exist in perforce to allow</span>
            <span class=c1># the results to be mapped correctly when returned</span>
            <span class=c1># from __connect__</span>
            <span class=n>empty_dict</span> <span class=o>=</span> <span class=p>{}</span>
            <span class=k>for</span> <span class=n>index</span> <span class=ow>in</span> <span class=nb>sorted</span><span class=p>((</span><span class=n>exclude_data</span><span class=o>.</span><span class=n>keys</span><span class=p>())):</span>
                <span class=n>stat</span><span class=o>.</span><span class=n>insert</span><span class=p>(</span><span class=n>index</span><span class=p>,</span> <span class=n>empty_dict</span><span class=p>)</span>

        <span class=k>return</span> <span class=n>stat</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_connect_get_streams</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>tuple</span><span class=p>[</span><span class=nb>str</span><span class=p>]:</span>
        <span class=n>streams</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>p4</span><span class=o>.</span><span class=n>run_streams</span><span class=p>()</span>
        <span class=k>return</span> <span class=nb>tuple</span><span class=p>((</span><span class=n>stream</span><span class=p>[</span><span class=s2>&quot;Stream&quot;</span><span class=p>]</span> <span class=k>for</span> <span class=n>stream</span> <span class=ow>in</span> <span class=n>streams</span><span class=p>))</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_connect_get_user_name</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
        <span class=n>user_data</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>p4</span><span class=o>.</span><span class=n>run_user</span><span class=p>(</span><span class=s2>&quot;-o&quot;</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span>
        <span class=k>return</span> <span class=n>user_data</span><span class=p>[</span><span class=s2>&quot;User&quot;</span><span class=p>]</span> <span class=k>if</span> <span class=n>user_data</span> <span class=ow>and</span> <span class=s2>&quot;User&quot;</span> <span class=ow>in</span> <span class=n>user_data</span> <span class=k>else</span> <span class=s2>&quot;&quot;</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_connect_get_workspaces</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>stream</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=kc>None</span> <span class=o>=</span> <span class=kc>None</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>list</span><span class=p>[</span><span class=nb>str</span><span class=p>]:</span>
        <span class=n>host_name</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>host_name</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span>
        <span class=n>client_data</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>p4</span><span class=o>.</span><span class=n>run_clients</span><span class=p>(</span><span class=s2>&quot;--me&quot;</span><span class=p>)</span>
        <span class=k>if</span> <span class=n>stream</span><span class=p>:</span>
            <span class=n>stream</span> <span class=o>=</span> <span class=n>stream</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span>
            <span class=n>workspaces</span> <span class=o>=</span> <span class=p>(</span>
                <span class=n>data</span><span class=p>[</span><span class=s2>&quot;client&quot;</span><span class=p>]</span>
                <span class=k>for</span> <span class=n>data</span> <span class=ow>in</span> <span class=n>client_data</span>
                <span class=k>if</span> <span class=n>data</span><span class=p>[</span><span class=s2>&quot;Host&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span> <span class=o>==</span> <span class=n>host_name</span> <span class=ow>and</span> <span class=n>data</span><span class=p>[</span><span class=s2>&quot;Stream&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span> <span class=o>==</span> <span class=n>stream</span>
            <span class=p>)</span>

        <span class=k>else</span><span class=p>:</span>
            <span class=n>workspaces</span> <span class=o>=</span> <span class=p>(</span><span class=n>data</span><span class=p>[</span><span class=s2>&quot;client&quot;</span><span class=p>]</span> <span class=k>for</span> <span class=n>data</span> <span class=ow>in</span> <span class=n>client_data</span> <span class=k>if</span> <span class=n>data</span><span class=p>[</span><span class=s2>&quot;Host&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span> <span class=o>==</span> <span class=n>host_name</span><span class=p>)</span>

        <span class=n>workspaces</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span><span class=nb>dict</span><span class=o>.</span><span class=n>fromkeys</span><span class=p>(</span><span class=n>workspaces</span><span class=p>)</span><span class=o>.</span><span class=n>keys</span><span class=p>())</span>
        <span class=k>return</span> <span class=n>workspaces</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_connect_is_checked_out_by_user</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span> <span class=n>path</span><span class=p>:</span> <span class=n>T_PthStrLst</span><span class=p>,</span> <span class=n>user_name</span><span class=p>:</span> <span class=nb>tuple</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>|</span> <span class=nb>str</span> <span class=o>|</span> <span class=kc>None</span> <span class=o>=</span> <span class=kc>None</span>
    <span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>list</span><span class=p>[</span><span class=nb>bool</span><span class=p>]:</span>
        <span class=n>result</span><span class=p>:</span> <span class=nb>list</span><span class=p>[</span><span class=nb>bool</span><span class=p>]</span> <span class=o>=</span> <span class=p>[]</span>
        <span class=n>checked_out_by</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_connect_checked_out_by</span><span class=p>(</span><span class=n>path</span><span class=p>)</span>
        <span class=n>user_names</span> <span class=o>=</span> <span class=kc>None</span> <span class=k>if</span> <span class=n>user_name</span> <span class=ow>is</span> <span class=kc>None</span> <span class=k>else</span> <span class=n>make_tuple_if_not</span><span class=p>(</span><span class=n>user_name</span><span class=p>)</span>
        <span class=n>user_names</span> <span class=o>=</span> <span class=nb>set</span><span class=p>(</span><span class=n>user_names</span> <span class=ow>or</span> <span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_connect_get_user_name</span><span class=p>(),))</span>
        <span class=k>for</span> <span class=n>_checked_out_by</span> <span class=ow>in</span> <span class=n>checked_out_by</span><span class=p>:</span>
            <span class=k>if</span> <span class=n>_checked_out_by</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
                <span class=n>result</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=kc>False</span><span class=p>)</span>
                <span class=k>continue</span>

            <span class=n>user_found</span> <span class=o>=</span> <span class=kc>False</span>
            <span class=n>checked_out_by_set</span> <span class=o>=</span> <span class=nb>set</span><span class=p>((</span><span class=n>name</span> <span class=k>for</span> <span class=n>name</span><span class=p>,</span> <span class=n>_</span> <span class=ow>in</span> <span class=n>_checked_out_by</span><span class=p>))</span>
            <span class=k>for</span> <span class=n>user_name</span> <span class=ow>in</span> <span class=n>user_names</span><span class=p>:</span>
                <span class=k>if</span> <span class=n>user_name</span> <span class=ow>in</span> <span class=n>checked_out_by_set</span><span class=p>:</span>
                    <span class=n>user_found</span> <span class=o>=</span> <span class=kc>True</span>
                    <span class=k>break</span>

            <span class=k>if</span> <span class=n>user_found</span><span class=p>:</span>
                <span class=n>result</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=kc>True</span><span class=p>)</span>
                <span class=k>continue</span>

            <span class=n>result</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=kc>False</span><span class=p>)</span>

        <span class=k>return</span> <span class=n>result</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_connect_is_checked_out</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>path</span><span class=p>:</span> <span class=n>T_PthStrLst</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>list</span><span class=p>[</span><span class=nb>bool</span> <span class=o>|</span> <span class=kc>None</span><span class=p>]:</span>
        <span class=n>stat_result</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_connect_get_stat</span><span class=p>(</span><span class=n>path</span><span class=p>)</span>
        <span class=n>result</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_process_result</span><span class=p>(</span>
            <span class=n>stat_result</span><span class=p>,</span>
            <span class=p>(</span><span class=s2>&quot;otherAction&quot;</span><span class=p>,</span> <span class=s2>&quot;action&quot;</span><span class=p>),</span>
            <span class=p>(</span><span class=s2>&quot;edit&quot;</span><span class=p>,</span> <span class=s2>&quot;add&quot;</span><span class=p>),</span>
            <span class=n>none_keys</span><span class=o>=</span><span class=p>(</span><span class=s2>&quot;headAction&quot;</span><span class=p>,</span> <span class=p>),</span>
            <span class=n>none_actions</span><span class=o>=</span><span class=p>(</span><span class=s2>&quot;delete&quot;</span><span class=p>,</span> <span class=p>),</span>
            <span class=n>set_none</span><span class=o>=</span><span class=kc>True</span>
        <span class=p>)</span>

        <span class=k>return</span> <span class=n>result</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_connect_is_latest</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>path</span><span class=p>):</span>
        <span class=c1># type: (Sequence[str]) -&gt; tuple[bool | None]</span>
        <span class=n>result</span> <span class=o>=</span> <span class=nb>dict</span><span class=o>.</span><span class=n>fromkeys</span><span class=p>(</span><span class=n>path</span><span class=p>,</span> <span class=kc>False</span><span class=p>)</span>  <span class=c1># type: dict[str, bool | None]</span>
        <span class=n>files</span> <span class=o>=</span> <span class=p>[]</span>  <span class=c1># type: list[str]</span>
        <span class=n>folders</span> <span class=o>=</span> <span class=p>[]</span>  <span class=c1># type: list[str]</span>
        <span class=k>for</span> <span class=n>_path</span> <span class=ow>in</span> <span class=n>path</span><span class=p>:</span>
            <span class=k>if</span> <span class=n>_path</span><span class=o>.</span><span class=n>endswith</span><span class=p>(</span><span class=s2>&quot;...&quot;</span><span class=p>):</span>
                <span class=n>folders</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>_path</span><span class=p>)</span>
                <span class=k>continue</span>
            <span class=n>files</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>_path</span><span class=p>)</span>

        <span class=k>if</span> <span class=n>folders</span><span class=p>:</span>
            <span class=k>def</span><span class=w> </span><span class=nf>_is_folder_latest</span><span class=p>(</span><span class=n>folder</span><span class=p>):</span>
                <span class=c1># type: (str) -&gt; bool | None</span>
                <span class=c1># @sharkmob-shea.richardson</span>
                <span class=c1># We have to test each folder individually else P4</span>
                <span class=c1># condenses all the returned statistics into one.</span>
                <span class=c1># This makes it impossible to work out which folders</span>
                <span class=c1># need syncing and which do not.</span>
                <span class=k>try</span><span class=p>:</span>
                    <span class=n>sync_result</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>p4</span><span class=o>.</span><span class=n>run_sync</span><span class=p>((</span><span class=s2>&quot;-N&quot;</span><span class=p>),</span> <span class=n>folder</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span>
                <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>error</span><span class=p>:</span>
                    <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>_is_p4_exception</span><span class=p>(</span><span class=n>error</span><span class=p>):</span>
                        <span class=k>raise</span>

                    <span class=k>return</span> <span class=kc>None</span>

                <span class=n>change_count_str</span> <span class=o>=</span> <span class=n>sync_result</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&quot;=&quot;</span><span class=p>)[</span><span class=mi>1</span><span class=p>]</span>  <span class=c1># type: str</span>
                <span class=n>change_count_str</span> <span class=o>=</span> <span class=n>change_count_str</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&quot;,&quot;</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span>
                <span class=n>change_counts</span> <span class=o>=</span> <span class=p>(</span><span class=nb>bool</span><span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=n>value</span><span class=p>))</span> <span class=k>for</span> <span class=n>value</span> <span class=ow>in</span> <span class=n>change_count_str</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&quot;/&quot;</span><span class=p>))</span>
                <span class=k>return</span> <span class=ow>not</span> <span class=nb>any</span><span class=p>(</span><span class=n>change_counts</span><span class=p>)</span>

            <span class=k>for</span> <span class=n>folder</span> <span class=ow>in</span> <span class=n>folders</span><span class=p>:</span>
                <span class=n>result</span><span class=p>[</span><span class=n>folder</span><span class=p>]</span> <span class=o>=</span> <span class=n>_is_folder_latest</span><span class=p>(</span><span class=n>folder</span><span class=p>)</span>

        <span class=n>stat</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_connect_get_stat</span><span class=p>(</span><span class=n>files</span><span class=p>)</span>
        <span class=n>valid_states</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&quot;add&quot;</span><span class=p>,</span> <span class=s2>&quot;move/add&quot;</span><span class=p>,</span> <span class=s2>&quot;edit&quot;</span><span class=p>}</span>
        <span class=k>def</span><span class=w> </span><span class=nf>_is_file_latest</span><span class=p>(</span><span class=n>data</span><span class=p>):</span>
            <span class=c1># type: (dict) -&gt; bool | None</span>
            <span class=k>if</span> <span class=ow>not</span> <span class=n>data</span><span class=p>:</span>
                <span class=k>return</span>
            <span class=k>if</span> <span class=s2>&quot;action&quot;</span> <span class=ow>in</span> <span class=n>data</span> <span class=ow>and</span> <span class=n>data</span><span class=p>[</span><span class=s2>&quot;action&quot;</span><span class=p>]</span> <span class=ow>in</span> <span class=n>valid_states</span><span class=p>:</span>
                <span class=k>return</span> <span class=kc>True</span>
            <span class=k>if</span> <span class=s2>&quot;headRev&quot;</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>data</span><span class=p>:</span>
                <span class=k>return</span> <span class=kc>False</span>
            <span class=k>if</span> <span class=s2>&quot;haveRev&quot;</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>data</span><span class=p>:</span>
                <span class=k>return</span> <span class=kc>False</span>

            <span class=k>return</span> <span class=n>data</span><span class=p>[</span><span class=s2>&quot;headRev&quot;</span><span class=p>]</span> <span class=o>==</span> <span class=n>data</span><span class=p>[</span><span class=s2>&quot;haveRev&quot;</span><span class=p>]</span>

        <span class=k>for</span> <span class=n>file</span><span class=p>,</span> <span class=n>data</span> <span class=ow>in</span> <span class=nb>zip</span><span class=p>(</span><span class=n>files</span><span class=p>,</span> <span class=n>stat</span><span class=p>):</span>
            <span class=n>is_latest</span> <span class=o>=</span> <span class=n>_is_file_latest</span><span class=p>(</span><span class=n>data</span><span class=p>)</span>
            <span class=n>result</span><span class=p>[</span><span class=n>file</span><span class=p>]</span> <span class=o>=</span> <span class=n>is_latest</span>

        <span class=k>return</span> <span class=nb>tuple</span><span class=p>(</span><span class=n>result</span><span class=o>.</span><span class=n>values</span><span class=p>())</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_connect_is_stream_valid</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>stream</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
        <span class=n>streams</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_connect_get_streams</span><span class=p>()</span>
        <span class=k>return</span> <span class=n>stream</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span> <span class=ow>in</span> <span class=nb>set</span><span class=p>([</span><span class=n>stream</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span> <span class=k>for</span> <span class=n>stream</span> <span class=ow>in</span> <span class=n>streams</span><span class=p>])</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_connect_move</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span>
        <span class=n>path</span><span class=p>:</span> <span class=n>T_PthStrLst</span><span class=p>,</span>
        <span class=n>target_path</span><span class=p>:</span> <span class=n>T_PthStrLst</span><span class=p>,</span>
        <span class=n>change_description</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=kc>None</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
        <span class=n>get_latest</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>True</span>
    <span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>list</span><span class=p>[</span><span class=nb>bool</span><span class=p>]:</span>
        <span class=n>target_path</span> <span class=o>=</span> <span class=n>make_tuple_if_not</span><span class=p>(</span><span class=n>target_path</span><span class=p>)</span>  <span class=c1># type: ignore</span>
        <span class=n>clean_paths</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_clean_p4_paths</span><span class=p>(</span><span class=n>target_path</span><span class=p>)</span>
        <span class=k>if</span> <span class=n>get_latest</span><span class=p>:</span>
            <span class=n>paths_to_sync</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span><span class=n>path</span><span class=p>)</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>
            <span class=n>paths_to_sync</span><span class=o>.</span><span class=n>extend</span><span class=p>(</span>
                <span class=p>(</span>
                    <span class=n>path</span> <span class=k>for</span> <span class=n>path</span>
                    <span class=ow>in</span> <span class=n>clean_paths</span>
                    <span class=k>if</span> <span class=n>pathlib</span><span class=o>.</span><span class=n>Path</span><span class=p>(</span><span class=n>path</span><span class=p>)</span><span class=o>.</span><span class=n>exists</span><span class=p>()</span>
                <span class=p>)</span>
            <span class=p>)</span>
            <span class=k>if</span> <span class=n>paths_to_sync</span><span class=p>:</span>
                <span class=n>sync_result</span> <span class=o>=</span> <span class=p>{}</span>
                <span class=k>try</span><span class=p>:</span>
                    <span class=n>sync_result</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_connect_get_latest</span><span class=p>(</span><span class=n>paths_to_sync</span><span class=p>)</span>
                <span class=k>except</span> <span class=n>P4</span><span class=o>.</span><span class=n>P4Exception</span><span class=p>:</span>
                    <span class=k>pass</span>

                <span class=k>for</span> <span class=n>result</span> <span class=ow>in</span> <span class=n>paths_to_sync</span><span class=p>:</span>
                    <span class=k>if</span> <span class=n>sync_result</span> <span class=ow>is</span> <span class=kc>False</span><span class=p>:</span>
                        <span class=k>raise</span> <span class=n>P4</span><span class=o>.</span><span class=n>P4Exception</span><span class=p>(</span><span class=s2>&quot;Files are not the latest versions!&quot;</span><span class=p>)</span>

        <span class=n>path</span> <span class=o>=</span> <span class=n>typing</span><span class=o>.</span><span class=n>cast</span><span class=p>(</span><span class=n>T_StrTuple</span><span class=p>,</span> <span class=n>path</span><span class=p>)</span>
        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>path</span><span class=p>)</span> <span class=o>!=</span> <span class=nb>len</span><span class=p>(</span><span class=n>clean_paths</span><span class=p>):</span>
            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;path length must equal target_path length&quot;</span><span class=p>)</span>

        <span class=bp>self</span><span class=o>.</span><span class=n>_connect_checkout</span><span class=p>(</span><span class=n>path</span><span class=p>,</span> <span class=n>change_description</span><span class=o>=</span><span class=n>change_description</span><span class=p>)</span>
        <span class=n>args</span> <span class=o>=</span> <span class=p>[]</span>
        <span class=k>if</span> <span class=n>change_description</span><span class=p>:</span>
            <span class=n>change_number</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_connect_get_change_list_number</span><span class=p>(</span><span class=n>change_description</span><span class=p>)</span>
            <span class=n>args</span><span class=o>.</span><span class=n>extend</span><span class=p>((</span><span class=s2>&quot;-c&quot;</span><span class=p>,</span> <span class=n>change_number</span><span class=p>))</span>

        <span class=n>move_result</span> <span class=o>=</span> <span class=p>[]</span>
        <span class=k>for</span> <span class=n>source</span><span class=p>,</span> <span class=n>target</span> <span class=ow>in</span> <span class=nb>zip</span><span class=p>(</span><span class=n>path</span><span class=p>,</span> <span class=n>target_path</span><span class=p>):</span>
            <span class=n>_args</span> <span class=o>=</span> <span class=n>args</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>
            <span class=n>_args</span><span class=o>.</span><span class=n>extend</span><span class=p>((</span><span class=n>source</span><span class=p>,</span> <span class=n>target</span><span class=p>))</span>
            <span class=n>result</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>p4</span><span class=o>.</span><span class=n>run_move</span><span class=p>(</span><span class=n>_args</span><span class=p>)</span>
            <span class=n>move_result</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>result</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span>

        <span class=n>result</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_process_result</span><span class=p>(</span>
            <span class=n>move_result</span><span class=p>,</span>
            <span class=s2>&quot;action&quot;</span><span class=p>,</span>
            <span class=s2>&quot;move/add&quot;</span><span class=p>,</span>
            <span class=n>true_pattern</span><span class=o>=</span><span class=s2>&quot;can&#39;t move (already opened for move/delete)&quot;</span>
        <span class=p>)</span>

        <span class=k>return</span> <span class=n>result</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_connect_revert</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>path</span><span class=p>:</span> <span class=n>T_PthStrLst</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>list</span><span class=p>[</span><span class=nb>bool</span><span class=p>]</span> <span class=o>|</span> <span class=kc>None</span><span class=p>:</span>
        <span class=n>revert_result</span><span class=p>:</span> <span class=nb>list</span><span class=p>[</span><span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>p4</span><span class=o>.</span><span class=n>run_revert</span><span class=p>(</span><span class=n>path</span><span class=p>)</span>
        <span class=n>_revert_result</span> <span class=o>=</span> <span class=p>(</span><span class=n>data</span> <span class=k>for</span> <span class=n>data</span> <span class=ow>in</span> <span class=n>revert_result</span> <span class=k>if</span> <span class=n>data</span><span class=p>[</span><span class=s2>&quot;clientFile&quot;</span><span class=p>]</span> <span class=ow>in</span> <span class=n>path</span> <span class=ow>or</span> <span class=n>data</span><span class=p>[</span><span class=s2>&quot;depotFile&quot;</span><span class=p>]</span> <span class=ow>in</span> <span class=n>path</span><span class=p>)</span>
        <span class=n>result</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_process_result</span><span class=p>(</span>
            <span class=n>_revert_result</span><span class=p>,</span>
            <span class=s2>&quot;action&quot;</span><span class=p>,</span>
            <span class=p>(</span><span class=s2>&quot;abandoned&quot;</span><span class=p>,</span> <span class=s2>&quot;reverted&quot;</span><span class=p>,</span> <span class=s2>&quot;deleted&quot;</span><span class=p>),</span>
            <span class=n>true_pattern</span><span class=o>=</span><span class=s2>&quot;- currently opened for&quot;</span>
        <span class=p>)</span>
        <span class=k>return</span> <span class=n>result</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_connect_run_command</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>cmd</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
        <span class=n>result</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>p4</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>cmd</span><span class=p>,</span> <span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
        <span class=k>return</span> <span class=n>result</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_connect_set_attribute</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>path</span><span class=p>:</span> <span class=n>T_PthStrLst</span><span class=p>,</span> <span class=n>name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>value</span><span class=p>:</span> <span class=n>Any</span><span class=p>):</span>
        <span class=n>attrubute_result</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>p4</span><span class=o>.</span><span class=n>run_attribute</span><span class=p>((</span><span class=s2>&quot;-n&quot;</span><span class=p>,</span> <span class=n>name</span><span class=p>,</span> <span class=s2>&quot;-v&quot;</span><span class=p>,</span> <span class=n>value</span><span class=p>),</span> <span class=n>path</span><span class=p>)</span>
        <span class=n>result</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_process_result</span><span class=p>(</span><span class=n>attrubute_result</span><span class=p>,</span> <span class=s2>&quot;status&quot;</span><span class=p>,</span> <span class=s2>&quot;set&quot;</span><span class=p>)</span>
        <span class=k>return</span> <span class=n>result</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_connect_submit_change_list</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>change_description</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>int</span> <span class=o>|</span> <span class=kc>None</span><span class=p>:</span>
        <span class=n>change_list_spec</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_connect_get_existing_change_list</span><span class=p>(</span><span class=n>change_description</span><span class=p>)</span>
        <span class=n>result</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>p4</span><span class=o>.</span><span class=n>run_submit</span><span class=p>(</span><span class=n>change_list_spec</span><span class=p>)</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=n>result</span><span class=p>:</span>
            <span class=k>return</span> <span class=kc>None</span>

        <span class=k>return</span> <span class=nb>int</span><span class=p>(</span><span class=n>result</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=s2>&quot;change&quot;</span><span class=p>])</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_connect_sync</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>path</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Synonym for get_latest</span>
<span class=sd>        &quot;&quot;&quot;</span>

        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_connect_get_latest</span><span class=p>(</span><span class=n>path</span><span class=p>)</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_connect_unsync</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>path</span><span class=p>:</span> <span class=n>T_PthStrLst</span><span class=p>):</span>
        <span class=n>_path</span> <span class=o>=</span> <span class=p>[</span><span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>p</span><span class=si>}</span><span class=s2>#none&quot;</span> <span class=k>for</span> <span class=n>p</span> <span class=ow>in</span> <span class=n>path</span><span class=p>]</span> <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>path</span><span class=p>,</span> <span class=p>(</span><span class=nb>list</span><span class=p>,</span> <span class=nb>tuple</span><span class=p>))</span> <span class=k>else</span> <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>path</span><span class=si>}</span><span class=s2>#none&quot;</span>
        <span class=n>sync_result</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>p4</span><span class=o>.</span><span class=n>run_sync</span><span class=p>(</span><span class=n>_path</span><span class=p>)</span>
        <span class=n>result</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_process_result</span><span class=p>(</span><span class=n>sync_result</span><span class=p>,</span> <span class=s2>&quot;action&quot;</span><span class=p>,</span> <span class=s2>&quot;deleted&quot;</span><span class=p>)</span>
        <span class=k>return</span> <span class=n>result</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_connect_update_change_list_description</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>old_description</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>new_description</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
        <span class=n>change_list_spec</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_connect_get_existing_change_list</span><span class=p>(</span><span class=n>old_description</span><span class=p>)</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=n>change_list_spec</span><span class=p>:</span>
            <span class=k>raise</span> <span class=n>P4</span><span class=o>.</span><span class=n>P4Exception</span><span class=p>(</span><span class=s2>&quot;Changelist not found&quot;</span><span class=p>)</span>

        <span class=n>change_list_spec</span><span class=p>[</span><span class=s2>&quot;Description&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>new_description</span>
        <span class=n>change_result</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>p4</span><span class=o>.</span><span class=n>save_change</span><span class=p>(</span><span class=n>change_list_spec</span><span class=p>)</span>
        <span class=n>result</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_process_result</span><span class=p>(</span>
            <span class=n>change_result</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>,</span> <span class=n>true_pattern</span><span class=o>=</span><span class=sa>f</span><span class=s2>&quot;Change </span><span class=si>{</span><span class=n>change_list_spec</span><span class=p>[</span><span class=s1>&#39;Change&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2> updated.&quot;</span>
        <span class=p>)</span>
        <span class=k>return</span> <span class=n>result</span>

    <span class=c1># Public Methods:</span>
    <span class=nd>@contextmanager</span>
    <span class=k>def</span><span class=w> </span><span class=nf>workspace_as</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>workspace</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Iterator</span><span class=p>[</span><span class=kc>None</span><span class=p>]:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Context manager that connects to if not already connected p4,</span>
<span class=sd>        yielding the instance of p4 and closing the connection when done.</span>
<span class=sd>        &quot;&quot;&quot;</span>

        <span class=n>current_workspace</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>p4</span><span class=o>.</span><span class=n>client</span>
        <span class=k>try</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>p4</span><span class=o>.</span><span class=n>client</span> <span class=o>=</span> <span class=n>workspace</span>
            <span class=k>yield</span>

        <span class=k>except</span><span class=p>:</span>
            <span class=k>raise</span>

        <span class=k>finally</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>p4</span><span class=o>.</span><span class=n>client</span> <span class=o>=</span> <span class=n>current_workspace</span>

    <span class=k>def</span><span class=w> </span><span class=nf>test_connection</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
        <span class=k>try</span><span class=p>:</span>
            <span class=k>with</span> <span class=bp>self</span><span class=o>.</span><span class=n>p4</span><span class=o>.</span><span class=n>connect</span><span class=p>():</span>
                <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_is_offline</span><span class=p>:</span>
                    <span class=bp>self</span><span class=o>.</span><span class=n>_signaller</span><span class=o>.</span><span class=n>connected</span><span class=o>.</span><span class=n>emit</span><span class=p>()</span>
                    <span class=bp>self</span><span class=o>.</span><span class=n>_is_offline</span> <span class=o>=</span> <span class=kc>False</span>

                <span class=bp>self</span><span class=o>.</span><span class=n>_start_retry_p4_connection_timer</span><span class=p>(</span><span class=n>interval</span><span class=o>=</span><span class=mi>60</span><span class=p>)</span>
                <span class=k>return</span> <span class=kc>True</span>

        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>error</span><span class=p>:</span>
            <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>_is_p4_exception</span><span class=p>(</span><span class=n>error</span><span class=p>):</span>
                <span class=k>raise</span>

            <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>_is_offline</span><span class=p>:</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>_is_offline</span> <span class=o>=</span> <span class=kc>True</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>_signaller</span><span class=o>.</span><span class=n>disconnected</span><span class=o>.</span><span class=n>emit</span><span class=p>()</span>

            <span class=bp>self</span><span class=o>.</span><span class=n>_start_retry_p4_connection_timer</span><span class=p>()</span>
            <span class=k>return</span> <span class=kc>False</span>
</code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> <div class="doc doc-object doc-function"> <h3 id=client.version_control.backends.perforce.api.P4ConnectionManager.__connect__ class="doc doc-heading"> <code class="highlight language-python"><span class=n>__connect__</span><span class=p>()</span></code> </h3> <div class="doc doc-contents "> <p>Context manager that connects to if not already connected p4, yielding the instance of p4 and closing the connection when done.</p> <details class=quote> <summary>Source code in <code>client/version_control/backends/perforce/api/__init__.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>333</span>
<span class=normal>334</span>
<span class=normal>335</span>
<span class=normal>336</span>
<span class=normal>337</span>
<span class=normal>338</span>
<span class=normal>339</span>
<span class=normal>340</span>
<span class=normal>341</span>
<span class=normal>342</span>
<span class=normal>343</span>
<span class=normal>344</span>
<span class=normal>345</span>
<span class=normal>346</span>
<span class=normal>347</span>
<span class=normal>348</span>
<span class=normal>349</span>
<span class=normal>350</span>
<span class=normal>351</span>
<span class=normal>352</span>
<span class=normal>353</span>
<span class=normal>354</span>
<span class=normal>355</span>
<span class=normal>356</span>
<span class=normal>357</span>
<span class=normal>358</span>
<span class=normal>359</span>
<span class=normal>360</span>
<span class=normal>361</span>
<span class=normal>362</span>
<span class=normal>363</span>
<span class=normal>364</span>
<span class=normal>365</span>
<span class=normal>366</span>
<span class=normal>367</span>
<span class=normal>368</span>
<span class=normal>369</span>
<span class=normal>370</span>
<span class=normal>371</span>
<span class=normal>372</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nd>@contextmanager</span>
<span class=k>def</span><span class=w> </span><span class=nf>__connect__</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Generator</span><span class=p>[</span><span class=n>P4</span><span class=o>.</span><span class=n>P4</span> <span class=o>|</span> <span class=kc>None</span><span class=p>,</span> <span class=kc>None</span><span class=p>,</span> <span class=kc>None</span><span class=p>]:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Context manager that connects to if not already connected p4,</span>
<span class=sd>    yielding the instance of p4 and closing the connection when done.</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_is_offline</span><span class=p>:</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>_retry_p4_connection</span><span class=p>:</span>
            <span class=k>yield</span>
            <span class=k>return</span>

    <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>p4</span><span class=o>.</span><span class=n>connected</span><span class=p>():</span>
        <span class=k>try</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>p4</span><span class=o>.</span><span class=n>connect</span><span class=p>()</span>
            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_is_offline</span><span class=p>:</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>_signaller</span><span class=o>.</span><span class=n>connected</span><span class=o>.</span><span class=n>emit</span><span class=p>()</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>_is_offline</span> <span class=o>=</span> <span class=kc>False</span>
        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>error</span><span class=p>:</span>
            <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>_is_p4_exception</span><span class=p>(</span><span class=n>error</span><span class=p>):</span>
                <span class=k>raise</span>

            <span class=k>if</span> <span class=s2>&quot;[P4.connect()] Connect to server failed; check $P4PORT&quot;</span> <span class=ow>not</span> <span class=ow>in</span> <span class=nb>str</span><span class=p>(</span><span class=n>error</span><span class=p>):</span>
                <span class=k>raise</span>

            <span class=bp>self</span><span class=o>.</span><span class=n>_is_offline</span> <span class=o>=</span> <span class=kc>True</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_signaller</span><span class=o>.</span><span class=n>disconnected</span><span class=o>.</span><span class=n>emit</span><span class=p>()</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_start_retry_p4_connection_timer</span><span class=p>()</span>
            <span class=k>yield</span>
            <span class=k>return</span>

    <span class=bp>self</span><span class=o>.</span><span class=n>_connection_depth</span> <span class=o>+=</span> <span class=mi>1</span>
    <span class=k>yield</span> <span class=bp>self</span><span class=o>.</span><span class=n>p4</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>_connection_depth</span> <span class=o>-=</span> <span class=mi>1</span>
    <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_connection_depth</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>__clients_cache__</span> <span class=o>=</span> <span class=kc>None</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_process_errors</span><span class=p>()</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_process_warnings</span><span class=p>()</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>p4</span><span class=o>.</span><span class=n>disconnect</span><span class=p>()</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_clear_errors</span><span class=p>()</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=client.version_control.backends.perforce.api.P4ConnectionManager.__getattribute__ class="doc doc-heading"> <code class="highlight language-python"><span class=fm>__getattribute__</span><span class=p>(</span><span class=n>attribute_name</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>This is a custom handler for attribute access.</p> <p>It allows methods that need wrapping with <code>__run_connect__</code> to be wrapped when first called. The alternative was for <code>__run_connect__</code> to exist outside of P4ConnectionManager, which seemed janky.</p> <p>A method with the prefix <code>_connect_</code> will be wrapped with <code>__run_connect__</code> when first called and then assigned back to the instance without the <code>_connect_</code> prefix. This provides lazy creation and exposure of core methods. For example: This will expose the wrapped version of: <code>_connect_checkout</code>, saving it as an attribute on the <code>P4ConnectionManager</code> instance, to provide a quicker look up if accessed again:</p> <pre><code>cm = P4ConnectionManager()
cm.checkout
</code></pre> <p>It is recommended to use the full method name when calling from within the object (include <code>_connect_</code> prefix). This avoids unneccesary connection checks, providing a slight performance boost. I.E: <code>self._connect_checkout</code> rather than <code>self.checkout</code></p> <details class=quote> <summary>Source code in <code>client/version_control/backends/perforce/api/__init__.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>236</span>
<span class=normal>237</span>
<span class=normal>238</span>
<span class=normal>239</span>
<span class=normal>240</span>
<span class=normal>241</span>
<span class=normal>242</span>
<span class=normal>243</span>
<span class=normal>244</span>
<span class=normal>245</span>
<span class=normal>246</span>
<span class=normal>247</span>
<span class=normal>248</span>
<span class=normal>249</span>
<span class=normal>250</span>
<span class=normal>251</span>
<span class=normal>252</span>
<span class=normal>253</span>
<span class=normal>254</span>
<span class=normal>255</span>
<span class=normal>256</span>
<span class=normal>257</span>
<span class=normal>258</span>
<span class=normal>259</span>
<span class=normal>260</span>
<span class=normal>261</span>
<span class=normal>262</span>
<span class=normal>263</span>
<span class=normal>264</span>
<span class=normal>265</span>
<span class=normal>266</span>
<span class=normal>267</span>
<span class=normal>268</span>
<span class=normal>269</span>
<span class=normal>270</span>
<span class=normal>271</span>
<span class=normal>272</span>
<span class=normal>273</span>
<span class=normal>274</span>
<span class=normal>275</span>
<span class=normal>276</span>
<span class=normal>277</span>
<span class=normal>278</span>
<span class=normal>279</span>
<span class=normal>280</span>
<span class=normal>281</span>
<span class=normal>282</span>
<span class=normal>283</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=fm>__getattribute__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>attribute_name</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Any</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    This is a custom handler for attribute access.</span>

<span class=sd>    It allows methods that need wrapping with</span>
<span class=sd>    `__run_connect__` to be wrapped when first called.</span>
<span class=sd>    The alternative was for `__run_connect__` to exist</span>
<span class=sd>    outside of P4ConnectionManager, which seemed janky.</span>

<span class=sd>    A method with the prefix `_connect_` will be wrapped</span>
<span class=sd>    with `__run_connect__` when first called and then assigned</span>
<span class=sd>    back to the instance without the `_connect_` prefix.</span>
<span class=sd>    This provides lazy creation and exposure of core methods.</span>
<span class=sd>    For example:</span>
<span class=sd>    This will expose the wrapped version of: `_connect_checkout`,</span>
<span class=sd>    saving it as an attribute on the `P4ConnectionManager`</span>
<span class=sd>    instance, to provide a quicker look up if accessed again:</span>

<span class=sd>    ```</span>
<span class=sd>    cm = P4ConnectionManager()</span>
<span class=sd>    cm.checkout</span>
<span class=sd>    ```</span>

<span class=sd>    It is recommended to use the full method name when</span>
<span class=sd>    calling from within the object (include `_connect_` prefix).</span>
<span class=sd>    This avoids unneccesary connection checks, providing a slight</span>
<span class=sd>    performance boost. I.E:</span>
<span class=sd>    `self._connect_checkout` rather than `self.checkout`</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>try</span><span class=p>:</span>
        <span class=n>attribute</span> <span class=o>=</span> <span class=nb>object</span><span class=o>.</span><span class=fm>__getattribute__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>attribute_name</span><span class=p>)</span>
        <span class=k>return</span> <span class=n>attribute</span>

    <span class=k>except</span> <span class=ne>AttributeError</span><span class=p>:</span>
        <span class=n>attribute_name</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;_connect_</span><span class=si>{</span><span class=n>attribute_name</span><span class=si>}</span><span class=s2>&quot;</span>
        <span class=k>try</span><span class=p>:</span>
            <span class=n>attribute</span> <span class=o>=</span> <span class=nb>object</span><span class=o>.</span><span class=fm>__getattribute__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>attribute_name</span><span class=p>)</span>
            <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>attribute</span><span class=p>,</span> <span class=n>MethodType</span><span class=p>):</span>
                <span class=n>__run_connect__</span> <span class=o>=</span> <span class=nb>object</span><span class=o>.</span><span class=fm>__getattribute__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=s2>&quot;__run_connect__&quot;</span><span class=p>)</span>
                <span class=n>attribute</span> <span class=o>=</span> <span class=n>__run_connect__</span><span class=p>(</span><span class=n>attribute</span><span class=p>)</span>
                <span class=nb>object</span><span class=o>.</span><span class=fm>__setattr__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>attribute_name</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&quot;_connect_&quot;</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>),</span> <span class=n>attribute</span><span class=p>)</span>

            <span class=k>return</span> <span class=n>attribute</span>

        <span class=k>except</span> <span class=ne>AttributeError</span><span class=p>:</span>
            <span class=n>_attribute_name</span> <span class=o>=</span> <span class=n>attribute_name</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&quot;_connect_&quot;</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>)</span>
            <span class=n>class_name</span> <span class=o>=</span> <span class=nb>object</span><span class=o>.</span><span class=fm>__getattribute__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=s2>&quot;__class__&quot;</span><span class=p>)</span><span class=o>.</span><span class=vm>__name__</span>
            <span class=k>raise</span> <span class=ne>AttributeError</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>class_name</span><span class=si>}</span><span class=s2> has no attribute: </span><span class=si>{</span><span class=n>_attribute_name</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=client.version_control.backends.perforce.api.P4ConnectionManager.__run_connect__ class="doc doc-heading"> <code class="highlight language-python"><span class=n>__run_connect__</span><span class=p>(</span><span class=n>function</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Decorator that connects to p4 before running a function.</p> <p>This is syntactic sugar to try and reduce indentation in a function body. Removing the need to use p4.connect in every function body:</p> <pre><code>def function(self):
    with p4.connect():
        pass
</code></pre> <p>The intention is for this to work with P4ConnectionManager, it will not work with standard functions.</p> <details class=quote> <summary>Source code in <code>client/version_control/backends/perforce/api/__init__.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>374</span>
<span class=normal>375</span>
<span class=normal>376</span>
<span class=normal>377</span>
<span class=normal>378</span>
<span class=normal>379</span>
<span class=normal>380</span>
<span class=normal>381</span>
<span class=normal>382</span>
<span class=normal>383</span>
<span class=normal>384</span>
<span class=normal>385</span>
<span class=normal>386</span>
<span class=normal>387</span>
<span class=normal>388</span>
<span class=normal>389</span>
<span class=normal>390</span>
<span class=normal>391</span>
<span class=normal>392</span>
<span class=normal>393</span>
<span class=normal>394</span>
<span class=normal>395</span>
<span class=normal>396</span>
<span class=normal>397</span>
<span class=normal>398</span>
<span class=normal>399</span>
<span class=normal>400</span>
<span class=normal>401</span>
<span class=normal>402</span>
<span class=normal>403</span>
<span class=normal>404</span>
<span class=normal>405</span>
<span class=normal>406</span>
<span class=normal>407</span>
<span class=normal>408</span>
<span class=normal>409</span>
<span class=normal>410</span>
<span class=normal>411</span>
<span class=normal>412</span>
<span class=normal>413</span>
<span class=normal>414</span>
<span class=normal>415</span>
<span class=normal>416</span>
<span class=normal>417</span>
<span class=normal>418</span>
<span class=normal>419</span>
<span class=normal>420</span>
<span class=normal>421</span>
<span class=normal>422</span>
<span class=normal>423</span>
<span class=normal>424</span>
<span class=normal>425</span>
<span class=normal>426</span>
<span class=normal>427</span>
<span class=normal>428</span>
<span class=normal>429</span>
<span class=normal>430</span>
<span class=normal>431</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>__run_connect__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>function</span><span class=p>):</span>
    <span class=c1># type: (Callable[..., Any]) -&gt; Callable[..., Any]</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Decorator that connects to p4 before running a function.</span>

<span class=sd>    This is syntactic sugar to try and reduce indentation</span>
<span class=sd>    in a function body.</span>
<span class=sd>    Removing the need to use p4.connect in every function body:</span>

<span class=sd>    ```</span>
<span class=sd>    def function(self):</span>
<span class=sd>        with p4.connect():</span>
<span class=sd>            pass</span>
<span class=sd>    ```</span>

<span class=sd>    The intention is for this to work with P4ConnectionManager,</span>
<span class=sd>    it will not work with standard functions.</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=nd>@functools</span><span class=o>.</span><span class=n>wraps</span><span class=p>(</span><span class=n>function</span><span class=p>)</span>
    <span class=k>def</span><span class=w> </span><span class=nf>_connect</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
        <span class=c1># type: (Any, Any) -&gt; Any</span>
        <span class=n>workspace_override</span> <span class=o>=</span> <span class=kc>None</span>
        <span class=n>args_info</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_path_arg_info</span><span class=p>(</span><span class=n>function</span><span class=p>,</span> <span class=n>args</span><span class=p>)</span> <span class=k>if</span> <span class=n>args</span> <span class=k>else</span> <span class=p>(</span><span class=kc>None</span><span class=p>,</span> <span class=kc>False</span><span class=p>)</span>
        <span class=n>paths</span><span class=p>,</span> <span class=n>compile_result</span> <span class=o>=</span> <span class=n>args_info</span>
        <span class=n>paths</span><span class=p>,</span> <span class=n>args</span><span class=p>,</span> <span class=n>kwargs</span><span class=p>,</span> <span class=n>workspace_override</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_split_args</span><span class=p>(</span><span class=n>paths</span><span class=p>,</span> <span class=n>args</span><span class=p>,</span> <span class=n>kwargs</span><span class=p>)</span>

        <span class=k>with</span> <span class=bp>self</span><span class=o>.</span><span class=n>__connect__</span><span class=p>():</span>
            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_is_offline</span><span class=p>:</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>__run_function_offline__</span><span class=p>(</span>
                    <span class=n>function</span><span class=p>,</span> <span class=n>paths</span><span class=p>,</span> <span class=n>compile_result</span><span class=p>,</span> <span class=n>args</span><span class=p>,</span> <span class=n>kwargs</span>
                <span class=p>)</span>
            <span class=k>else</span><span class=p>:</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>_update_workspace_cache</span><span class=p>(</span><span class=n>workspace_override</span> <span class=ow>or</span> <span class=bp>self</span><span class=o>.</span><span class=n>p4</span><span class=o>.</span><span class=n>client</span><span class=p>)</span>
                <span class=k>for</span> <span class=n>workspace</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>_workspace_cache</span><span class=p>:</span>
                    <span class=k>with</span> <span class=bp>self</span><span class=o>.</span><span class=n>workspace_as</span><span class=p>(</span><span class=n>workspace</span><span class=p>):</span>
                        <span class=bp>self</span><span class=o>.</span><span class=n>__run_function__</span><span class=p>(</span>
                            <span class=n>function</span><span class=p>,</span> <span class=n>paths</span><span class=p>,</span> <span class=n>workspace</span><span class=p>,</span> <span class=n>compile_result</span><span class=p>,</span> <span class=n>args</span><span class=p>,</span> <span class=n>kwargs</span>
                        <span class=p>)</span>
                        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_break_run_loop</span><span class=p>:</span>
                            <span class=k>break</span>

        <span class=k>if</span> <span class=n>compile_result</span><span class=p>:</span>
            <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>result</span>

        <span class=n>_result</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>result</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=n>_result</span><span class=p>:</span>
            <span class=k>return</span> <span class=n>_result</span>

        <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>_result</span><span class=p>,</span> <span class=nb>dict</span><span class=p>):</span>
            <span class=n>_result</span> <span class=o>=</span> <span class=nb>tuple</span><span class=p>(</span><span class=n>_result</span><span class=o>.</span><span class=n>values</span><span class=p>())</span>

        <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>_result</span><span class=p>,</span> <span class=p>(</span><span class=nb>list</span><span class=p>,</span> <span class=nb>tuple</span><span class=p>))</span> <span class=ow>and</span> <span class=nb>len</span><span class=p>(</span><span class=n>_result</span><span class=p>)</span> <span class=o>==</span> <span class=mi>1</span><span class=p>:</span>
            <span class=k>return</span> <span class=n>_result</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>

        <span class=k>return</span> <span class=n>_result</span>

    <span class=k>return</span> <span class=n>_connect</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=client.version_control.backends.perforce.api.P4ConnectionManager.login class="doc doc-heading"> <code class="highlight language-python"><span class=n>login</span><span class=p>(</span><span class=n>host</span><span class=p>,</span> <span class=n>port</span><span class=p>,</span> <span class=n>username</span><span class=p>,</span> <span class=n>password</span><span class=p>,</span> <span class=n>workspace_name</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Connects from values in Settings</p> <p>Override P4CONFIG values.</p> <details class=quote> <summary>Source code in <code>client/version_control/backends/perforce/api/__init__.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>942</span>
<span class=normal>943</span>
<span class=normal>944</span>
<span class=normal>945</span>
<span class=normal>946</span>
<span class=normal>947</span>
<span class=normal>948</span>
<span class=normal>949</span>
<span class=normal>950</span>
<span class=normal>951</span>
<span class=normal>952</span>
<span class=normal>953</span>
<span class=normal>954</span>
<span class=normal>955</span>
<span class=normal>956</span>
<span class=normal>957</span>
<span class=normal>958</span>
<span class=normal>959</span>
<span class=normal>960</span>
<span class=normal>961</span>
<span class=normal>962</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>login</span><span class=p>(</span>
    <span class=bp>self</span><span class=p>,</span>
    <span class=n>host</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
    <span class=n>port</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span>
    <span class=n>username</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
    <span class=n>password</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
    <span class=n>workspace_name</span><span class=p>:</span> <span class=nb>str</span>
<span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Connects from values in Settings</span>

<span class=sd>    Override P4CONFIG values.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>conn_manager</span> <span class=o>=</span> <span class=n>_get_connection_manager</span><span class=p>()</span>
    <span class=k>if</span> <span class=n>conn_manager</span><span class=o>.</span><span class=n>p4</span><span class=o>.</span><span class=n>user</span> <span class=o>!=</span> <span class=n>username</span><span class=p>:</span>
        <span class=n>conn_manager</span><span class=o>.</span><span class=n>p4</span><span class=o>.</span><span class=n>user</span> <span class=o>=</span> <span class=n>username</span>
        <span class=n>conn_manager</span><span class=o>.</span><span class=n>p4</span><span class=o>.</span><span class=n>password</span> <span class=o>=</span> <span class=n>password</span>
        <span class=n>conn_manager</span><span class=o>.</span><span class=n>p4</span><span class=o>.</span><span class=n>port</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>host</span><span class=si>}</span><span class=s2>:</span><span class=si>{</span><span class=n>port</span><span class=si>}</span><span class=s2>&quot;</span>
    <span class=n>conn_manager</span><span class=o>.</span><span class=n>p4</span><span class=o>.</span><span class=n>connect</span><span class=p>()</span>
    <span class=n>conn_manager</span><span class=o>.</span><span class=n>p4</span><span class=o>.</span><span class=n>run_login</span><span class=p>(</span><span class=n>password</span><span class=o>=</span><span class=n>password</span><span class=p>)</span>
    <span class=n>conn_manager</span><span class=o>.</span><span class=n>p4</span><span class=o>.</span><span class=n>client</span> <span class=o>=</span> <span class=n>workspace_name</span>
    <span class=n>conn_manager</span><span class=o>.</span><span class=n>__workspace_cache__</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_connect_get_workspaces</span><span class=p>()</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=client.version_control.backends.perforce.api.P4ConnectionManager.workspace_as class="doc doc-heading"> <code class="highlight language-python"><span class=n>workspace_as</span><span class=p>(</span><span class=n>workspace</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Context manager that connects to if not already connected p4, yielding the instance of p4 and closing the connection when done.</p> <details class=quote> <summary>Source code in <code>client/version_control/backends/perforce/api/__init__.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1847</span>
<span class=normal>1848</span>
<span class=normal>1849</span>
<span class=normal>1850</span>
<span class=normal>1851</span>
<span class=normal>1852</span>
<span class=normal>1853</span>
<span class=normal>1854</span>
<span class=normal>1855</span>
<span class=normal>1856</span>
<span class=normal>1857</span>
<span class=normal>1858</span>
<span class=normal>1859</span>
<span class=normal>1860</span>
<span class=normal>1861</span>
<span class=normal>1862</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nd>@contextmanager</span>
<span class=k>def</span><span class=w> </span><span class=nf>workspace_as</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>workspace</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Iterator</span><span class=p>[</span><span class=kc>None</span><span class=p>]:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Context manager that connects to if not already connected p4,</span>
<span class=sd>    yielding the instance of p4 and closing the connection when done.</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=n>current_workspace</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>p4</span><span class=o>.</span><span class=n>client</span>
    <span class=k>try</span><span class=p>:</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>p4</span><span class=o>.</span><span class=n>client</span> <span class=o>=</span> <span class=n>workspace</span>
        <span class=k>yield</span>

    <span class=k>except</span><span class=p>:</span>
        <span class=k>raise</span>

    <span class=k>finally</span><span class=p>:</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>p4</span><span class=o>.</span><span class=n>client</span> <span class=o>=</span> <span class=n>current_workspace</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> <div class="doc doc-object doc-function"> <h2 id=client.version_control.backends.perforce.api.__getattr__ class="doc doc-heading"> <code class="highlight language-python"><span class=fm>__getattr__</span><span class=p>(</span><span class=n>attribute_name</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Custom <strong>getattr</strong> for this module that will return the method of the module level P4ConnectionManager.</p> <pre><code>This achieves two things:
    1. Allows a single P4ConnectionManager to be used for one off calls
        in the main thread, without the need to init a new P4ConnectionManager
        for each call.
    2. Reduces the boilerplate required to expose the calls of the single
        P4ConnectionManager, whilst still making the functionality
        accessible at the module level.

Args:
    attribute_name (str): The name of the module level attribute to access.

Returns:
    Any: The accessed attribute.
</code></pre> <details class=quote> <summary>Source code in <code>client/version_control/backends/perforce/api/__init__.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1957</span>
<span class=normal>1958</span>
<span class=normal>1959</span>
<span class=normal>1960</span>
<span class=normal>1961</span>
<span class=normal>1962</span>
<span class=normal>1963</span>
<span class=normal>1964</span>
<span class=normal>1965</span>
<span class=normal>1966</span>
<span class=normal>1967</span>
<span class=normal>1968</span>
<span class=normal>1969</span>
<span class=normal>1970</span>
<span class=normal>1971</span>
<span class=normal>1972</span>
<span class=normal>1973</span>
<span class=normal>1974</span>
<span class=normal>1975</span>
<span class=normal>1976</span>
<span class=normal>1977</span>
<span class=normal>1978</span>
<span class=normal>1979</span>
<span class=normal>1980</span>
<span class=normal>1981</span>
<span class=normal>1982</span>
<span class=normal>1983</span>
<span class=normal>1984</span>
<span class=normal>1985</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=fm>__getattr__</span><span class=p>(</span><span class=n>attribute_name</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Any</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Custom __getattr__ for this module that will return</span>
<span class=sd>    the method of the module level P4ConnectionManager.</span>

<span class=sd>        This achieves two things:</span>
<span class=sd>            1. Allows a single P4ConnectionManager to be used for one off calls</span>
<span class=sd>                in the main thread, without the need to init a new P4ConnectionManager</span>
<span class=sd>                for each call.</span>
<span class=sd>            2. Reduces the boilerplate required to expose the calls of the single</span>
<span class=sd>                P4ConnectionManager, whilst still making the functionality</span>
<span class=sd>                accessible at the module level.</span>

<span class=sd>        Args:</span>
<span class=sd>            attribute_name (str): The name of the module level attribute to access.</span>

<span class=sd>        Returns:</span>
<span class=sd>            Any: The accessed attribute.</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=n>connection_manager</span> <span class=o>=</span> <span class=n>_get_connection_manager</span><span class=p>()</span>
    <span class=k>if</span> <span class=nb>hasattr</span><span class=p>(</span><span class=n>connection_manager</span><span class=p>,</span> <span class=n>attribute_name</span><span class=p>):</span>
        <span class=k>return</span> <span class=nb>getattr</span><span class=p>(</span><span class=n>connection_manager</span><span class=p>,</span> <span class=n>attribute_name</span><span class=p>)</span>

    <span class=n>_globals</span> <span class=o>=</span> <span class=nb>globals</span><span class=p>()</span>
    <span class=k>if</span> <span class=n>attribute_name</span> <span class=ow>in</span> <span class=n>_globals</span><span class=p>:</span>
        <span class=k>return</span> <span class=nb>getattr</span><span class=p>(</span><span class=n>_globals</span><span class=p>,</span> <span class=n>attribute_name</span><span class=p>)</span>

    <span class=k>raise</span> <span class=ne>AttributeError</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=vm>__name__</span><span class=si>}</span><span class=s2> has no attribute: </span><span class=si>{</span><span class=n>attribute_name</span><span class=si>}</span><span class=s2>!&quot;</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../../../../..", "features": ["navigation.sections", "navigation.path", "navigation.prune"], "search": "../../../../../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script> <script src=../../../../../../assets/javascripts/bundle.c8b220af.min.js></script> </body> </html>